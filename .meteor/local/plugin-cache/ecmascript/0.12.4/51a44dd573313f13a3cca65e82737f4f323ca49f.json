{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Sandbox\\test\\packages\\ostrio:user-status\\client\\main.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/ostrio:user-status/client/main.js","filename":"C:\\Sandbox\\test\\packages\\ostrio:user-status\\client\\main.js","passPerPreset":false,"envName":"development","cwd":"C:\\Sandbox\\test","root":"C:\\Sandbox\\test","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"C:\\Sandbox\\test\\packages\\ostrio:user-status\\client\\main.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/ostrio:user-status/client/main.js"}},"code":"module.export({\n  UserStatus: () => UserStatus\n});\nlet throttle;\nmodule.link(\"./throttle\", {\n  default(v) {\n    throttle = v;\n  }\n\n}, 0);\nlet Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 1);\nlet Session;\nmodule.link(\"meteor/session\", {\n  Session(v) {\n    Session = v;\n  }\n\n}, 2);\nlet Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker(v) {\n    Tracker = v;\n  }\n\n}, 3);\nlet Accounts;\nmodule.link(\"meteor/accounts-base\", {\n  Accounts(v) {\n    Accounts = v;\n  }\n\n}, 4);\nlet ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar(v) {\n    ReactiveVar = v;\n  }\n\n}, 5);\n\nconst NoOp = function () {};\n\nclass UserStatusClass {\n  constructor() {\n    Session.setDefault('UserStatusIdle', false);\n    this.status = new ReactiveVar('offline');\n    this.hidden = {};\n    /* @description Set right visibilitychange event and property names */\n\n    this.hidden.str = false;\n    this.hidden.evt = void 0;\n\n    if (typeof document.hidden !== 'undefined') {\n      this.hidden.str = 'hidden';\n      this.hidden.evt = 'visibilitychange';\n    } else if (typeof document.mozHidden !== 'undefined') {\n      this.hidden.str = 'mozHidden';\n      this.hidden.evt = 'mozvisibilitychange';\n    } else if (typeof document.msHidden !== 'undefined') {\n      this.hidden.str = 'msHidden';\n      this.hidden.evt = 'msvisibilitychange';\n    } else if (typeof document.webkitHidden !== 'undefined') {\n      this.hidden.str = 'webkitHidden';\n      this.hidden.evt = 'webkitvisibilitychange';\n    }\n\n    this.hidden.check = () => {\n      return document[this.hidden.str];\n    };\n    /* @description Set active/inactive user status */\n\n\n    this.hidden.set = () => {\n      if (this.hidden.check()) {\n        this.goIdle();\n      } else {\n        this.goOnline();\n      }\n    };\n\n    Tracker.autorun(() => {\n      const _user = Meteor.user();\n\n      if (_user) {\n        Session.set('UserStatusIdle', _user.profile.idle || false);\n\n        if (_user.profile.idle) {\n          this.status.set('idle');\n        } else if (_user.profile.online) {\n          this.status.set('online');\n        } else {\n          this.status.set('offline');\n        }\n      } else {\n        Session.set('UserStatusIdle', false);\n        this.status.set('offline');\n      }\n    });\n    /* @description Set event listeners */\n\n    this.on(document, [this.hidden.evt], this.hidden.set);\n    this.on(window, ['mousemove', 'mousedown', 'keypress', 'DOMMouseScroll', 'mousewheel', 'touchmove', 'MSPointerMove', 'MSPointerMove'], throttle(this.goOnline.bind(this), 777));\n    this.on(document, ['mousemove', 'mousedown', 'keypress', 'DOMMouseScroll', 'mousewheel', 'touchmove', 'MSPointerMove', 'MSPointerMove'], throttle(this.goOnline.bind(this), 777));\n  }\n\n  on(obj, events, fn) {\n    events.forEach(event => {\n      if (obj.addEventListener) {\n        obj.addEventListener(event, fn, {\n          passive: true,\n          capture: false\n        });\n      } else {\n        obj.attachEvent('on' + event, fn);\n      }\n    });\n  }\n\n  goOnline() {\n    const _user = Meteor.user();\n\n    if (_user && _user._id && (_user.profile.online !== true || _user.profile.idle !== false)) {\n      Meteor.users.update({\n        _id: _user._id\n      }, {\n        $set: {\n          'profile.online': true,\n          'profile.idle': false\n        }\n      }, NoOp);\n    }\n  }\n\n  goIdle() {\n    const _user = Meteor.user();\n\n    if (_user && _user._id && (_user.profile.online !== true || _user.profile.idle !== true)) {\n      Meteor.users.update({\n        _id: _user._id\n      }, {\n        $set: {\n          'profile.online': true,\n          'profile.idle': true\n        }\n      }, NoOp);\n    }\n  }\n\n  goOffline() {\n    let _user = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : Meteor.user();\n\n    if (_user && _user._id && (_user.profile.online !== false || _user.profile.idle !== false)) {\n      Meteor.users.update({\n        _id: _user._id\n      }, {\n        $set: {\n          'profile.online': false,\n          'profile.idle': false\n        }\n      }, NoOp);\n    }\n  }\n\n  startTimer() {\n    Meteor.setInterval(this.goIdle.bind(this), 30000);\n  }\n\n  start() {\n    this.startTimer();\n  }\n\n}\n\nconst UserStatus = new UserStatusClass();\nAccounts.onLogin(UserStatus.start.bind(UserStatus));\nAccounts.onLogout(UserStatus.goOffline.bind(UserStatus));","map":{"version":3,"sources":["packages/ostrio:user-status/client/main.js"],"names":["module","export","UserStatus","throttle","link","default","v","Meteor","Session","Tracker","Accounts","ReactiveVar","NoOp","UserStatusClass","constructor","setDefault","status","hidden","str","evt","document","mozHidden","msHidden","webkitHidden","check","set","goIdle","goOnline","autorun","_user","user","profile","idle","online","on","window","bind","obj","events","fn","forEach","event","addEventListener","passive","capture","attachEvent","_id","users","update","$set","goOffline","startTimer","setInterval","start","onLogin","onLogout"],"mappings":"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","sourcesContent":["import throttle        from './throttle';\nimport { Meteor }      from 'meteor/meteor';\nimport { Session }     from 'meteor/session';\nimport { Tracker }     from 'meteor/tracker';\nimport { Accounts }    from 'meteor/accounts-base';\nimport { ReactiveVar } from 'meteor/reactive-var';\n\nconst NoOp = function() {};\n\nclass UserStatusClass {\n  constructor() {\n    Session.setDefault('UserStatusIdle', false);\n    this.status = new ReactiveVar('offline');\n    this.hidden = {};\n\n    /* @description Set right visibilitychange event and property names */\n    this.hidden.str = false;\n    this.hidden.evt = void 0;\n    if (typeof document.hidden !== 'undefined') {\n      this.hidden.str = 'hidden';\n      this.hidden.evt = 'visibilitychange';\n    } else if (typeof document.mozHidden !== 'undefined') {\n      this.hidden.str = 'mozHidden';\n      this.hidden.evt = 'mozvisibilitychange';\n    } else if (typeof document.msHidden !== 'undefined') {\n      this.hidden.str = 'msHidden';\n      this.hidden.evt = 'msvisibilitychange';\n    } else if (typeof document.webkitHidden !== 'undefined') {\n      this.hidden.str = 'webkitHidden';\n      this.hidden.evt = 'webkitvisibilitychange';\n    }\n\n    this.hidden.check = () => {\n      return document[this.hidden.str];\n    };\n\n    /* @description Set active/inactive user status */\n    this.hidden.set = () => {\n      if (this.hidden.check()) {\n        this.goIdle();\n      } else {\n        this.goOnline();\n      }\n    };\n\n    Tracker.autorun(() => {\n      const _user = Meteor.user();\n      if (_user) {\n        Session.set('UserStatusIdle', _user.profile.idle || false);\n        if (_user.profile.idle) {\n          this.status.set('idle');\n        } else if (_user.profile.online) {\n          this.status.set('online');\n        } else {\n          this.status.set('offline');\n        }\n      } else {\n        Session.set('UserStatusIdle', false);\n        this.status.set('offline');\n      }\n    });\n\n    /* @description Set event listeners */\n    this.on(document, [this.hidden.evt], this.hidden.set);\n    this.on(window, ['mousemove', 'mousedown', 'keypress', 'DOMMouseScroll', 'mousewheel', 'touchmove', 'MSPointerMove', 'MSPointerMove'], throttle(this.goOnline.bind(this), 777));\n    this.on(document, ['mousemove', 'mousedown', 'keypress', 'DOMMouseScroll', 'mousewheel', 'touchmove', 'MSPointerMove', 'MSPointerMove'], throttle(this.goOnline.bind(this), 777));\n  }\n\n  on(obj, events, fn) {\n    events.forEach((event) => {\n      if (obj.addEventListener) {\n        obj.addEventListener(event, fn, { passive: true, capture: false });\n      } else {\n        obj.attachEvent('on' + event, fn);\n      }\n    });\n  }\n\n  goOnline() {\n    const _user = Meteor.user();\n    if (_user && _user._id && (_user.profile.online !== true || _user.profile.idle !== false)) {\n      Meteor.users.update({\n        _id: _user._id\n      }, {\n        $set: {\n          'profile.online': true,\n          'profile.idle': false\n        }\n      }, NoOp);\n    }\n  }\n\n  goIdle() {\n    const _user = Meteor.user();\n    if (_user && _user._id && (_user.profile.online !== true || _user.profile.idle !== true)) {\n      Meteor.users.update({\n        _id: _user._id\n      }, {\n        $set: {\n          'profile.online': true,\n          'profile.idle': true\n        }\n      }, NoOp);\n    }\n  }\n\n  goOffline(_user = Meteor.user()) {\n    if (_user && _user._id && (_user.profile.online !== false || _user.profile.idle !== false)) {\n      Meteor.users.update({\n        _id: _user._id\n      }, {\n        $set: {\n          'profile.online': false,\n          'profile.idle': false\n        }\n      }, NoOp);\n    }\n  }\n\n  startTimer() {\n    Meteor.setInterval(this.goIdle.bind(this), 30000);\n  }\n\n  start() {\n    this.startTimer();\n  }\n}\n\nconst UserStatus = new UserStatusClass();\nAccounts.onLogin(UserStatus.start.bind(UserStatus));\nAccounts.onLogout(UserStatus.goOffline.bind(UserStatus));\n\nexport { UserStatus };\n"]},"sourceType":"script","hash":"51a44dd573313f13a3cca65e82737f4f323ca49f"}
