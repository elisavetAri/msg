{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\GroupedTable.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/znewsham:dynamic-table/client/ui/GroupedTable.js","filename":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\GroupedTable.js","passPerPreset":false,"envName":"development","cwd":"C:\\Sandbox\\test","root":"C:\\Sandbox\\test","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\GroupedTable.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/znewsham:dynamic-table/client/ui/GroupedTable.js"}},"code":"module.link(\"./components/dynamicTableGroup/dynamicTableGroup.js\");\nmodule.link(\"./GroupedTable.html\");\nmodule.link(\"./components/manageGroupFieldsModal/manageGroupFieldsModal.js\");\nlet getColumns, getPosition, changed, getCustom;\nmodule.link(\"../inlineSave.js\", {\n  getColumns(v) {\n    getColumns = v;\n  },\n\n  getPosition(v) {\n    getPosition = v;\n  },\n\n  changed(v) {\n    changed = v;\n  },\n\n  getCustom(v) {\n    getCustom = v;\n  }\n\n}, 0);\nTemplate.GroupedTable.onRendered(function onRendered() {\n  if (this.data.customGroupButtonSelector) {\n    this.autorun(() => {\n      const chain = this.groupChain.get();\n\n      if (chain.length) {\n        $(this.data.customGroupButtonSelector).addClass(\"grouped\");\n      } else {\n        $(this.data.customGroupButtonSelector).removeClass(\"grouped\");\n      }\n    });\n  }\n});\nTemplate.GroupedTable.onCreated(function onCreated() {\n  this.customTableSpec = this.data;\n  this.search = new ReactiveVar();\n  this.customColumns = new ReactiveVar([]);\n  this.groupChain = new ReactiveVar(_.compact((this.data.groupChain || []).map(gcf => this.data.groupableFields.find(gc => gc.field === gcf))));\n  this.searchFn = _.debounce(() => {\n    this.search.set(this.$(\".dynamic-table-global-search\").val());\n  }, 1000);\n  getCustom(this.data.custom, this.data.id, custom => {\n    this.customColumns.set(_.compact((custom.columns || []).map(c => _.find(getColumns(this.data.columns) || [], c1 => c1.id ? c1.id === c.id : c1.data === c.data))));\n\n    if (custom.groupChainFields) {\n      this.groupChain.set(_.compact(custom.groupChainFields.map(gcf => this.data.groupableFields.find(gc => gc.field === gcf))));\n    }\n  });\n\n  this.documentMouseDown = e => {\n    const manageGroupFieldsWrapper = $(\"#dynamic-table-manage-group-fields-modal\")[0];\n\n    if (manageGroupFieldsWrapper) {\n      if ($(manageGroupFieldsWrapper).has(e.target).length) {\n        return;\n      }\n\n      Blaze.remove(manageGroupFieldsWrapper.__blazeTemplate);\n      manageGroupFieldsWrapper.innerHTML = \"\";\n    }\n  };\n\n  document.addEventListener(\"mousedown\", this.documentMouseDown);\n});\nTemplate.GroupedTable.onDestroyed(function onDestroyed() {\n  document.removeEventListener(\"mousedown\", this.documentMouseDown);\n});\nTemplate.GroupedTable.helpers({\n  selector() {\n    const data = Template.instance().data;\n\n    const selector = _.extend({}, data.selector);\n\n    const search = Template.instance().search.get();\n    let searchSelector;\n\n    if (search) {\n      const searchVal = {\n        $regex: search,\n        $options: \"i\"\n      };\n      searchSelector = {\n        $or: []\n      };\n\n      const columns = _.unique(Template.instance().customColumns.get().length ? Template.instance().customColumns.get() : data.columns, c => c.data + c.id + c.search);\n\n      columns.filter(c => c.searchable !== false).forEach(column => {\n        if (column.search) {\n          searchSelector.$or.push(...column.search(_.extend({}, searchVal, {\n            $options: column.searchOptions\n          })));\n        } else if (column.data) {\n          searchSelector.$or.push({\n            [column.data]: _.extend({}, searchVal, {\n              $options: column.searchOptions\n            })\n          });\n        }\n      });\n    }\n\n    if (selector && Object.keys(selector).length && searchSelector) {\n      return {\n        $and: [selector, searchSelector]\n      };\n    }\n\n    return searchSelector || selector;\n  },\n\n  expandAll() {\n    if (this.expandAll !== undefined) {\n      return this.expanAll;\n    }\n\n    return false;\n  },\n\n  lazy() {\n    if (this.lazy !== undefined) {\n      return this.lazy;\n    }\n\n    return true;\n  },\n\n  customTableSpec() {\n    return Template.instance().customTableSpec;\n  },\n\n  aGroupChain() {\n    const groupChain = Template.instance().groupChain.get();\n    return groupChain;\n  }\n\n});\nTemplate.GroupedTable.events({\n  \"change .dynamic-table-global-search\"(e, templInstance) {\n    templInstance.searchFn();\n  },\n\n  \"keydown .dynamic-table-global-search\"(e, templInstance) {\n    templInstance.searchFn();\n  },\n\n  \"keyup .dynamic-table-global-search\"(e, templInstance) {\n    templInstance.searchFn();\n  },\n\n  \"click a.manage-group-fields\"(e, templInstance, extra) {\n    e.preventDefault();\n    const manageGroupFieldsOptions = {\n      availableColumns: templInstance.data.groupableFields,\n      selectedColumns: templInstance.groupChain.get(),\n\n      changeCallback(columns) {\n        templInstance.groupChain.set(columns);\n        changed(templInstance.data.custom, templInstance.data.id, {\n          newGroupChainFields: columns.map(c => c.field)\n        });\n      }\n\n    };\n    const target = extra ? extra.target : e.currentTarget;\n    const bounds = getPosition(target);\n    const left = Math.max(bounds.left + $(target).outerWidth() - 350, 0);\n    const div = $(\"#dynamic-table-manage-group-fields-modal\").length ? $(\"#dynamic-table-manage-group-fields-modal\") : $(\"<div>\");\n    div.attr(\"id\", \"dynamic-table-manage-group-fields-modal\").html(\"\").css(\"position\", \"absolute\").css(\"top\", bounds.top + $(target).outerHeight()).css(\"left\", left);\n\n    if (div[0].__blazeTemplate) {\n      Blaze.remove(div[0].__blazeTemplate);\n    }\n\n    div[0].__blazeTemplate = Blaze.renderWithData(Template.dynamicTableManageGroupFieldsModal, manageGroupFieldsOptions, div[0]);\n    document.body.appendChild(div[0]);\n    const tooFar = left + 350 - $(window).width();\n\n    if (tooFar > 0) {\n      div.css(\"left\", left - (tooFar + 5) + \"px\");\n    }\n  }\n\n});","map":{"version":3,"sources":["packages/znewsham:dynamic-table/client/ui/GroupedTable.js"],"names":["module","link","getColumns","getPosition","changed","getCustom","v","Template","GroupedTable","onRendered","data","customGroupButtonSelector","autorun","chain","groupChain","get","length","$","addClass","removeClass","onCreated","customTableSpec","search","ReactiveVar","customColumns","_","compact","map","gcf","groupableFields","find","gc","field","searchFn","debounce","set","val","custom","id","columns","c","c1","groupChainFields","documentMouseDown","e","manageGroupFieldsWrapper","has","target","Blaze","remove","__blazeTemplate","innerHTML","document","addEventListener","onDestroyed","removeEventListener","helpers","selector","instance","extend","searchSelector","searchVal","$regex","$options","$or","unique","filter","searchable","forEach","column","push","searchOptions","Object","keys","$and","expandAll","undefined","expanAll","lazy","aGroupChain","events","templInstance","extra","preventDefault","manageGroupFieldsOptions","availableColumns","selectedColumns","changeCallback","newGroupChainFields","currentTarget","bounds","left","Math","max","outerWidth","div","attr","html","css","top","outerHeight","renderWithData","dynamicTableManageGroupFieldsModal","body","appendChild","tooFar","window","width"],"mappings":"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","sourcesContent":["import \"./components/dynamicTableGroup/dynamicTableGroup.js\";\nimport \"./GroupedTable.html\";\nimport \"./components/manageGroupFieldsModal/manageGroupFieldsModal.js\";\nimport { getColumns, getPosition, changed, getCustom } from \"../inlineSave.js\";\n\nTemplate.GroupedTable.onRendered(function onRendered() {\n  if (this.data.customGroupButtonSelector) {\n    this.autorun(() => {\n      const chain = this.groupChain.get();\n      if (chain.length) {\n        $(this.data.customGroupButtonSelector).addClass(\"grouped\");\n      }\n      else {\n        $(this.data.customGroupButtonSelector).removeClass(\"grouped\");\n      }\n    });\n  }\n});\n\nTemplate.GroupedTable.onCreated(function onCreated() {\n  this.customTableSpec = this.data;\n  this.search = new ReactiveVar();\n  this.customColumns = new ReactiveVar([]);\n  this.groupChain = new ReactiveVar(_.compact((this.data.groupChain || []).map(gcf => this.data.groupableFields.find(gc => gc.field === gcf))));\n\n  this.searchFn = _.debounce(() => {\n    this.search.set(this.$(\".dynamic-table-global-search\").val());\n  }, 1000);\n\n  getCustom(this.data.custom, this.data.id, (custom) => {\n    this.customColumns.set(_.compact((custom.columns || []).map(c => _.find(getColumns(this.data.columns) || [], c1 => c1.id ? c1.id === c.id : c1.data === c.data))));\n    if (custom.groupChainFields) {\n      this.groupChain.set(_.compact(custom.groupChainFields.map(gcf => this.data.groupableFields.find(gc => gc.field === gcf))));\n    }\n  });\n  this.documentMouseDown = (e) => {\n    const manageGroupFieldsWrapper = $(\"#dynamic-table-manage-group-fields-modal\")[0];\n    if (manageGroupFieldsWrapper) {\n      if ($(manageGroupFieldsWrapper).has(e.target).length) {\n        return;\n      }\n      Blaze.remove(manageGroupFieldsWrapper.__blazeTemplate);\n      manageGroupFieldsWrapper.innerHTML = \"\";\n    }\n  };\n\n  document.addEventListener(\"mousedown\", this.documentMouseDown);\n});\n\nTemplate.GroupedTable.onDestroyed(function onDestroyed() {\n  document.removeEventListener(\"mousedown\", this.documentMouseDown);\n});\nTemplate.GroupedTable.helpers({\n  selector() {\n    const data = Template.instance().data;\n    const selector = _.extend({}, data.selector);\n    const search = Template.instance().search.get();\n    let searchSelector;\n    if (search) {\n      const searchVal = { $regex: search, $options: \"i\" };\n      searchSelector = { $or: [] };\n      const columns = _.unique(Template.instance().customColumns.get().length ? Template.instance().customColumns.get() : data.columns, c => c.data + c.id + c.search);\n      columns.filter(c => c.searchable !== false).forEach((column) => {\n        if (column.search) {\n          searchSelector.$or.push(...column.search(_.extend({}, searchVal, { $options: column.searchOptions })));\n        }\n        else if (column.data) {\n          searchSelector.$or.push({ [column.data]: _.extend({}, searchVal, { $options: column.searchOptions }) });\n        }\n      });\n    }\n    if (selector && Object.keys(selector).length && searchSelector) {\n      return { $and: [selector, searchSelector] };\n    }\n    return searchSelector || selector;\n  },\n  expandAll() {\n    if (this.expandAll !== undefined) {\n      return this.expanAll;\n    }\n    return false;\n  },\n  lazy() {\n    if (this.lazy !== undefined) {\n      return this.lazy;\n    }\n    return true;\n  },\n  customTableSpec() {\n    return Template.instance().customTableSpec;\n  },\n  aGroupChain() {\n    const groupChain = Template.instance().groupChain.get();\n    return groupChain;\n  }\n});\n\nTemplate.GroupedTable.events({\n  \"change .dynamic-table-global-search\"(e, templInstance) {\n    templInstance.searchFn();\n  },\n  \"keydown .dynamic-table-global-search\"(e, templInstance) {\n    templInstance.searchFn();\n  },\n  \"keyup .dynamic-table-global-search\"(e, templInstance) {\n    templInstance.searchFn();\n  },\n  \"click a.manage-group-fields\"(e, templInstance, extra) {\n    e.preventDefault();\n    const manageGroupFieldsOptions = {\n      availableColumns: templInstance.data.groupableFields,\n      selectedColumns: templInstance.groupChain.get(),\n      changeCallback(columns) {\n        templInstance.groupChain.set(columns);\n        changed(templInstance.data.custom, templInstance.data.id, { newGroupChainFields: columns.map(c => c.field) });\n      }\n    };\n    const target = extra ? extra.target : e.currentTarget;\n    const bounds = getPosition(target);\n    const left = Math.max((bounds.left + $(target).outerWidth()) - 350, 0);\n    const div = $(\"#dynamic-table-manage-group-fields-modal\").length ? $(\"#dynamic-table-manage-group-fields-modal\") : $(\"<div>\");\n    div.attr(\"id\", \"dynamic-table-manage-group-fields-modal\")\n    .html(\"\")\n    .css(\"position\", \"absolute\")\n    .css(\"top\", bounds.top + $(target).outerHeight())\n    .css(\"left\", left);\n\n    if (div[0].__blazeTemplate) {\n      Blaze.remove(div[0].__blazeTemplate);\n    }\n    div[0].__blazeTemplate = Blaze.renderWithData(\n      Template.dynamicTableManageGroupFieldsModal,\n      manageGroupFieldsOptions,\n      div[0]\n    );\n    document.body.appendChild(div[0]);\n    const tooFar = (left + 350) - $(window).width();\n    if (tooFar > 0) {\n      div.css(\"left\", (left - (tooFar + 5)) + \"px\");\n    }\n  }\n});\n"]},"sourceType":"script","hash":"5bf59d753521325108c0892c658750629578a2c2"}
