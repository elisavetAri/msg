{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Sandbox\\test\\imports\\ui\\pages\\this\\this.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"imports/ui/pages/this/this.js","filename":"C:\\Sandbox\\test\\imports\\ui\\pages\\this\\this.js","passPerPreset":false,"envName":"development","cwd":"C:\\Sandbox\\test","root":"C:\\Sandbox\\test","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"C:\\Sandbox\\test\\imports\\ui\\pages\\this\\this.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/ui/pages/this/this.js"}},"code":"module.link(\"./about.html\");\nlet ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar(v) {\n    ReactiveVar = v;\n  }\n\n}, 0);\n// (function() {\n//     var params = {},\n//         r = /([^&=]+)=?([^&]*)/g;\n//\n//     function d(s) {\n//         return decodeURIComponent(s.replace(/\\+/g, ' '));\n//     }\n//\n//     var match, search = window.location.search;\n//     while (match = r.exec(search.substring(1))) {\n//         params[d(match[1])] = d(match[2]);\n//\n//         if(d(match[2]) === 'true' || d(match[2]) === 'false') {\n//             params[d(match[1])] = d(match[2]) === 'true' ? true : false;\n//         }\n//     }\n//\n//     window.params = params;\n// })();\nTemplate.App_video.helpers({});\n\nfunction addStreamStopListener(stream, callback) {\n  stream.addEventListener('ended', function () {\n    callback();\n\n    callback = function () {};\n  }, false);\n  stream.addEventListener('inactive', function () {\n    callback();\n\n    callback = function () {};\n  }, false);\n  stream.getTracks().forEach(function (track) {\n    track.addEventListener('ended', function () {\n      callback();\n\n      callback = function () {};\n    }, false);\n    track.addEventListener('inactive', function () {\n      callback();\n\n      callback = function () {};\n    }, false);\n  });\n}\n\nvar video = document.createElement('video');\nvideo.controls = false;\nvar mediaElement = getHTMLMediaElement(video, {\n  title: 'Recording status: inactive',\n  buttons: ['full-screen'\n  /*, 'take-snapshot'*/\n  ],\n  showOnMouseEnter: false,\n  width: 360,\n  onTakeSnapshot: function () {\n    var canvas = document.createElement('canvas');\n    canvas.width = mediaElement.clientWidth;\n    canvas.height = mediaElement.clientHeight;\n    var context = canvas.getContext('2d');\n    context.drawImage(recordingPlayer, 0, 0, canvas.width, canvas.height);\n    window.open(canvas.toDataURL('image/png'));\n  }\n});\ndocument.getElementById('recording-player').appendChild(mediaElement);\nvar div = document.createElement('section');\nmediaElement.media.parentNode.appendChild(div);\nmediaElement.media.muted = false;\nmediaElement.media.autoplay = true;\nmediaElement.media.playsinline = true;\ndiv.appendChild(mediaElement.media);\nvar recordingPlayer = mediaElement.media;\nvar recordingMedia = document.querySelector('.recording-media');\nvar mediaContainerFormat = document.querySelector('.media-container-format');\nvar mimeType = 'video/webm';\nvar fileExtension = 'webm';\nvar type = 'video';\nvar recorderType;\nvar defaultWidth;\nvar defaultHeight;\nvar btnStartRecording = document.querySelector('#btn-start-recording');\n\nwindow.onbeforeunload = function () {\n  btnStartRecording.disabled = false;\n  recordingMedia.disabled = false;\n  mediaContainerFormat.disabled = false;\n  chkFixSeeking.parentNode.style.display = 'inline-block';\n};\n\nbtnStartRecording.onclick = function (event) {\n  var button = btnStartRecording;\n\n  if (button.innerHTML === 'Stop Recording') {\n    btnPauseRecording.style.display = 'none';\n    button.disabled = true;\n    button.disableStateWaiting = true;\n    setTimeout(function () {\n      button.disabled = false;\n      button.disableStateWaiting = false;\n    }, 2000);\n    button.innerHTML = 'Start Recording';\n\n    function stopStream() {\n      if (button.stream && button.stream.stop) {\n        button.stream.stop();\n        button.stream = null;\n      }\n\n      if (button.stream instanceof Array) {\n        button.stream.forEach(function (stream) {\n          stream.stop();\n        });\n        button.stream = null;\n      }\n\n      videoBitsPerSecond = null;\n      var html = 'Recording status: stopped';\n      html += '<br>Size: ' + bytesToSize(button.recordRTC.getBlob().size);\n      recordingPlayer.parentNode.parentNode.querySelector('h2').innerHTML = html;\n    }\n\n    if (button.recordRTC) {\n      if (button.recordRTC.length) {\n        button.recordRTC[0].stopRecording(function (url) {\n          if (!button.recordRTC[1]) {\n            button.recordingEndedCallback(url);\n            stopStream();\n            saveToDiskOrOpenNewTab(button.recordRTC[0]);\n            return;\n          }\n\n          button.recordRTC[1].stopRecording(function (url) {\n            button.recordingEndedCallback(url);\n            stopStream();\n          });\n        });\n      } else {\n        button.recordRTC.stopRecording(function (url) {\n          if (button.blobs && button.blobs.length) {\n            var blob = new File(button.blobs, getFileName(fileExtension), {\n              type: mimeType\n            });\n\n            button.recordRTC.getBlob = function () {\n              return blob;\n            };\n\n            url = URL.createObjectURL(blob);\n          }\n\n          if (chkFixSeeking.checked === true) {\n            // to fix video seeking issues\n            getSeekableBlob(button.recordRTC.getBlob(), function (seekableBlob) {\n              button.recordRTC.getBlob = function () {\n                return seekableBlob;\n              };\n\n              url = URL.createObjectURL(seekableBlob);\n              button.recordingEndedCallback(url);\n              saveToDiskOrOpenNewTab(button.recordRTC);\n              stopStream();\n            });\n            return;\n          }\n\n          button.recordingEndedCallback(url);\n          saveToDiskOrOpenNewTab(button.recordRTC);\n          stopStream();\n        });\n      }\n    }\n\n    return;\n  }\n\n  if (!event) return;\n  button.disabled = true;\n  var commonConfig = {\n    onMediaCaptured: function (stream) {\n      button.stream = stream;\n\n      if (button.mediaCapturedCallback) {\n        button.mediaCapturedCallback();\n      }\n\n      button.innerHTML = 'Stop Recording';\n      button.disabled = false;\n      chkFixSeeking.parentNode.style.display = 'none';\n    },\n    onMediaStopped: function () {\n      button.innerHTML = 'Start Recording';\n\n      if (!button.disableStateWaiting) {\n        button.disabled = false;\n      }\n\n      chkFixSeeking.parentNode.style.display = 'inline-block';\n    },\n    onMediaCapturingFailed: function (error) {\n      console.error('onMediaCapturingFailed:', error);\n\n      if (error.toString().indexOf('no audio or video tracks available') !== -1) {\n        alert('RecordRTC failed to start because there are no audio or video tracks available.');\n      }\n\n      if (error.name === 'PermissionDeniedError' && DetectRTC.browser.name === 'Firefox') {\n        alert('Firefox requires version >= 52. Firefox also requires HTTPs.');\n      }\n\n      commonConfig.onMediaStopped();\n    }\n  };\n\n  if (mediaContainerFormat.value === 'h264') {\n    mimeType = 'video/webm\\;codecs=h264';\n    fileExtension = 'mp4'; // video/mp4;codecs=avc1\n\n    if (isMimeTypeSupported('video/mpeg')) {\n      mimeType = 'video/mpeg';\n    }\n  }\n\n  if (mediaContainerFormat.value === 'mkv' && isMimeTypeSupported('video/x-matroska;codecs=avc1')) {\n    mimeType = 'video/x-matroska;codecs=avc1';\n    fileExtension = 'mkv';\n  }\n\n  if (mediaContainerFormat.value === 'vp8' && isMimeTypeSupported('video/webm\\;codecs=vp8')) {\n    mimeType = 'video/webm\\;codecs=vp8';\n    fileExtension = 'webm';\n    recorderType = null;\n    type = 'video';\n  }\n\n  if (mediaContainerFormat.value === 'vp9' && isMimeTypeSupported('video/webm\\;codecs=vp9')) {\n    mimeType = 'video/webm\\;codecs=vp9';\n    fileExtension = 'webm';\n    recorderType = null;\n    type = 'video';\n  }\n\n  if (mediaContainerFormat.value === 'pcm') {\n    mimeType = 'audio/wav';\n    fileExtension = 'wav';\n    recorderType = StereoAudioRecorder;\n    type = 'audio';\n  }\n\n  if (mediaContainerFormat.value === 'opus' || mediaContainerFormat.value === 'ogg') {\n    if (isMimeTypeSupported('audio/webm')) {\n      mimeType = 'audio/webm';\n      fileExtension = 'webm'; // webm\n    }\n\n    if (isMimeTypeSupported('audio/ogg')) {\n      mimeType = 'audio/ogg; codecs=opus';\n      fileExtension = 'ogg'; // ogg\n    }\n\n    recorderType = null;\n    type = 'audio';\n  }\n\n  if (mediaContainerFormat.value === 'whammy') {\n    mimeType = 'video/webm';\n    fileExtension = 'webm';\n    recorderType = WhammyRecorder;\n    type = 'video';\n  }\n\n  if (mediaContainerFormat.value === 'WebAssembly') {\n    mimeType = 'video/webm';\n    fileExtension = 'webm';\n    recorderType = WebAssemblyRecorder;\n    type = 'video';\n  }\n\n  if (mediaContainerFormat.value === 'gif') {\n    mimeType = 'image/gif';\n    fileExtension = 'gif';\n    recorderType = GifRecorder;\n    type = 'gif';\n  }\n\n  if (mediaContainerFormat.value === 'default') {\n    mimeType = 'video/webm';\n    fileExtension = 'webm';\n    recorderType = null;\n    type = 'video';\n  }\n\n  if (recordingMedia.value === 'record-audio') {\n    captureAudio(commonConfig);\n\n    button.mediaCapturedCallback = function () {\n      var options = {\n        type: type,\n        mimeType: mimeType,\n        leftChannel: params.leftChannel || false,\n        disableLogs: params.disableLogs || false\n      };\n\n      if (params.sampleRate) {\n        options.sampleRate = parseInt(params.sampleRate);\n      }\n\n      if (params.bufferSize) {\n        options.bufferSize = parseInt(params.bufferSize);\n      }\n\n      if (recorderType) {\n        options.recorderType = recorderType;\n      }\n\n      if (videoBitsPerSecond) {\n        options.videoBitsPerSecond = videoBitsPerSecond;\n      }\n\n      if (DetectRTC.browser.name === 'Edge') {\n        options.numberOfAudioChannels = 1;\n      }\n\n      options.ignoreMutedMedia = false;\n      button.recordRTC = RecordRTC(button.stream, options);\n\n      button.recordingEndedCallback = function (url) {\n        setVideoURL(url);\n      };\n\n      button.recordRTC.startRecording();\n      btnPauseRecording.style.display = '';\n    };\n  }\n\n  if (recordingMedia.value === 'record-audio-plus-video') {\n    captureAudioPlusVideo(commonConfig);\n\n    button.mediaCapturedCallback = function () {\n      if (typeof MediaRecorder === 'undefined') {\n        // opera or chrome etc.\n        button.recordRTC = [];\n\n        if (!params.bufferSize) {\n          // it fixes audio issues whilst recording 720p\n          params.bufferSize = 16384;\n        }\n\n        var options = {\n          type: 'audio',\n          // hard-code to set \"audio\"\n          leftChannel: params.leftChannel || false,\n          disableLogs: params.disableLogs || false,\n          video: recordingPlayer\n        };\n\n        if (params.sampleRate) {\n          options.sampleRate = parseInt(params.sampleRate);\n        }\n\n        if (params.bufferSize) {\n          options.bufferSize = parseInt(params.bufferSize);\n        }\n\n        if (params.frameInterval) {\n          options.frameInterval = parseInt(params.frameInterval);\n        }\n\n        if (recorderType) {\n          options.recorderType = recorderType;\n        }\n\n        if (videoBitsPerSecond) {\n          options.videoBitsPerSecond = videoBitsPerSecond;\n        }\n\n        options.ignoreMutedMedia = false;\n        var audioRecorder = RecordRTC(button.stream, options);\n        options.type = type;\n        var videoRecorder = RecordRTC(button.stream, options); // to sync audio/video playbacks in browser!\n\n        videoRecorder.initRecorder(function () {\n          audioRecorder.initRecorder(function () {\n            audioRecorder.startRecording();\n            videoRecorder.startRecording();\n            btnPauseRecording.style.display = '';\n          });\n        });\n        button.recordRTC.push(audioRecorder, videoRecorder);\n\n        button.recordingEndedCallback = function () {\n          var audio = new Audio();\n          audio.src = audioRecorder.toURL();\n          audio.controls = true;\n          audio.autoplay = true;\n          recordingPlayer.parentNode.appendChild(document.createElement('hr'));\n          recordingPlayer.parentNode.appendChild(audio);\n          if (audio.paused) audio.play();\n        };\n\n        return;\n      }\n\n      var options = {\n        type: type,\n        mimeType: mimeType,\n        disableLogs: params.disableLogs || false,\n        getNativeBlob: false,\n        // enable it for longer recordings\n        video: recordingPlayer\n      };\n\n      if (recorderType) {\n        options.recorderType = recorderType;\n\n        if (recorderType == WhammyRecorder || recorderType == GifRecorder || recorderType == WebAssemblyRecorder) {\n          options.canvas = options.video = {\n            width: defaultWidth || 320,\n            height: defaultHeight || 240\n          };\n        }\n      }\n\n      if (videoBitsPerSecond) {\n        options.videoBitsPerSecond = videoBitsPerSecond;\n      }\n\n      if (timeSlice && typeof MediaRecorder !== 'undefined') {\n        options.timeSlice = timeSlice;\n        button.blobs = [];\n\n        options.ondataavailable = function (blob) {\n          button.blobs.push(blob);\n        };\n      }\n\n      options.ignoreMutedMedia = false;\n      button.recordRTC = RecordRTC(button.stream, options);\n\n      button.recordingEndedCallback = function (url) {\n        setVideoURL(url);\n      };\n\n      button.recordRTC.startRecording();\n      btnPauseRecording.style.display = '';\n      recordingPlayer.parentNode.parentNode.querySelector('h2').innerHTML = '<img src=\"https://cdn.webrtc-experiment.com/images/progress.gif\">';\n    };\n  }\n\n  if (recordingMedia.value === 'record-screen') {\n    captureScreen(commonConfig);\n\n    button.mediaCapturedCallback = function () {\n      var options = {\n        type: type,\n        mimeType: mimeType,\n        disableLogs: params.disableLogs || false,\n        getNativeBlob: false,\n        // enable it for longer recordings\n        video: recordingPlayer\n      };\n\n      if (recorderType) {\n        options.recorderType = recorderType;\n\n        if (recorderType == WhammyRecorder || recorderType == GifRecorder || recorderType == WebAssemblyRecorder) {\n          options.canvas = options.video = {\n            width: defaultWidth || 320,\n            height: defaultHeight || 240\n          };\n        }\n      }\n\n      if (videoBitsPerSecond) {\n        options.videoBitsPerSecond = videoBitsPerSecond;\n      }\n\n      options.ignoreMutedMedia = false;\n      button.recordRTC = RecordRTC(button.stream, options);\n\n      button.recordingEndedCallback = function (url) {\n        setVideoURL(url);\n      };\n\n      button.recordRTC.startRecording();\n      btnPauseRecording.style.display = '';\n    };\n  } // note: audio+tab is supported in Chrome 50+\n  // todo: add audio+tab recording\n\n\n  if (recordingMedia.value === 'record-audio-plus-screen') {\n    captureAudioPlusScreen(commonConfig);\n\n    button.mediaCapturedCallback = function () {\n      var options = {\n        type: type,\n        mimeType: mimeType,\n        disableLogs: params.disableLogs || false,\n        getNativeBlob: false,\n        // enable it for longer recordings\n        video: recordingPlayer\n      };\n\n      if (recorderType) {\n        options.recorderType = recorderType;\n\n        if (recorderType == WhammyRecorder || recorderType == GifRecorder || recorderType == WebAssemblyRecorder) {\n          options.canvas = options.video = {\n            width: defaultWidth || 320,\n            height: defaultHeight || 240\n          };\n        }\n      }\n\n      if (videoBitsPerSecond) {\n        options.videoBitsPerSecond = videoBitsPerSecond;\n      }\n\n      options.ignoreMutedMedia = false;\n      button.recordRTC = RecordRTC(button.stream, options);\n\n      button.recordingEndedCallback = function (url) {\n        setVideoURL(url);\n      };\n\n      button.recordRTC.startRecording();\n      btnPauseRecording.style.display = '';\n    };\n  }\n};\n\nfunction captureVideo(config) {\n  captureUserMedia({\n    video: true\n  }, function (videoStream) {\n    config.onMediaCaptured(videoStream);\n    addStreamStopListener(videoStream, function () {\n      config.onMediaStopped();\n    });\n  }, function (error) {\n    config.onMediaCapturingFailed(error);\n  });\n}\n\nfunction captureAudio(config) {\n  captureUserMedia({\n    audio: true\n  }, function (audioStream) {\n    config.onMediaCaptured(audioStream);\n    addStreamStopListener(audioStream, function () {\n      config.onMediaStopped();\n    });\n  }, function (error) {\n    config.onMediaCapturingFailed(error);\n  });\n}\n\nfunction captureAudioPlusVideo(config) {\n  captureUserMedia({\n    video: true,\n    audio: true\n  }, function (audioVideoStream) {\n    config.onMediaCaptured(audioVideoStream);\n\n    if (audioVideoStream instanceof Array) {\n      audioVideoStream.forEach(function (stream) {\n        addStreamStopListener(stream, function () {\n          config.onMediaStopped();\n        });\n      });\n      return;\n    }\n\n    addStreamStopListener(audioVideoStream, function () {\n      config.onMediaStopped();\n    });\n  }, function (error) {\n    config.onMediaCapturingFailed(error);\n  });\n}\n\nvar MY_DOMAIN = 'webrtc-experiment.com';\n\nfunction isMyOwnDomain() {\n  // replace \"webrtc-experiment.com\" with your own domain name\n  return document.domain.indexOf(MY_DOMAIN) !== -1;\n}\n\nfunction isLocalHost() {\n  // \"chrome.exe\" --enable-usermedia-screen-capturing\n  // or firefox => about:config => \"media.getusermedia.screensharing.allowed_domains\" => add \"localhost\"\n  return document.domain === 'localhost' || document.domain === 'http://127.0.0.1:3000/';\n}\n\nvar videoBitsPerSecond;\n\nfunction setVideoBitrates() {\n  var select = document.querySelector('.media-bitrates');\n  var value = select.value;\n\n  if (value == 'default') {\n    videoBitsPerSecond = null;\n    return;\n  }\n\n  videoBitsPerSecond = parseInt(value);\n}\n\nfunction getFrameRates(mediaConstraints) {\n  if (!mediaConstraints.video) {\n    return mediaConstraints;\n  }\n\n  var select = document.querySelector('.media-framerates');\n  var value = select.value;\n\n  if (value == 'default') {\n    return mediaConstraints;\n  }\n\n  value = parseInt(value);\n\n  if (DetectRTC.browser.name === 'Firefox') {\n    mediaConstraints.video.frameRate = value;\n    return mediaConstraints;\n  }\n\n  if (!mediaConstraints.video.mandatory) {\n    mediaConstraints.video.mandatory = {};\n    mediaConstraints.video.optional = [];\n  }\n\n  var isScreen = recordingMedia.value.toString().toLowerCase().indexOf('screen') != -1;\n\n  if (isScreen) {\n    mediaConstraints.video.mandatory.maxFrameRate = value;\n  } else {\n    mediaConstraints.video.mandatory.minFrameRate = value;\n  }\n\n  return mediaConstraints;\n}\n\nfunction setGetFromLocalStorage(selectors) {\n  selectors.forEach(function (selector) {\n    var storageItem = selector.replace(/\\.|#/g, '');\n\n    if (localStorage.getItem(storageItem)) {\n      document.querySelector(selector).value = localStorage.getItem(storageItem);\n    }\n\n    addEventListenerToUploadLocalStorageItem(selector, ['change', 'blur'], function () {\n      localStorage.setItem(storageItem, document.querySelector(selector).value);\n    });\n  });\n}\n\nfunction addEventListenerToUploadLocalStorageItem(selector, arr, callback) {\n  arr.forEach(function (event) {\n    document.querySelector(selector).addEventListener(event, callback, false);\n  });\n}\n\nsetGetFromLocalStorage(['.media-resolutions', '.media-framerates', '.media-bitrates', '.recording-media', '.media-container-format']);\n\nfunction getVideoResolutions(mediaConstraints) {\n  if (!mediaConstraints.video) {\n    return mediaConstraints;\n  }\n\n  var select = document.querySelector('.media-resolutions');\n  var value = select.value;\n\n  if (value == 'default') {\n    return mediaConstraints;\n  }\n\n  value = value.split('x');\n\n  if (value.length != 2) {\n    return mediaConstraints;\n  }\n\n  defaultWidth = parseInt(value[0]);\n  defaultHeight = parseInt(value[1]);\n\n  if (DetectRTC.browser.name === 'Firefox') {\n    mediaConstraints.video.width = defaultWidth;\n    mediaConstraints.video.height = defaultHeight;\n    return mediaConstraints;\n  }\n\n  if (!mediaConstraints.video.mandatory) {\n    mediaConstraints.video.mandatory = {};\n    mediaConstraints.video.optional = [];\n  }\n\n  var isScreen = recordingMedia.value.toString().toLowerCase().indexOf('screen') != -1;\n\n  if (isScreen) {\n    mediaConstraints.video.mandatory.maxWidth = defaultWidth;\n    mediaConstraints.video.mandatory.maxHeight = defaultHeight;\n  } else {\n    mediaConstraints.video.mandatory.minWidth = defaultWidth;\n    mediaConstraints.video.mandatory.minHeight = defaultHeight;\n  }\n\n  return mediaConstraints;\n}\n\nfunction captureUserMedia(mediaConstraints, successCallback, errorCallback) {\n  if (mediaConstraints.video == true) {\n    mediaConstraints.video = {};\n  }\n\n  setVideoBitrates();\n  mediaConstraints = getVideoResolutions(mediaConstraints);\n  mediaConstraints = getFrameRates(mediaConstraints);\n  var isBlackBerry = !!/BB10|BlackBerry/i.test(navigator.userAgent || '');\n\n  if (isBlackBerry && !!(navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia)) {\n    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\n    navigator.getUserMedia(mediaConstraints, successCallback, errorCallback);\n    return;\n  }\n\n  navigator.mediaDevices.getUserMedia(mediaConstraints).then(function (stream) {\n    successCallback(stream);\n    setVideoURL(stream, true);\n  }).catch(function (error) {\n    if (error && (error.name === 'ConstraintNotSatisfiedError' || error.name === 'OverconstrainedError')) {\n      alert('Your camera or browser does NOT supports selected resolutions or frame-rates. \\n\\nPlease select \"default\" resolutions.');\n    } else if (error && error.message) {\n      alert(error.message);\n    } else {\n      alert('Unable to make getUserMedia request. Please check browser console logs.');\n    }\n\n    errorCallback(error);\n  });\n}\n\nfunction setMediaContainerFormat(arrayOfOptionsSupported) {\n  var options = Array.prototype.slice.call(mediaContainerFormat.querySelectorAll('option'));\n  var localStorageItem;\n\n  if (localStorage.getItem('media-container-format')) {\n    localStorageItem = localStorage.getItem('media-container-format');\n  }\n\n  var selectedItem;\n  options.forEach(function (option) {\n    option.disabled = true;\n\n    if (arrayOfOptionsSupported.indexOf(option.value) !== -1) {\n      option.disabled = false;\n\n      if (localStorageItem && arrayOfOptionsSupported.indexOf(localStorageItem) != -1) {\n        if (option.value != localStorageItem) return;\n        option.selected = true;\n        selectedItem = option;\n        return;\n      }\n\n      if (!selectedItem) {\n        option.selected = true;\n        selectedItem = option;\n      }\n    }\n  });\n}\n\nfunction isMimeTypeSupported(mimeType) {\n  if (typeof MediaRecorder === 'undefined') {\n    return false;\n  }\n\n  if (typeof MediaRecorder.isTypeSupported !== 'function') {\n    return true;\n  }\n\n  return MediaRecorder.isTypeSupported(mimeType);\n}\n\nrecordingMedia.onchange = function () {\n  if (recordingMedia.value === 'record-audio') {\n    var recordingOptions = [];\n\n    if (isMimeTypeSupported('audio/webm')) {\n      recordingOptions.push('opus');\n    }\n\n    if (isMimeTypeSupported('audio/ogg')) {\n      recordingOptions.push('ogg');\n    }\n\n    recordingOptions.push('pcm');\n    setMediaContainerFormat(recordingOptions);\n    return;\n  }\n\n  var isChrome = !!window.chrome && !(!!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0);\n  var recordingOptions = ['vp8']; // MediaStreamRecorder with vp8\n\n  if (isMimeTypeSupported('video/webm\\;codecs=vp9')) {\n    recordingOptions.push('vp9'); // MediaStreamRecorder with vp9\n  }\n\n  if (isMimeTypeSupported('video/webm\\;codecs=h264')) {\n    recordingOptions.push('h264'); // MediaStreamRecorder with h264\n  }\n\n  if (isMimeTypeSupported('video/x-matroska;codecs=avc1')) {\n    recordingOptions.push('mkv'); // MediaStreamRecorder with mkv/matroska\n  }\n\n  recordingOptions.push('gif'); // GifRecorder\n\n  if (DetectRTC.browser.name == 'Chrome') {\n    recordingOptions.push('whammy'); // WhammyRecorder\n  }\n\n  if (DetectRTC.browser.name == 'Chrome') {\n    recordingOptions.push('WebAssembly'); // WebAssemblyRecorder\n  }\n\n  recordingOptions.push('default'); // Default mimeType for MediaStreamRecorder\n\n  setMediaContainerFormat(recordingOptions);\n};\n\nrecordingMedia.onchange();\n\nif (typeof MediaRecorder === 'undefined' && (DetectRTC.browser.name === 'Edge' || DetectRTC.browser.name === 'Safari')) {\n  // webp isn't supported in Microsoft Edge\n  // neither MediaRecorder API\n  // so lets disable both video/screen recording options\n  console.warn('Neither MediaRecorder API nor webp is supported in ' + DetectRTC.browser.name + '. You cam merely record audio.');\n  recordingMedia.innerHTML = '<option value=\"record-audio\">Audio</option>';\n  setMediaContainerFormat(['pcm']);\n}\n\nfunction stringify(obj) {\n  var result = '';\n  Object.keys(obj).forEach(function (key) {\n    if (typeof obj[key] === 'function') {\n      return;\n    }\n\n    if (result.length) {\n      result += ',';\n    }\n\n    result += key + ': ' + obj[key];\n  });\n  return result;\n}\n\nfunction mediaRecorderToStringify(mediaRecorder) {\n  var result = '';\n  result += 'mimeType: ' + mediaRecorder.mimeType;\n  result += ', state: ' + mediaRecorder.state;\n  result += ', audioBitsPerSecond: ' + mediaRecorder.audioBitsPerSecond;\n  result += ', videoBitsPerSecond: ' + mediaRecorder.videoBitsPerSecond;\n\n  if (mediaRecorder.stream) {\n    result += ', streamid: ' + mediaRecorder.stream.id;\n    result += ', stream-active: ' + mediaRecorder.stream.active;\n  }\n\n  return result;\n}\n\nfunction getFailureReport() {\n  var info = 'RecordRTC seems failed. \\n\\n' + stringify(DetectRTC.browser) + '\\n\\n' + DetectRTC.osName + ' ' + DetectRTC.osVersion + '\\n';\n\n  if (typeof recorderType !== 'undefined' && recorderType) {\n    info += '\\nrecorderType: ' + recorderType.name;\n  }\n\n  if (typeof mimeType !== 'undefined') {\n    info += '\\nmimeType: ' + mimeType;\n  }\n\n  Array.prototype.slice.call(document.querySelectorAll('select')).forEach(function (select) {\n    info += '\\n' + (select.id || select.className) + ': ' + select.value;\n  });\n\n  if (btnStartRecording.recordRTC) {\n    info += '\\n\\ninternal-recorder: ' + btnStartRecording.recordRTC.getInternalRecorder().name;\n\n    if (btnStartRecording.recordRTC.getInternalRecorder().getAllStates) {\n      info += '\\n\\nrecorder-states: ' + btnStartRecording.recordRTC.getInternalRecorder().getAllStates();\n    }\n  }\n\n  if (btnStartRecording.stream) {\n    info += '\\n\\naudio-tracks: ' + getTracks(btnStartRecording.stream, 'audio').length;\n    info += '\\nvideo-tracks: ' + getTracks(btnStartRecording.stream, 'video').length;\n    info += '\\nstream-active? ' + !!btnStartRecording.stream.active;\n    btnStartRecording.stream.getTracks().forEach(function (track) {\n      info += '\\n' + track.kind + '-track-' + (track.label || track.id) + ': (enabled: ' + !!track.enabled + ', readyState: ' + track.readyState + ', muted: ' + !!track.muted + ')';\n\n      if (track.getConstraints && Object.keys(track.getConstraints()).length) {\n        info += '\\n' + track.kind + '-track-getConstraints: ' + stringify(track.getConstraints());\n      }\n\n      if (track.getSettings && Object.keys(track.getSettings()).length) {\n        info += '\\n' + track.kind + '-track-getSettings: ' + stringify(track.getSettings());\n      }\n    });\n  }\n\n  if (timeSlice && btnStartRecording.recordRTC) {\n    info += '\\ntimeSlice: ' + timeSlice;\n\n    if (btnStartRecording.recordRTC.getInternalRecorder().getArrayOfBlobs) {\n      var blobSizes = [];\n      btnStartRecording.recordRTC.getInternalRecorder().getArrayOfBlobs().forEach(function (blob) {\n        blobSizes.push(blob.size);\n      });\n      info += '\\nblobSizes: ' + blobSizes;\n    }\n  } else if (btnStartRecording.recordRTC && btnStartRecording.recordRTC.getBlob()) {\n    info += '\\n\\nblobSize: ' + bytesToSize(btnStartRecording.recordRTC.getBlob().size);\n  }\n\n  if (btnStartRecording.recordRTC && btnStartRecording.recordRTC.getInternalRecorder() && btnStartRecording.recordRTC.getInternalRecorder().getInternalRecorder && btnStartRecording.recordRTC.getInternalRecorder().getInternalRecorder()) {\n    info += '\\n\\ngetInternalRecorder: ' + mediaRecorderToStringify(btnStartRecording.recordRTC.getInternalRecorder().getInternalRecorder());\n  }\n\n  return info;\n}\n\nfunction saveToDiskOrOpenNewTab(recordRTC) {\n  if (!recordRTC.getBlob().size) {\n    var info = getFailureReport();\n    console.log('blob', recordRTC.getBlob());\n    console.log('recordrtc instance', recordRTC);\n    console.log('report', info);\n\n    if (mediaContainerFormat.value !== 'default') {\n      alert('RecordRTC seems failed recording using ' + mediaContainerFormat.value + '. Please choose \"default\" option from the drop down and record again.');\n    } else {\n      alert('RecordRTC seems failed. Unexpected issue. You can read the email in your console log. \\n\\nPlease report using disqus chat below.');\n    }\n\n    if (mediaContainerFormat.value !== 'vp9' && DetectRTC.browser.name === 'Chrome') {\n      alert('Please record using VP9 encoder. (select from the dropdown)');\n    }\n  }\n\n  var fileName = getFileName(fileExtension);\n  document.querySelector('#save-to-disk').parentNode.style.display = 'block';\n\n  document.querySelector('#save-to-disk').onclick = function () {\n    if (!recordRTC) return alert('No recording found.');\n    var file = new File([recordRTC.getBlob()], fileName, {\n      type: mimeType\n    });\n    invokeSaveAsDialog(file, file.name);\n  };\n\n  document.querySelector('#open-new-tab').onclick = function () {\n    if (!recordRTC) return alert('No recording found.');\n    var file = new File([recordRTC.getBlob()], fileName, {\n      type: mimeType\n    });\n    window.open(URL.createObjectURL(file));\n  }; // upload to PHP server\n\n\n  if (isMyOwnDomain()) {\n    document.querySelector('#upload-to-php').disabled = true;\n    document.querySelector('#upload-to-php').style.display = 'none';\n  } else {\n    document.querySelector('#upload-to-php').disabled = false;\n  }\n\n  document.querySelector('#upload-to-php').onclick = function () {\n    if (isMyOwnDomain()) {\n      alert('PHP Upload is not available on this domain.');\n      return;\n    }\n\n    if (!recordRTC) return alert('No recording found.');\n    this.disabled = true;\n    var button = this;\n    uploadToPHPServer(fileName, recordRTC, function (progress, fileURL) {\n      if (progress === 'ended') {\n        button.disabled = false;\n        button.innerHTML = 'Click to download from server';\n\n        button.onclick = function () {\n          SaveFileURLToDisk(fileURL, fileName);\n        };\n\n        setVideoURL(fileURL);\n        var html = 'Uploaded to PHP.<br>Download using below link:<br>';\n        html += '<a href=\"' + fileURL + '\" download=\"' + fileName + '\" style=\"color: yellow; display: block; margin-top: 15px;\">' + fileName + '</a>';\n        recordingPlayer.parentNode.parentNode.querySelector('h2').innerHTML = html;\n        return;\n      }\n\n      button.innerHTML = progress;\n      recordingPlayer.parentNode.parentNode.querySelector('h2').innerHTML = progress;\n    });\n  }; // upload to YouTube!\n\n\n  document.querySelector('#upload-to-youtube').disabled = false;\n\n  document.querySelector('#upload-to-youtube').onclick = function () {\n    if (!recordRTC) return alert('No recording found.');\n    this.disabled = true;\n\n    if (isLocalHost()) {\n      alert('This feature is NOT available on localhost.');\n      return;\n    }\n\n    if (isMyOwnDomain() === false) {\n      var url = 'https://github.com/muaz-khan/RecordRTC/wiki/Upload-to-YouTube';\n      alert('YouTube API key is configured to work only on webrtc-experiment.com. Please create your own YouTube key + oAuth client-id and use it instead.\\n\\nWiki page: ' + url); // check instructions on the wiki page\n\n      location.href = url;\n      return;\n    }\n\n    var button = this;\n    uploadToYouTube(fileName, recordRTC, function (percentageComplete, fileURL) {\n      if (percentageComplete == 'uploaded') {\n        button.disabled = false;\n        button.innerHTML = 'Uploaded. However YouTube is still processing.';\n\n        button.onclick = function () {\n          window.open(fileURL);\n        };\n\n        return;\n      }\n\n      if (percentageComplete == 'processed') {\n        button.disabled = false;\n        button.innerHTML = 'Uploaded & Processed. Click to open YouTube video.';\n\n        button.onclick = function () {\n          window.open(fileURL);\n        };\n\n        document.querySelector('h1').innerHTML = 'Your video has been uploaded.';\n        window.scrollTo(0, 0);\n        alert('Your video has been uploaded.');\n        return;\n      }\n\n      if (percentageComplete == 'failed') {\n        button.disabled = false;\n        button.innerHTML = 'YouTube failed transcoding the video.';\n\n        button.onclick = function () {\n          window.open(fileURL);\n        };\n\n        return;\n      }\n\n      button.innerHTML = percentageComplete + '% uploaded to YouTube.';\n    });\n  };\n}\n\nfunction uploadToPHPServer(fileName, recordRTC, callback) {\n  var blob = recordRTC instanceof Blob ? recordRTC : recordRTC.getBlob();\n  blob = new File([blob], getFileName(fileExtension), {\n    type: mimeType\n  }); // create FormData\n\n  var formData = new FormData();\n  formData.append('video-filename', fileName);\n  formData.append('video-blob', blob);\n  callback('Uploading recorded-file to server.'); // var upload_url = 'https://your-domain.com/files-uploader/';\n\n  var upload_url = 'RecordRTC-to-PHP/save.php'; // var upload_directory = upload_url;\n\n  var upload_directory = 'RecordRTC-to-PHP/uploads/';\n  makeXMLHttpRequest(upload_url, formData, function (progress) {\n    if (progress !== 'upload-ended') {\n      callback(progress);\n      return;\n    }\n\n    callback('ended', upload_directory + fileName);\n  });\n}\n\nfunction makeXMLHttpRequest(url, data, callback) {\n  var request = new XMLHttpRequest();\n\n  request.onreadystatechange = function () {\n    if (request.readyState == 4 && request.status == 200) {\n      if (request.responseText === 'success') {\n        callback('upload-ended');\n        return;\n      }\n\n      document.querySelector('.header').parentNode.style = 'text-align: left; color: red; padding: 5px 10px;';\n      document.querySelector('.header').parentNode.innerHTML = request.responseText;\n    }\n  };\n\n  request.upload.onloadstart = function () {\n    callback('Upload started...');\n  };\n\n  request.upload.onprogress = function (event) {\n    callback('Upload Progress ' + Math.round(event.loaded / event.total * 100) + \"%\");\n  };\n\n  request.upload.onload = function () {\n    callback('progress-about-to-end');\n  };\n\n  request.upload.onload = function () {\n    callback('Getting File URL..');\n  };\n\n  request.upload.onerror = function (error) {\n    callback('Failed to upload to server');\n  };\n\n  request.upload.onabort = function (error) {\n    callback('Upload aborted.');\n  };\n\n  request.open('POST', url);\n  request.send(data);\n}\n\nfunction getRandomString() {\n  if (window.crypto && window.crypto.getRandomValues && navigator.userAgent.indexOf('Safari') === -1) {\n    var a = window.crypto.getRandomValues(new Uint32Array(3)),\n        token = '';\n\n    for (var i = 0, l = a.length; i < l; i++) {\n      token += a[i].toString(36);\n    }\n\n    return token;\n  } else {\n    return (Math.random() * new Date().getTime()).toString(36).replace(/\\./g, '');\n  }\n}\n\nfunction getFileName(fileExtension) {\n  var d = new Date();\n  var year = d.getUTCFullYear();\n  var month = d.getUTCMonth();\n  var date = d.getUTCDate();\n  return 'RecordRTC-' + year + month + date + '-' + getRandomString() + '.' + fileExtension;\n}\n\nfunction SaveFileURLToDisk(fileUrl, fileName) {\n  var hyperlink = document.createElement('a');\n  hyperlink.href = fileUrl;\n  hyperlink.target = '_blank';\n  hyperlink.download = fileName || fileUrl;\n  (document.body || document.documentElement).appendChild(hyperlink);\n\n  hyperlink.onclick = function () {\n    (document.body || document.documentElement).removeChild(hyperlink); // required for Firefox\n\n    window.URL.revokeObjectURL(hyperlink.href);\n  };\n\n  var mouseEvent = new MouseEvent('click', {\n    view: window,\n    bubbles: true,\n    cancelable: true\n  });\n  hyperlink.dispatchEvent(mouseEvent);\n}\n\nfunction getURL(arg) {\n  var url = arg;\n\n  if (arg instanceof Blob || arg instanceof File) {\n    url = URL.createObjectURL(arg);\n  }\n\n  if (arg instanceof RecordRTC || arg.getBlob) {\n    url = URL.createObjectURL(arg.getBlob());\n  }\n\n  if (arg instanceof MediaStream || arg.getTracks) {// url = URL.createObjectURL(arg);\n  }\n\n  return url;\n}\n\nfunction setVideoURL(arg, forceNonImage) {\n  var url = getURL(arg);\n  var parentNode = recordingPlayer.parentNode;\n  parentNode.removeChild(recordingPlayer);\n  parentNode.innerHTML = '';\n  var elem = 'video';\n\n  if (type == 'gif' && !forceNonImage) {\n    elem = 'img';\n  }\n\n  if (type == 'audio') {\n    elem = 'audio';\n  }\n\n  recordingPlayer = document.createElement(elem);\n\n  if (arg instanceof MediaStream) {\n    recordingPlayer.muted = true;\n  }\n\n  recordingPlayer.addEventListener('loadedmetadata', function () {\n    if (navigator.userAgent.toLowerCase().indexOf('android') == -1) return; // android\n\n    setTimeout(function () {\n      if (typeof recordingPlayer.play === 'function') {\n        recordingPlayer.play();\n      }\n    }, 2000);\n  }, false);\n  recordingPlayer.poster = '';\n\n  if (arg instanceof MediaStream) {\n    recordingPlayer.srcObject = arg;\n  } else {\n    recordingPlayer.src = url;\n  }\n\n  if (typeof recordingPlayer.play === 'function') {\n    recordingPlayer.play();\n  }\n\n  recordingPlayer.addEventListener('ended', function () {\n    url = getURL(arg);\n\n    if (arg instanceof MediaStream) {\n      recordingPlayer.srcObject = arg;\n    } else {\n      recordingPlayer.src = url;\n    }\n  });\n  parentNode.appendChild(recordingPlayer);\n}\n\nfunction captureScreen(config) {\n  if (navigator.getDisplayMedia) {\n    navigator.getDisplayMedia({\n      video: true\n    }).then(screenStream => {\n      config.onMediaCaptured(screenStream);\n      addStreamStopListener(screenStream, function () {\n        // config.onMediaStopped();\n        btnStartRecording.onclick();\n      });\n      setVideoURL(screenStream, true);\n    }).catch(function (error) {\n      config.onMediaCapturingFailed(error);\n    });\n  } else if (navigator.mediaDevices.getDisplayMedia) {\n    navigator.mediaDevices.getDisplayMedia({\n      video: true\n    }).then(screenStream => {\n      config.onMediaCaptured(screenStream);\n      addStreamStopListener(screenStream, function () {\n        // config.onMediaStopped();\n        btnStartRecording.onclick();\n      });\n      setVideoURL(screenStream, true);\n    }).catch(function (error) {\n      config.onMediaCapturingFailed(error);\n    });\n  } else {\n    var error = 'getDisplayMedia API are not supported in this browser.';\n    config.onMediaCapturingFailed(error);\n    alert(error);\n  }\n}\n\nfunction captureAudioPlusScreen(config) {\n  if (navigator.getDisplayMedia) {\n    navigator.getDisplayMedia({\n      video: true\n    }).then(screenStream => {\n      navigator.mediaDevices.getUserMedia({\n        audio: true\n      }).then(function (mic) {\n        screenStream.addTrack(mic.getTracks()[0]);\n        config.onMediaCaptured(screenStream);\n        addStreamStopListener(screenStream, function () {\n          // config.onMediaStopped();\n          btnStartRecording.onclick();\n        });\n        setVideoURL(screenStream, true);\n      });\n    }).catch(function (error) {\n      config.onMediaCapturingFailed(error);\n    });\n  } else if (navigator.mediaDevices.getDisplayMedia) {\n    navigator.mediaDevices.getDisplayMedia({\n      video: true\n    }).then(screenStream => {\n      navigator.mediaDevices.getUserMedia({\n        audio: true\n      }).then(function (mic) {\n        screenStream.addTrack(mic.getTracks()[0]);\n        config.onMediaCaptured(screenStream);\n        addStreamStopListener(screenStream, function () {\n          // config.onMediaStopped();\n          btnStartRecording.onclick();\n        });\n        setVideoURL(screenStream, true);\n      });\n    }).catch(function (error) {\n      config.onMediaCapturingFailed(error);\n    });\n  } else {\n    var error = 'getDisplayMedia API are not supported in this browser.';\n    config.onMediaCapturingFailed(error);\n    alert(error);\n  }\n}\n\nfunction uploadToYouTube(fileName, recordRTC, callback) {\n  var blob = recordRTC instanceof Blob ? recordRTC : recordRTC.getBlob();\n  blob = new File([blob], getFileName(fileExtension), {\n    type: mimeType\n  });\n\n  if (!uploadVideo) {\n    alert('YouTube API are not available.');\n    return;\n  }\n\n  uploadVideo.callback = callback;\n  uploadVideo.uploadFile(fileName, blob);\n}\n\nvar uploadVideo;\n\nvar signinCallback = function (result) {\n  if (result.access_token) {\n    uploadVideo = new UploadVideo();\n    uploadVideo.ready(result.access_token);\n    document.querySelector('#signinButton').style.display = 'none';\n  } else {// console.error('YouTube error', result);\n    // document.querySelector('#upload-to-youtube').style.display = 'none';\n  }\n};\n\nvar STATUS_POLLING_INTERVAL_MILLIS = 60 * 1000; // One minute.\n\nvar UploadVideo = function () {\n  this.tags = ['recordrtc'];\n  this.categoryId = 28; // via: http://stackoverflow.com/a/35877512/552182\n\n  this.videoId = '';\n  this.uploadStartTime = 0;\n};\n\nUploadVideo.prototype.ready = function (accessToken) {\n  this.accessToken = accessToken;\n  this.gapi = gapi;\n  this.authenticated = true;\n  false && this.gapi.client.request({\n    path: '/youtube/v3/channels',\n    params: {\n      part: 'snippet',\n      mine: true\n    },\n    callback: function (response) {\n      if (!response.error) {// response.items[0].snippet.title -- channel title\n        // response.items[0].snippet.thumbnails.default.url -- channel thumbnail\n      }\n    }.bind(this)\n  });\n};\n\nUploadVideo.prototype.uploadFile = function (fileName, file) {\n  var metadata = {\n    snippet: {\n      title: fileName,\n      description: fileName,\n      tags: this.tags,\n      categoryId: this.categoryId\n    },\n    status: {\n      privacyStatus: 'public'\n    }\n  };\n  var uploader = new MediaUploader({\n    baseUrl: 'https://www.googleapis.com/upload/youtube/v3/videos',\n    file: file,\n    token: this.accessToken,\n    metadata: metadata,\n    params: {\n      part: Object.keys(metadata).join(',')\n    },\n    onError: function (data) {\n      var message = data;\n\n      try {\n        var errorResponse = JSON.parse(data);\n        message = errorResponse.error.message;\n      } finally {\n        alert(message);\n      }\n    }.bind(this),\n    onProgress: function (data) {\n      var bytesUploaded = data.loaded;\n      var totalBytes = parseInt(data.total);\n      var percentageComplete = parseInt(bytesUploaded * 100 / totalBytes);\n      uploadVideo.callback(percentageComplete);\n    }.bind(this),\n    onComplete: function (data) {\n      var uploadResponse = JSON.parse(data);\n      this.videoId = uploadResponse.id;\n      this.videoURL = 'https://www.youtube.com/watch?v=' + this.videoId;\n      uploadVideo.callback('uploaded', this.videoURL);\n      setTimeout(this.pollForVideoStatus, 2000);\n    }.bind(this)\n  });\n  this.uploadStartTime = Date.now();\n  uploader.upload();\n};\n\nUploadVideo.prototype.pollForVideoStatus = function () {\n  this.gapi.client.request({\n    path: '/youtube/v3/videos',\n    params: {\n      part: 'status,player',\n      id: this.videoId\n    },\n    callback: function (response) {\n      if (response.error) {\n        uploadVideo.pollForVideoStatus();\n      } else {\n        var uploadStatus = response.items[0].status.uploadStatus;\n\n        switch (uploadStatus) {\n          case 'uploaded':\n            uploadVideo.callback('uploaded', uploadVideo.videoURL);\n            uploadVideo.pollForVideoStatus();\n            break;\n\n          case 'processed':\n            uploadVideo.callback('processed', uploadVideo.videoURL);\n            break;\n\n          default:\n            uploadVideo.callback('failed', uploadVideo.videoURL);\n            break;\n        }\n      }\n    }.bind(this)\n  });\n};\n\nvar DRIVE_UPLOAD_URL = 'https://www.googleapis.com/upload/drive/v2/files/';\n\nvar RetryHandler = function () {\n  this.interval = 1000; // Start at one second\n\n  this.maxInterval = 60 * 1000; // Don't wait longer than a minute\n};\n\nRetryHandler.prototype.retry = function (fn) {\n  setTimeout(fn, this.interval);\n  this.interval = this.nextInterval_();\n};\n\nRetryHandler.prototype.reset = function () {\n  this.interval = 1000;\n};\n\nRetryHandler.prototype.nextInterval_ = function () {\n  var interval = this.interval * 2 + this.getRandomInt_(0, 1000);\n  return Math.min(interval, this.maxInterval);\n};\n\nRetryHandler.prototype.getRandomInt_ = function (min, max) {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n};\n\nvar MediaUploader = function (options) {\n  var noop = function () {};\n\n  this.file = options.file;\n  this.contentType = options.contentType || this.file.type || 'application/octet-stream';\n  this.metadata = options.metadata || {\n    'title': this.file.name,\n    'mimeType': this.contentType\n  };\n  this.token = options.token;\n  this.onComplete = options.onComplete || noop;\n  this.onProgress = options.onProgress || noop;\n  this.onError = options.onError || noop;\n  this.offset = options.offset || 0;\n  this.chunkSize = options.chunkSize || 0;\n  this.retryHandler = new RetryHandler();\n  this.url = options.url;\n\n  if (!this.url) {\n    var params = options.params || {};\n    params.uploadType = 'resumable';\n    this.url = this.buildUrl_(options.fileId, params, options.baseUrl);\n  }\n\n  this.httpMethod = options.fileId ? 'PUT' : 'POST';\n};\n\nMediaUploader.prototype.upload = function () {\n  var self = this;\n  var xhr = new XMLHttpRequest();\n  xhr.open(this.httpMethod, this.url, true);\n  xhr.setRequestHeader('Authorization', 'Bearer ' + this.token);\n  xhr.setRequestHeader('Content-Type', 'application/json');\n  xhr.setRequestHeader('X-Upload-Content-Length', this.file.size);\n  xhr.setRequestHeader('X-Upload-Content-Type', this.contentType);\n\n  xhr.onload = function (e) {\n    if (e.target.status < 400) {\n      var location = e.target.getResponseHeader('Location');\n      this.url = location;\n      this.sendFile_();\n    } else {\n      this.onUploadError_(e);\n    }\n  }.bind(this);\n\n  xhr.onerror = this.onUploadError_.bind(this);\n  xhr.send(JSON.stringify(this.metadata));\n};\n\nMediaUploader.prototype.sendFile_ = function () {\n  var content = this.file;\n  var end = this.file.size;\n\n  if (this.offset || this.chunkSize) {\n    // Only bother to slice the file if we're either resuming or uploading in chunks\n    if (this.chunkSize) {\n      end = Math.min(this.offset + this.chunkSize, this.file.size);\n    }\n\n    content = content.slice(this.offset, end);\n  }\n\n  var xhr = new XMLHttpRequest();\n  xhr.open('PUT', this.url, true);\n  xhr.setRequestHeader('Content-Type', this.contentType);\n  xhr.setRequestHeader('Content-Range', 'bytes ' + this.offset + '-' + (end - 1) + '/' + this.file.size);\n  xhr.setRequestHeader('X-Upload-Content-Type', this.file.type);\n\n  if (xhr.upload) {\n    xhr.upload.addEventListener('progress', this.onProgress);\n  }\n\n  xhr.onload = this.onContentUploadSuccess_.bind(this);\n  xhr.onerror = this.onContentUploadError_.bind(this);\n  xhr.send(content);\n};\n\nMediaUploader.prototype.resume_ = function () {\n  var xhr = new XMLHttpRequest();\n  xhr.open('PUT', this.url, true);\n  xhr.setRequestHeader('Content-Range', 'bytes */' + this.file.size);\n  xhr.setRequestHeader('X-Upload-Content-Type', this.file.type);\n\n  if (xhr.upload) {\n    xhr.upload.addEventListener('progress', this.onProgress);\n  }\n\n  xhr.onload = this.onContentUploadSuccess_.bind(this);\n  xhr.onerror = this.onContentUploadError_.bind(this);\n  xhr.send();\n};\n\nMediaUploader.prototype.extractRange_ = function (xhr) {\n  var range = xhr.getResponseHeader('Range');\n\n  if (range) {\n    this.offset = parseInt(range.match(/\\d+/g).pop(), 10) + 1;\n  }\n};\n\nMediaUploader.prototype.onContentUploadSuccess_ = function (e) {\n  if (e.target.status == 200 || e.target.status == 201) {\n    this.onComplete(e.target.response);\n  } else if (e.target.status == 308) {\n    this.extractRange_(e.target);\n    this.retryHandler.reset();\n    this.sendFile_();\n  }\n};\n\nMediaUploader.prototype.onContentUploadError_ = function (e) {\n  if (e.target.status && e.target.status < 500) {\n    this.onError(e.target.response);\n  } else {\n    this.retryHandler.retry(this.resume_.bind(this));\n  }\n};\n\nMediaUploader.prototype.onUploadError_ = function (e) {\n  this.onError(e.target.response); // TODO - Retries for initial upload\n};\n\nMediaUploader.prototype.buildQuery_ = function (params) {\n  params = params || {};\n  return Object.keys(params).map(function (key) {\n    return encodeURIComponent(key) + '=' + encodeURIComponent(params[key]);\n  }).join('&');\n};\n\nMediaUploader.prototype.buildUrl_ = function (id, params, baseUrl) {\n  var url = baseUrl || DRIVE_UPLOAD_URL;\n\n  if (id) {\n    url += id;\n  }\n\n  var query = this.buildQuery_(params);\n\n  if (query) {\n    url += '?' + query;\n  }\n\n  return url;\n};\n\nvar chkFixSeeking = document.querySelector('#chk-fixSeeking');\n\nchkFixSeeking.onchange = function () {\n  if (this.checked === true) {\n    localStorage.setItem(this.id, 'true');\n  } else {\n    localStorage.removeItem(this.id);\n  }\n};\n\nif (localStorage.getItem(chkFixSeeking.id) === 'true') {\n  chkFixSeeking.checked = true;\n}\n\nvar chkTimeSlice = document.querySelector('#chk-timeSlice');\nvar timeSlice = false;\n\nif (typeof MediaRecorder === 'undefined') {\n  chkTimeSlice.disabled = true;\n}\n\nchkTimeSlice.addEventListener('change', function () {\n  if (chkTimeSlice.checked === true) {\n    var _timeSlice = prompt('Please enter timeSlice in milliseconds e.g. 1000 or 2000 or 3000.', 1000);\n\n    _timeSlice = parseInt(_timeSlice);\n\n    if (!_timeSlice || _timeSlice == NaN || typeof _timeSlice === 'undefined') {\n      timeSlice = false;\n      return;\n    }\n\n    timeSlice = _timeSlice;\n  } else {\n    timeSlice = false;\n  }\n}, false);\nvar btnPauseRecording = document.querySelector('#btn-pause-recording');\n\nbtnPauseRecording.onclick = function () {\n  if (!btnStartRecording.recordRTC) {\n    btnPauseRecording.style.display = 'none';\n    return;\n  }\n\n  btnPauseRecording.disabled = true;\n\n  if (btnPauseRecording.innerHTML === 'Pause') {\n    btnStartRecording.disabled = true;\n    chkFixSeeking.parentNode.style.display = 'none';\n    btnStartRecording.style.fontSize = '15px';\n    btnStartRecording.recordRTC.pauseRecording();\n    recordingPlayer.parentNode.parentNode.querySelector('h2').innerHTML = 'Recording status: paused';\n    recordingPlayer.pause();\n    btnPauseRecording.style.fontSize = 'inherit';\n    setTimeout(function () {\n      btnPauseRecording.innerHTML = 'Resume Recording';\n      btnPauseRecording.disabled = false;\n    }, 2000);\n  }\n\n  if (btnPauseRecording.innerHTML === 'Resume Recording') {\n    btnStartRecording.disabled = false;\n    chkFixSeeking.parentNode.style.display = 'none';\n    btnStartRecording.style.fontSize = 'inherit';\n    btnStartRecording.recordRTC.resumeRecording();\n    recordingPlayer.parentNode.parentNode.querySelector('h2').innerHTML = '<img src=\"https://cdn.webrtc-experiment.com/images/progress.gif\">';\n    recordingPlayer.play();\n    btnPauseRecording.style.fontSize = '15px';\n    btnPauseRecording.innerHTML = 'Pause';\n    setTimeout(function () {\n      btnPauseRecording.disabled = false;\n    }, 2000);\n  }\n};","map":{"version":3,"sources":["imports/ui/pages/this/this.js"],"names":["module","link","ReactiveVar","v","Template","App_video","helpers","addStreamStopListener","stream","callback","addEventListener","getTracks","forEach","track","video","document","createElement","controls","mediaElement","getHTMLMediaElement","title","buttons","showOnMouseEnter","width","onTakeSnapshot","canvas","clientWidth","height","clientHeight","context","getContext","drawImage","recordingPlayer","window","open","toDataURL","getElementById","appendChild","div","media","parentNode","muted","autoplay","playsinline","recordingMedia","querySelector","mediaContainerFormat","mimeType","fileExtension","type","recorderType","defaultWidth","defaultHeight","btnStartRecording","onbeforeunload","disabled","chkFixSeeking","style","display","onclick","event","button","innerHTML","btnPauseRecording","disableStateWaiting","setTimeout","stopStream","stop","Array","videoBitsPerSecond","html","bytesToSize","recordRTC","getBlob","size","length","stopRecording","url","recordingEndedCallback","saveToDiskOrOpenNewTab","blobs","blob","File","getFileName","URL","createObjectURL","checked","getSeekableBlob","seekableBlob","commonConfig","onMediaCaptured","mediaCapturedCallback","onMediaStopped","onMediaCapturingFailed","error","console","toString","indexOf","alert","name","DetectRTC","browser","value","isMimeTypeSupported","StereoAudioRecorder","WhammyRecorder","WebAssemblyRecorder","GifRecorder","captureAudio","options","leftChannel","params","disableLogs","sampleRate","parseInt","bufferSize","numberOfAudioChannels","ignoreMutedMedia","RecordRTC","setVideoURL","startRecording","captureAudioPlusVideo","MediaRecorder","frameInterval","audioRecorder","videoRecorder","initRecorder","push","audio","Audio","src","toURL","paused","play","getNativeBlob","timeSlice","ondataavailable","captureScreen","captureAudioPlusScreen","captureVideo","config","captureUserMedia","videoStream","audioStream","audioVideoStream","MY_DOMAIN","isMyOwnDomain","domain","isLocalHost","setVideoBitrates","select","getFrameRates","mediaConstraints","frameRate","mandatory","optional","isScreen","toLowerCase","maxFrameRate","minFrameRate","setGetFromLocalStorage","selectors","selector","storageItem","replace","localStorage","getItem","addEventListenerToUploadLocalStorageItem","setItem","arr","getVideoResolutions","split","maxWidth","maxHeight","minWidth","minHeight","successCallback","errorCallback","isBlackBerry","test","navigator","userAgent","getUserMedia","webkitGetUserMedia","mozGetUserMedia","mediaDevices","then","catch","message","setMediaContainerFormat","arrayOfOptionsSupported","prototype","slice","call","querySelectorAll","localStorageItem","selectedItem","option","selected","isTypeSupported","onchange","recordingOptions","isChrome","chrome","opera","warn","stringify","obj","result","Object","keys","key","mediaRecorderToStringify","mediaRecorder","state","audioBitsPerSecond","id","active","getFailureReport","info","osName","osVersion","className","getInternalRecorder","getAllStates","kind","label","enabled","readyState","getConstraints","getSettings","getArrayOfBlobs","blobSizes","log","fileName","file","invokeSaveAsDialog","uploadToPHPServer","progress","fileURL","SaveFileURLToDisk","location","href","uploadToYouTube","percentageComplete","scrollTo","Blob","formData","FormData","append","upload_url","upload_directory","makeXMLHttpRequest","data","request","XMLHttpRequest","onreadystatechange","status","responseText","upload","onloadstart","onprogress","Math","round","loaded","total","onload","onerror","onabort","send","getRandomString","crypto","getRandomValues","a","Uint32Array","token","i","l","random","Date","getTime","d","year","getUTCFullYear","month","getUTCMonth","date","getUTCDate","fileUrl","hyperlink","target","download","body","documentElement","removeChild","revokeObjectURL","mouseEvent","MouseEvent","view","bubbles","cancelable","dispatchEvent","getURL","arg","MediaStream","forceNonImage","elem","poster","srcObject","getDisplayMedia","screenStream","mic","addTrack","uploadVideo","uploadFile","signinCallback","access_token","UploadVideo","ready","STATUS_POLLING_INTERVAL_MILLIS","tags","categoryId","videoId","uploadStartTime","accessToken","gapi","authenticated","client","path","part","mine","response","bind","metadata","snippet","description","privacyStatus","uploader","MediaUploader","baseUrl","join","onError","errorResponse","JSON","parse","onProgress","bytesUploaded","totalBytes","onComplete","uploadResponse","videoURL","pollForVideoStatus","now","uploadStatus","items","DRIVE_UPLOAD_URL","RetryHandler","interval","maxInterval","retry","fn","nextInterval_","reset","getRandomInt_","min","max","floor","noop","contentType","offset","chunkSize","retryHandler","uploadType","buildUrl_","fileId","httpMethod","self","xhr","setRequestHeader","e","getResponseHeader","sendFile_","onUploadError_","content","end","onContentUploadSuccess_","onContentUploadError_","resume_","extractRange_","range","match","pop","buildQuery_","map","encodeURIComponent","query","removeItem","chkTimeSlice","_timeSlice","prompt","NaN","fontSize","pauseRecording","pause","resumeRecording"],"mappings":"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","sourcesContent":["import './about.html';\r\n\r\nimport { ReactiveVar } from 'meteor/reactive-var';\r\n\r\n\r\n// (function() {\r\n//     var params = {},\r\n//         r = /([^&=]+)=?([^&]*)/g;\r\n//\r\n//     function d(s) {\r\n//         return decodeURIComponent(s.replace(/\\+/g, ' '));\r\n//     }\r\n//\r\n//     var match, search = window.location.search;\r\n//     while (match = r.exec(search.substring(1))) {\r\n//         params[d(match[1])] = d(match[2]);\r\n//\r\n//         if(d(match[2]) === 'true' || d(match[2]) === 'false') {\r\n//             params[d(match[1])] = d(match[2]) === 'true' ? true : false;\r\n//         }\r\n//     }\r\n//\r\n//     window.params = params;\r\n// })();\r\nTemplate.App_video.helpers({});\r\nfunction addStreamStopListener(stream, callback) {\r\n    stream.addEventListener('ended', function() {\r\n        callback();\r\n        callback = function() {};\r\n    }, false);\r\n    stream.addEventListener('inactive', function() {\r\n        callback();\r\n        callback = function() {};\r\n    }, false);\r\n    stream.getTracks().forEach(function(track) {\r\n        track.addEventListener('ended', function() {\r\n            callback();\r\n            callback = function() {};\r\n        }, false);\r\n        track.addEventListener('inactive', function() {\r\n            callback();\r\n            callback = function() {};\r\n        }, false);\r\n    });\r\n}\r\nvar video = document.createElement('video');\r\nvideo.controls = false;\r\nvar mediaElement = getHTMLMediaElement(video, {\r\n    title: 'Recording status: inactive',\r\n    buttons: ['full-screen'/*, 'take-snapshot'*/],\r\n    showOnMouseEnter: false,\r\n    width: 360,\r\n    onTakeSnapshot: function() {\r\n        var canvas = document.createElement('canvas');\r\n        canvas.width = mediaElement.clientWidth;\r\n        canvas.height = mediaElement.clientHeight;\r\n\r\n        var context = canvas.getContext('2d');\r\n        context.drawImage(recordingPlayer, 0, 0, canvas.width, canvas.height);\r\n\r\n        window.open(canvas.toDataURL('image/png'));\r\n    }\r\n});\r\ndocument.getElementById('recording-player').appendChild(mediaElement);\r\n\r\nvar div = document.createElement('section');\r\nmediaElement.media.parentNode.appendChild(div);\r\nmediaElement.media.muted = false;\r\nmediaElement.media.autoplay = true;\r\nmediaElement.media.playsinline = true;\r\ndiv.appendChild(mediaElement.media);\r\n\r\nvar recordingPlayer = mediaElement.media;\r\nvar recordingMedia = document.querySelector('.recording-media');\r\nvar mediaContainerFormat = document.querySelector('.media-container-format');\r\nvar mimeType = 'video/webm';\r\nvar fileExtension = 'webm';\r\nvar type = 'video';\r\nvar recorderType;\r\nvar defaultWidth;\r\nvar defaultHeight;\r\n\r\nvar btnStartRecording = document.querySelector('#btn-start-recording');\r\n\r\nwindow.onbeforeunload = function() {\r\n    btnStartRecording.disabled = false;\r\n    recordingMedia.disabled = false;\r\n    mediaContainerFormat.disabled = false;\r\n\r\n    chkFixSeeking.parentNode.style.display = 'inline-block';\r\n};\r\n\r\nbtnStartRecording.onclick = function(event) {\r\n    var button = btnStartRecording;\r\n\r\n    if(button.innerHTML === 'Stop Recording') {\r\n        btnPauseRecording.style.display = 'none';\r\n        button.disabled = true;\r\n        button.disableStateWaiting = true;\r\n        setTimeout(function() {\r\n            button.disabled = false;\r\n            button.disableStateWaiting = false;\r\n        }, 2000);\r\n\r\n        button.innerHTML = 'Start Recording';\r\n\r\n        function stopStream() {\r\n            if(button.stream && button.stream.stop) {\r\n                button.stream.stop();\r\n                button.stream = null;\r\n            }\r\n\r\n            if(button.stream instanceof Array) {\r\n                button.stream.forEach(function(stream) {\r\n                    stream.stop();\r\n                });\r\n                button.stream = null;\r\n            }\r\n\r\n            videoBitsPerSecond = null;\r\n            var html = 'Recording status: stopped';\r\n            html += '<br>Size: ' + bytesToSize(button.recordRTC.getBlob().size);\r\n            recordingPlayer.parentNode.parentNode.querySelector('h2').innerHTML = html;\r\n        }\r\n\r\n        if(button.recordRTC) {\r\n            if(button.recordRTC.length) {\r\n                button.recordRTC[0].stopRecording(function(url) {\r\n                    if(!button.recordRTC[1]) {\r\n                        button.recordingEndedCallback(url);\r\n                        stopStream();\r\n\r\n                        saveToDiskOrOpenNewTab(button.recordRTC[0]);\r\n                        return;\r\n                    }\r\n\r\n                    button.recordRTC[1].stopRecording(function(url) {\r\n                        button.recordingEndedCallback(url);\r\n                        stopStream();\r\n                    });\r\n                });\r\n            }\r\n            else {\r\n                button.recordRTC.stopRecording(function(url) {\r\n                    if(button.blobs && button.blobs.length) {\r\n                        var blob = new File(button.blobs, getFileName(fileExtension), {\r\n                            type: mimeType\r\n                        });\r\n\r\n                        button.recordRTC.getBlob = function() {\r\n                            return blob;\r\n                        };\r\n\r\n                        url = URL.createObjectURL(blob);\r\n                    }\r\n\r\n                    if(chkFixSeeking.checked === true) {\r\n                        // to fix video seeking issues\r\n                        getSeekableBlob(button.recordRTC.getBlob(), function(seekableBlob) {\r\n                            button.recordRTC.getBlob = function() {\r\n                                return seekableBlob;\r\n                            };\r\n\r\n                            url = URL.createObjectURL(seekableBlob);\r\n\r\n                            button.recordingEndedCallback(url);\r\n                            saveToDiskOrOpenNewTab(button.recordRTC);\r\n                            stopStream();\r\n                        })\r\n                        return;\r\n                    }\r\n\r\n                    button.recordingEndedCallback(url);\r\n                    saveToDiskOrOpenNewTab(button.recordRTC);\r\n                    stopStream();\r\n                });\r\n            }\r\n        }\r\n        return;\r\n    }\r\n    if(!event) return;\r\n\r\n    button.disabled = true;\r\n\r\n    var commonConfig = {\r\n        onMediaCaptured: function(stream) {\r\n            button.stream = stream;\r\n            if(button.mediaCapturedCallback) {\r\n                button.mediaCapturedCallback();\r\n            }\r\n\r\n            button.innerHTML = 'Stop Recording';\r\n            button.disabled = false;\r\n\r\n            chkFixSeeking.parentNode.style.display = 'none';\r\n        },\r\n        onMediaStopped: function() {\r\n            button.innerHTML = 'Start Recording';\r\n\r\n            if(!button.disableStateWaiting) {\r\n                button.disabled = false;\r\n            }\r\n\r\n            chkFixSeeking.parentNode.style.display = 'inline-block';\r\n        },\r\n        onMediaCapturingFailed: function(error) {\r\n            console.error('onMediaCapturingFailed:', error);\r\n\r\n            if(error.toString().indexOf('no audio or video tracks available') !== -1) {\r\n                alert('RecordRTC failed to start because there are no audio or video tracks available.');\r\n            }\r\n\r\n            if(error.name === 'PermissionDeniedError' && DetectRTC.browser.name === 'Firefox') {\r\n                alert('Firefox requires version >= 52. Firefox also requires HTTPs.');\r\n            }\r\n\r\n            commonConfig.onMediaStopped();\r\n        }\r\n    };\r\n\r\n    if(mediaContainerFormat.value === 'h264') {\r\n        mimeType = 'video/webm\\;codecs=h264';\r\n        fileExtension = 'mp4';\r\n\r\n        // video/mp4;codecs=avc1\r\n        if(isMimeTypeSupported('video/mpeg')) {\r\n            mimeType = 'video/mpeg';\r\n        }\r\n    }\r\n\r\n    if(mediaContainerFormat.value === 'mkv' && isMimeTypeSupported('video/x-matroska;codecs=avc1')) {\r\n        mimeType = 'video/x-matroska;codecs=avc1';\r\n        fileExtension = 'mkv';\r\n    }\r\n\r\n    if(mediaContainerFormat.value === 'vp8' && isMimeTypeSupported('video/webm\\;codecs=vp8')) {\r\n        mimeType = 'video/webm\\;codecs=vp8';\r\n        fileExtension = 'webm';\r\n        recorderType = null;\r\n        type = 'video';\r\n    }\r\n\r\n    if(mediaContainerFormat.value === 'vp9' && isMimeTypeSupported('video/webm\\;codecs=vp9')) {\r\n        mimeType = 'video/webm\\;codecs=vp9';\r\n        fileExtension = 'webm';\r\n        recorderType = null;\r\n        type = 'video';\r\n    }\r\n\r\n    if(mediaContainerFormat.value === 'pcm') {\r\n        mimeType = 'audio/wav';\r\n        fileExtension = 'wav';\r\n        recorderType = StereoAudioRecorder;\r\n        type = 'audio';\r\n    }\r\n\r\n    if(mediaContainerFormat.value === 'opus' || mediaContainerFormat.value === 'ogg') {\r\n        if(isMimeTypeSupported('audio/webm')) {\r\n            mimeType = 'audio/webm';\r\n            fileExtension = 'webm'; // webm\r\n        }\r\n\r\n        if(isMimeTypeSupported('audio/ogg')) {\r\n            mimeType = 'audio/ogg; codecs=opus';\r\n            fileExtension = 'ogg'; // ogg\r\n        }\r\n\r\n        recorderType = null;\r\n        type = 'audio';\r\n    }\r\n\r\n    if(mediaContainerFormat.value === 'whammy') {\r\n        mimeType = 'video/webm';\r\n        fileExtension = 'webm';\r\n        recorderType = WhammyRecorder;\r\n        type = 'video';\r\n    }\r\n\r\n    if(mediaContainerFormat.value === 'WebAssembly') {\r\n        mimeType = 'video/webm';\r\n        fileExtension = 'webm';\r\n        recorderType = WebAssemblyRecorder;\r\n        type = 'video';\r\n    }\r\n\r\n    if(mediaContainerFormat.value === 'gif') {\r\n        mimeType = 'image/gif';\r\n        fileExtension = 'gif';\r\n        recorderType = GifRecorder;\r\n        type = 'gif';\r\n    }\r\n\r\n    if(mediaContainerFormat.value === 'default') {\r\n        mimeType = 'video/webm';\r\n        fileExtension = 'webm';\r\n        recorderType = null;\r\n        type = 'video';\r\n    }\r\n\r\n    if(recordingMedia.value === 'record-audio') {\r\n        captureAudio(commonConfig);\r\n\r\n        button.mediaCapturedCallback = function() {\r\n            var options = {\r\n                type: type,\r\n                mimeType: mimeType,\r\n                leftChannel: params.leftChannel || false,\r\n                disableLogs: params.disableLogs || false\r\n            };\r\n\r\n            if(params.sampleRate) {\r\n                options.sampleRate = parseInt(params.sampleRate);\r\n            }\r\n\r\n            if(params.bufferSize) {\r\n                options.bufferSize = parseInt(params.bufferSize);\r\n            }\r\n\r\n            if(recorderType) {\r\n                options.recorderType = recorderType;\r\n            }\r\n\r\n            if(videoBitsPerSecond) {\r\n                options.videoBitsPerSecond = videoBitsPerSecond;\r\n            }\r\n\r\n            if(DetectRTC.browser.name === 'Edge') {\r\n                options.numberOfAudioChannels = 1;\r\n            }\r\n\r\n            options.ignoreMutedMedia = false;\r\n            button.recordRTC = RecordRTC(button.stream, options);\r\n\r\n            button.recordingEndedCallback = function(url) {\r\n                setVideoURL(url);\r\n            };\r\n\r\n            button.recordRTC.startRecording();\r\n            btnPauseRecording.style.display = '';\r\n        };\r\n    }\r\n\r\n    if(recordingMedia.value === 'record-audio-plus-video') {\r\n        captureAudioPlusVideo(commonConfig);\r\n\r\n        button.mediaCapturedCallback = function() {\r\n            if(typeof MediaRecorder === 'undefined') { // opera or chrome etc.\r\n                button.recordRTC = [];\r\n\r\n                if(!params.bufferSize) {\r\n                    // it fixes audio issues whilst recording 720p\r\n                    params.bufferSize = 16384;\r\n                }\r\n\r\n                var options = {\r\n                    type: 'audio', // hard-code to set \"audio\"\r\n                    leftChannel: params.leftChannel || false,\r\n                    disableLogs: params.disableLogs || false,\r\n                    video: recordingPlayer\r\n                };\r\n\r\n                if(params.sampleRate) {\r\n                    options.sampleRate = parseInt(params.sampleRate);\r\n                }\r\n\r\n                if(params.bufferSize) {\r\n                    options.bufferSize = parseInt(params.bufferSize);\r\n                }\r\n\r\n                if(params.frameInterval) {\r\n                    options.frameInterval = parseInt(params.frameInterval);\r\n                }\r\n\r\n                if(recorderType) {\r\n                    options.recorderType = recorderType;\r\n                }\r\n\r\n                if(videoBitsPerSecond) {\r\n                    options.videoBitsPerSecond = videoBitsPerSecond;\r\n                }\r\n\r\n                options.ignoreMutedMedia = false;\r\n                var audioRecorder = RecordRTC(button.stream, options);\r\n\r\n                options.type = type;\r\n                var videoRecorder = RecordRTC(button.stream, options);\r\n\r\n                // to sync audio/video playbacks in browser!\r\n                videoRecorder.initRecorder(function() {\r\n                    audioRecorder.initRecorder(function() {\r\n                        audioRecorder.startRecording();\r\n                        videoRecorder.startRecording();\r\n                        btnPauseRecording.style.display = '';\r\n                    });\r\n                });\r\n\r\n                button.recordRTC.push(audioRecorder, videoRecorder);\r\n\r\n                button.recordingEndedCallback = function() {\r\n                    var audio = new Audio();\r\n                    audio.src = audioRecorder.toURL();\r\n                    audio.controls = true;\r\n                    audio.autoplay = true;\r\n\r\n                    recordingPlayer.parentNode.appendChild(document.createElement('hr'));\r\n                    recordingPlayer.parentNode.appendChild(audio);\r\n\r\n                    if(audio.paused) audio.play();\r\n                };\r\n                return;\r\n            }\r\n\r\n            var options = {\r\n                type: type,\r\n                mimeType: mimeType,\r\n                disableLogs: params.disableLogs || false,\r\n                getNativeBlob: false, // enable it for longer recordings\r\n                video: recordingPlayer\r\n            };\r\n\r\n            if(recorderType) {\r\n                options.recorderType = recorderType;\r\n\r\n                if(recorderType == WhammyRecorder || recorderType == GifRecorder || recorderType == WebAssemblyRecorder) {\r\n                    options.canvas = options.video = {\r\n                        width: defaultWidth || 320,\r\n                        height: defaultHeight || 240\r\n                    };\r\n                }\r\n            }\r\n\r\n            if(videoBitsPerSecond) {\r\n                options.videoBitsPerSecond = videoBitsPerSecond;\r\n            }\r\n\r\n            if(timeSlice && typeof MediaRecorder !== 'undefined') {\r\n                options.timeSlice = timeSlice;\r\n                button.blobs = [];\r\n                options.ondataavailable = function(blob) {\r\n                    button.blobs.push(blob);\r\n                };\r\n            }\r\n\r\n            options.ignoreMutedMedia = false;\r\n            button.recordRTC = RecordRTC(button.stream, options);\r\n\r\n            button.recordingEndedCallback = function(url) {\r\n                setVideoURL(url);\r\n            };\r\n\r\n            button.recordRTC.startRecording();\r\n            btnPauseRecording.style.display = '';\r\n            recordingPlayer.parentNode.parentNode.querySelector('h2').innerHTML = '<img src=\"https://cdn.webrtc-experiment.com/images/progress.gif\">';\r\n        };\r\n    }\r\n\r\n    if(recordingMedia.value === 'record-screen') {\r\n        captureScreen(commonConfig);\r\n\r\n        button.mediaCapturedCallback = function() {\r\n            var options = {\r\n                type: type,\r\n                mimeType: mimeType,\r\n                disableLogs: params.disableLogs || false,\r\n                getNativeBlob: false, // enable it for longer recordings\r\n                video: recordingPlayer\r\n            };\r\n\r\n            if(recorderType) {\r\n                options.recorderType = recorderType;\r\n\r\n                if(recorderType == WhammyRecorder || recorderType == GifRecorder || recorderType == WebAssemblyRecorder) {\r\n                    options.canvas = options.video = {\r\n                        width: defaultWidth || 320,\r\n                        height: defaultHeight || 240\r\n                    };\r\n                }\r\n            }\r\n\r\n            if(videoBitsPerSecond) {\r\n                options.videoBitsPerSecond = videoBitsPerSecond;\r\n            }\r\n\r\n            options.ignoreMutedMedia = false;\r\n            button.recordRTC = RecordRTC(button.stream, options);\r\n\r\n            button.recordingEndedCallback = function(url) {\r\n                setVideoURL(url);\r\n            };\r\n\r\n            button.recordRTC.startRecording();\r\n            btnPauseRecording.style.display = '';\r\n        };\r\n    }\r\n\r\n    // note: audio+tab is supported in Chrome 50+\r\n    // todo: add audio+tab recording\r\n    if(recordingMedia.value === 'record-audio-plus-screen') {\r\n        captureAudioPlusScreen(commonConfig);\r\n\r\n        button.mediaCapturedCallback = function() {\r\n            var options = {\r\n                type: type,\r\n                mimeType: mimeType,\r\n                disableLogs: params.disableLogs || false,\r\n                getNativeBlob: false, // enable it for longer recordings\r\n                video: recordingPlayer\r\n            };\r\n\r\n            if(recorderType) {\r\n                options.recorderType = recorderType;\r\n\r\n                if(recorderType == WhammyRecorder || recorderType == GifRecorder || recorderType == WebAssemblyRecorder) {\r\n                    options.canvas = options.video = {\r\n                        width: defaultWidth || 320,\r\n                        height: defaultHeight || 240\r\n                    };\r\n                }\r\n            }\r\n\r\n            if(videoBitsPerSecond) {\r\n                options.videoBitsPerSecond = videoBitsPerSecond;\r\n            }\r\n\r\n            options.ignoreMutedMedia = false;\r\n            button.recordRTC = RecordRTC(button.stream, options);\r\n\r\n            button.recordingEndedCallback = function(url) {\r\n                setVideoURL(url);\r\n            };\r\n\r\n            button.recordRTC.startRecording();\r\n            btnPauseRecording.style.display = '';\r\n        };\r\n    }\r\n};\r\n\r\nfunction captureVideo(config) {\r\n    captureUserMedia({video: true}, function(videoStream) {\r\n        config.onMediaCaptured(videoStream);\r\n\r\n        addStreamStopListener(videoStream, function() {\r\n            config.onMediaStopped();\r\n        });\r\n    }, function(error) {\r\n        config.onMediaCapturingFailed(error);\r\n    });\r\n}\r\n\r\nfunction captureAudio(config) {\r\n    captureUserMedia({audio: true}, function(audioStream) {\r\n        config.onMediaCaptured(audioStream);\r\n\r\n        addStreamStopListener(audioStream, function() {\r\n            config.onMediaStopped();\r\n        });\r\n    }, function(error) {\r\n        config.onMediaCapturingFailed(error);\r\n    });\r\n}\r\n\r\nfunction captureAudioPlusVideo(config) {\r\n    captureUserMedia({video: true, audio: true}, function(audioVideoStream) {\r\n        config.onMediaCaptured(audioVideoStream);\r\n\r\n        if(audioVideoStream instanceof Array) {\r\n            audioVideoStream.forEach(function(stream) {\r\n                addStreamStopListener(stream, function() {\r\n                    config.onMediaStopped();\r\n                });\r\n            });\r\n            return;\r\n        }\r\n\r\n        addStreamStopListener(audioVideoStream, function() {\r\n            config.onMediaStopped();\r\n        });\r\n    }, function(error) {\r\n        config.onMediaCapturingFailed(error);\r\n    });\r\n}\r\n\r\nvar MY_DOMAIN = 'webrtc-experiment.com';\r\n\r\nfunction isMyOwnDomain() {\r\n    // replace \"webrtc-experiment.com\" with your own domain name\r\n    return document.domain.indexOf(MY_DOMAIN) !== -1;\r\n}\r\n\r\nfunction isLocalHost() {\r\n    // \"chrome.exe\" --enable-usermedia-screen-capturing\r\n    // or firefox => about:config => \"media.getusermedia.screensharing.allowed_domains\" => add \"localhost\"\r\n    return document.domain === 'localhost' || document.domain === 'http://127.0.0.1:3000/';\r\n}\r\n\r\nvar videoBitsPerSecond;\r\n\r\nfunction setVideoBitrates() {\r\n    var select = document.querySelector('.media-bitrates');\r\n    var value = select.value;\r\n\r\n    if(value == 'default') {\r\n        videoBitsPerSecond = null;\r\n        return;\r\n    }\r\n\r\n    videoBitsPerSecond = parseInt(value);\r\n}\r\n\r\nfunction getFrameRates(mediaConstraints) {\r\n    if(!mediaConstraints.video) {\r\n        return mediaConstraints;\r\n    }\r\n\r\n    var select = document.querySelector('.media-framerates');\r\n    var value = select.value;\r\n\r\n    if(value == 'default') {\r\n        return mediaConstraints;\r\n    }\r\n\r\n    value = parseInt(value);\r\n\r\n    if(DetectRTC.browser.name === 'Firefox') {\r\n        mediaConstraints.video.frameRate = value;\r\n        return mediaConstraints;\r\n    }\r\n\r\n    if(!mediaConstraints.video.mandatory) {\r\n        mediaConstraints.video.mandatory = {};\r\n        mediaConstraints.video.optional = [];\r\n    }\r\n\r\n    var isScreen = recordingMedia.value.toString().toLowerCase().indexOf('screen') != -1;\r\n    if(isScreen) {\r\n        mediaConstraints.video.mandatory.maxFrameRate = value;\r\n    }\r\n    else {\r\n        mediaConstraints.video.mandatory.minFrameRate = value;\r\n    }\r\n\r\n    return mediaConstraints;\r\n}\r\n\r\nfunction setGetFromLocalStorage(selectors) {\r\n    selectors.forEach(function(selector) {\r\n        var storageItem = selector.replace(/\\.|#/g, '');\r\n        if(localStorage.getItem(storageItem)) {\r\n            document.querySelector(selector).value = localStorage.getItem(storageItem);\r\n        }\r\n\r\n        addEventListenerToUploadLocalStorageItem(selector, ['change', 'blur'], function() {\r\n            localStorage.setItem(storageItem, document.querySelector(selector).value);\r\n        });\r\n    });\r\n}\r\n\r\nfunction addEventListenerToUploadLocalStorageItem(selector, arr, callback) {\r\n    arr.forEach(function(event) {\r\n        document.querySelector(selector).addEventListener(event, callback, false);\r\n    });\r\n}\r\n\r\nsetGetFromLocalStorage(['.media-resolutions', '.media-framerates', '.media-bitrates', '.recording-media', '.media-container-format']);\r\n\r\nfunction getVideoResolutions(mediaConstraints) {\r\n    if(!mediaConstraints.video) {\r\n        return mediaConstraints;\r\n    }\r\n\r\n    var select = document.querySelector('.media-resolutions');\r\n    var value = select.value;\r\n\r\n    if(value == 'default') {\r\n        return mediaConstraints;\r\n    }\r\n\r\n    value = value.split('x');\r\n\r\n    if(value.length != 2) {\r\n        return mediaConstraints;\r\n    }\r\n\r\n    defaultWidth = parseInt(value[0]);\r\n    defaultHeight = parseInt(value[1]);\r\n\r\n    if(DetectRTC.browser.name === 'Firefox') {\r\n        mediaConstraints.video.width = defaultWidth;\r\n        mediaConstraints.video.height = defaultHeight;\r\n        return mediaConstraints;\r\n    }\r\n\r\n    if(!mediaConstraints.video.mandatory) {\r\n        mediaConstraints.video.mandatory = {};\r\n        mediaConstraints.video.optional = [];\r\n    }\r\n\r\n    var isScreen = recordingMedia.value.toString().toLowerCase().indexOf('screen') != -1;\r\n\r\n    if(isScreen) {\r\n        mediaConstraints.video.mandatory.maxWidth = defaultWidth;\r\n        mediaConstraints.video.mandatory.maxHeight = defaultHeight;\r\n    }\r\n    else {\r\n        mediaConstraints.video.mandatory.minWidth = defaultWidth;\r\n        mediaConstraints.video.mandatory.minHeight = defaultHeight;\r\n    }\r\n\r\n    return mediaConstraints;\r\n}\r\n\r\nfunction captureUserMedia(mediaConstraints, successCallback, errorCallback) {\r\n    if(mediaConstraints.video == true) {\r\n        mediaConstraints.video = {};\r\n    }\r\n\r\n    setVideoBitrates();\r\n\r\n    mediaConstraints = getVideoResolutions(mediaConstraints);\r\n    mediaConstraints = getFrameRates(mediaConstraints);\r\n\r\n    var isBlackBerry = !!(/BB10|BlackBerry/i.test(navigator.userAgent || ''));\r\n    if(isBlackBerry && !!(navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia)) {\r\n        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\r\n        navigator.getUserMedia(mediaConstraints, successCallback, errorCallback);\r\n        return;\r\n    }\r\n\r\n    navigator.mediaDevices.getUserMedia(mediaConstraints).then(function(stream) {\r\n        successCallback(stream);\r\n\r\n        setVideoURL(stream, true);\r\n    }).catch(function(error) {\r\n        if(error && (error.name === 'ConstraintNotSatisfiedError' || error.name === 'OverconstrainedError')) {\r\n            alert('Your camera or browser does NOT supports selected resolutions or frame-rates. \\n\\nPlease select \"default\" resolutions.');\r\n        }\r\n        else if(error && error.message) {\r\n            alert(error.message);\r\n        }\r\n        else {\r\n            alert('Unable to make getUserMedia request. Please check browser console logs.');\r\n        }\r\n\r\n        errorCallback(error);\r\n    });\r\n}\r\n\r\nfunction setMediaContainerFormat(arrayOfOptionsSupported) {\r\n    var options = Array.prototype.slice.call(\r\n        mediaContainerFormat.querySelectorAll('option')\r\n    );\r\n\r\n    var localStorageItem;\r\n    if(localStorage.getItem('media-container-format')) {\r\n        localStorageItem = localStorage.getItem('media-container-format');\r\n    }\r\n\r\n    var selectedItem;\r\n    options.forEach(function(option) {\r\n        option.disabled = true;\r\n\r\n        if(arrayOfOptionsSupported.indexOf(option.value) !== -1) {\r\n            option.disabled = false;\r\n\r\n            if(localStorageItem && arrayOfOptionsSupported.indexOf(localStorageItem) != -1) {\r\n                if(option.value != localStorageItem) return;\r\n                option.selected = true;\r\n                selectedItem = option;\r\n                return;\r\n            }\r\n\r\n            if(!selectedItem) {\r\n                option.selected = true;\r\n                selectedItem = option;\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nfunction isMimeTypeSupported(mimeType) {\r\n    if(typeof MediaRecorder === 'undefined') {\r\n        return false;\r\n    }\r\n\r\n    if(typeof MediaRecorder.isTypeSupported !== 'function') {\r\n        return true;\r\n    }\r\n\r\n    return MediaRecorder.isTypeSupported(mimeType);\r\n}\r\n\r\nrecordingMedia.onchange = function() {\r\n    if(recordingMedia.value === 'record-audio') {\r\n        var recordingOptions = [];\r\n\r\n        if(isMimeTypeSupported('audio/webm')) {\r\n            recordingOptions.push('opus');\r\n        }\r\n\r\n        if(isMimeTypeSupported('audio/ogg')) {\r\n            recordingOptions.push('ogg');\r\n        }\r\n\r\n        recordingOptions.push('pcm');\r\n\r\n        setMediaContainerFormat(recordingOptions);\r\n        return;\r\n    }\r\n\r\n    var isChrome = !!window.chrome && !(!!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0);\r\n\r\n    var recordingOptions = ['vp8']; // MediaStreamRecorder with vp8\r\n\r\n    if(isMimeTypeSupported('video/webm\\;codecs=vp9')) {\r\n        recordingOptions.push('vp9'); // MediaStreamRecorder with vp9\r\n    }\r\n\r\n    if(isMimeTypeSupported('video/webm\\;codecs=h264')) {\r\n        recordingOptions.push('h264'); // MediaStreamRecorder with h264\r\n    }\r\n\r\n    if(isMimeTypeSupported('video/x-matroska;codecs=avc1')) {\r\n        recordingOptions.push('mkv'); // MediaStreamRecorder with mkv/matroska\r\n    }\r\n\r\n    recordingOptions.push('gif'); // GifRecorder\r\n\r\n    if(DetectRTC.browser.name == 'Chrome') {\r\n        recordingOptions.push('whammy'); // WhammyRecorder\r\n    }\r\n\r\n    if(DetectRTC.browser.name == 'Chrome') {\r\n        recordingOptions.push('WebAssembly'); // WebAssemblyRecorder\r\n    }\r\n\r\n    recordingOptions.push('default'); // Default mimeType for MediaStreamRecorder\r\n\r\n    setMediaContainerFormat(recordingOptions);\r\n};\r\nrecordingMedia.onchange();\r\n\r\nif(typeof MediaRecorder === 'undefined' && (DetectRTC.browser.name === 'Edge' || DetectRTC.browser.name === 'Safari')) {\r\n    // webp isn't supported in Microsoft Edge\r\n    // neither MediaRecorder API\r\n    // so lets disable both video/screen recording options\r\n\r\n    console.warn('Neither MediaRecorder API nor webp is supported in ' + DetectRTC.browser.name + '. You cam merely record audio.');\r\n\r\n    recordingMedia.innerHTML = '<option value=\"record-audio\">Audio</option>';\r\n    setMediaContainerFormat(['pcm']);\r\n}\r\n\r\nfunction stringify(obj) {\r\n    var result = '';\r\n    Object.keys(obj).forEach(function(key) {\r\n        if(typeof obj[key] === 'function') {\r\n            return;\r\n        }\r\n\r\n        if(result.length) {\r\n            result += ',';\r\n        }\r\n\r\n        result += key + ': ' + obj[key];\r\n    });\r\n\r\n    return result;\r\n}\r\n\r\nfunction mediaRecorderToStringify(mediaRecorder) {\r\n    var result = '';\r\n    result += 'mimeType: ' + mediaRecorder.mimeType;\r\n    result += ', state: ' + mediaRecorder.state;\r\n    result += ', audioBitsPerSecond: ' + mediaRecorder.audioBitsPerSecond;\r\n    result += ', videoBitsPerSecond: ' + mediaRecorder.videoBitsPerSecond;\r\n    if(mediaRecorder.stream) {\r\n        result += ', streamid: ' + mediaRecorder.stream.id;\r\n        result += ', stream-active: ' + mediaRecorder.stream.active;\r\n    }\r\n    return result;\r\n}\r\n\r\nfunction getFailureReport() {\r\n    var info = 'RecordRTC seems failed. \\n\\n' + stringify(DetectRTC.browser) + '\\n\\n' + DetectRTC.osName + ' ' + DetectRTC.osVersion + '\\n';\r\n\r\n    if (typeof recorderType !== 'undefined' && recorderType) {\r\n        info += '\\nrecorderType: ' + recorderType.name;\r\n    }\r\n\r\n    if (typeof mimeType !== 'undefined') {\r\n        info += '\\nmimeType: ' + mimeType;\r\n    }\r\n\r\n    Array.prototype.slice.call(document.querySelectorAll('select')).forEach(function(select) {\r\n        info += '\\n' + (select.id || select.className) + ': ' + select.value;\r\n    });\r\n\r\n    if (btnStartRecording.recordRTC) {\r\n        info += '\\n\\ninternal-recorder: ' + btnStartRecording.recordRTC.getInternalRecorder().name;\r\n\r\n        if(btnStartRecording.recordRTC.getInternalRecorder().getAllStates) {\r\n            info += '\\n\\nrecorder-states: ' + btnStartRecording.recordRTC.getInternalRecorder().getAllStates();\r\n        }\r\n    }\r\n\r\n    if(btnStartRecording.stream) {\r\n        info += '\\n\\naudio-tracks: ' + getTracks(btnStartRecording.stream, 'audio').length;\r\n        info += '\\nvideo-tracks: ' + getTracks(btnStartRecording.stream, 'video').length;\r\n        info += '\\nstream-active? ' + !!btnStartRecording.stream.active;\r\n\r\n        btnStartRecording.stream.getTracks().forEach(function(track) {\r\n            info += '\\n' + track.kind + '-track-' + (track.label || track.id) + ': (enabled: ' + !!track.enabled + ', readyState: ' + track.readyState + ', muted: ' + !!track.muted + ')';\r\n\r\n            if(track.getConstraints && Object.keys(track.getConstraints()).length) {\r\n                info += '\\n' + track.kind + '-track-getConstraints: ' + stringify(track.getConstraints());\r\n            }\r\n\r\n            if(track.getSettings && Object.keys(track.getSettings()).length) {\r\n                info += '\\n' + track.kind + '-track-getSettings: ' + stringify(track.getSettings());\r\n            }\r\n        });\r\n    }\r\n\r\n    if(timeSlice && btnStartRecording.recordRTC) {\r\n        info += '\\ntimeSlice: ' + timeSlice;\r\n\r\n        if(btnStartRecording.recordRTC.getInternalRecorder().getArrayOfBlobs) {\r\n            var blobSizes = [];\r\n            btnStartRecording.recordRTC.getInternalRecorder().getArrayOfBlobs().forEach(function(blob) {\r\n                blobSizes.push(blob.size);\r\n            });\r\n            info += '\\nblobSizes: ' + blobSizes;\r\n        }\r\n    }\r\n\r\n    else if(btnStartRecording.recordRTC && btnStartRecording.recordRTC.getBlob()) {\r\n        info += '\\n\\nblobSize: ' + bytesToSize(btnStartRecording.recordRTC.getBlob().size);\r\n    }\r\n\r\n    if(btnStartRecording.recordRTC && btnStartRecording.recordRTC.getInternalRecorder() && btnStartRecording.recordRTC.getInternalRecorder().getInternalRecorder && btnStartRecording.recordRTC.getInternalRecorder().getInternalRecorder()) {\r\n        info += '\\n\\ngetInternalRecorder: ' + mediaRecorderToStringify(btnStartRecording.recordRTC.getInternalRecorder().getInternalRecorder());\r\n    }\r\n\r\n    return info;\r\n}\r\n\r\nfunction saveToDiskOrOpenNewTab(recordRTC) {\r\n    if(!recordRTC.getBlob().size) {\r\n        var info = getFailureReport();\r\n        console.log('blob', recordRTC.getBlob());\r\n        console.log('recordrtc instance', recordRTC);\r\n        console.log('report', info);\r\n\r\n        if(mediaContainerFormat.value !== 'default') {\r\n            alert('RecordRTC seems failed recording using ' + mediaContainerFormat.value + '. Please choose \"default\" option from the drop down and record again.');\r\n        }\r\n        else {\r\n            alert('RecordRTC seems failed. Unexpected issue. You can read the email in your console log. \\n\\nPlease report using disqus chat below.');\r\n        }\r\n\r\n        if(mediaContainerFormat.value !== 'vp9' && DetectRTC.browser.name === 'Chrome') {\r\n            alert('Please record using VP9 encoder. (select from the dropdown)');\r\n        }\r\n    }\r\n\r\n    var fileName = getFileName(fileExtension);\r\n\r\n    document.querySelector('#save-to-disk').parentNode.style.display = 'block';\r\n    document.querySelector('#save-to-disk').onclick = function() {\r\n        if(!recordRTC) return alert('No recording found.');\r\n\r\n        var file = new File([recordRTC.getBlob()], fileName, {\r\n            type: mimeType\r\n        });\r\n\r\n        invokeSaveAsDialog(file, file.name);\r\n    };\r\n\r\n    document.querySelector('#open-new-tab').onclick = function() {\r\n        if(!recordRTC) return alert('No recording found.');\r\n\r\n        var file = new File([recordRTC.getBlob()], fileName, {\r\n            type: mimeType\r\n        });\r\n\r\n        window.open(URL.createObjectURL(file));\r\n    };\r\n\r\n    // upload to PHP server\r\n    if(isMyOwnDomain()) {\r\n        document.querySelector('#upload-to-php').disabled = true;\r\n        document.querySelector('#upload-to-php').style.display = 'none';\r\n    }\r\n    else {\r\n        document.querySelector('#upload-to-php').disabled = false;\r\n    }\r\n\r\n    document.querySelector('#upload-to-php').onclick = function() {\r\n        if(isMyOwnDomain()) {\r\n            alert('PHP Upload is not available on this domain.');\r\n            return;\r\n        }\r\n\r\n        if(!recordRTC) return alert('No recording found.');\r\n        this.disabled = true;\r\n\r\n        var button = this;\r\n        uploadToPHPServer(fileName, recordRTC, function(progress, fileURL) {\r\n            if(progress === 'ended') {\r\n                button.disabled = false;\r\n                button.innerHTML = 'Click to download from server';\r\n                button.onclick = function() {\r\n                    SaveFileURLToDisk(fileURL, fileName);\r\n                };\r\n\r\n                setVideoURL(fileURL);\r\n\r\n                var html = 'Uploaded to PHP.<br>Download using below link:<br>';\r\n                html += '<a href=\"'+fileURL+'\" download=\"'+fileName+'\" style=\"color: yellow; display: block; margin-top: 15px;\">'+fileName+'</a>';\r\n                recordingPlayer.parentNode.parentNode.querySelector('h2').innerHTML = html;\r\n                return;\r\n            }\r\n            button.innerHTML = progress;\r\n            recordingPlayer.parentNode.parentNode.querySelector('h2').innerHTML = progress;\r\n        });\r\n    };\r\n\r\n    // upload to YouTube!\r\n    document.querySelector('#upload-to-youtube').disabled = false;\r\n    document.querySelector('#upload-to-youtube').onclick = function() {\r\n        if(!recordRTC) return alert('No recording found.');\r\n        this.disabled = true;\r\n\r\n        if(isLocalHost()) {\r\n            alert('This feature is NOT available on localhost.');\r\n            return;\r\n        }\r\n\r\n        if(isMyOwnDomain() === false) {\r\n            var url = 'https://github.com/muaz-khan/RecordRTC/wiki/Upload-to-YouTube';\r\n            alert('YouTube API key is configured to work only on webrtc-experiment.com. Please create your own YouTube key + oAuth client-id and use it instead.\\n\\nWiki page: ' + url);\r\n\r\n            // check instructions on the wiki page\r\n            location.href = url;\r\n            return;\r\n        }\r\n\r\n        var button = this;\r\n        uploadToYouTube(fileName, recordRTC, function(percentageComplete, fileURL) {\r\n            if(percentageComplete == 'uploaded') {\r\n                button.disabled = false;\r\n                button.innerHTML = 'Uploaded. However YouTube is still processing.';\r\n                button.onclick = function() {\r\n                    window.open(fileURL);\r\n                };\r\n                return;\r\n            }\r\n            if(percentageComplete == 'processed') {\r\n                button.disabled = false;\r\n                button.innerHTML = 'Uploaded & Processed. Click to open YouTube video.';\r\n                button.onclick = function() {\r\n                    window.open(fileURL);\r\n                };\r\n\r\n                document.querySelector('h1').innerHTML = 'Your video has been uploaded.';\r\n                window.scrollTo(0, 0);\r\n\r\n                alert('Your video has been uploaded.');\r\n                return;\r\n            }\r\n            if(percentageComplete == 'failed') {\r\n                button.disabled = false;\r\n                button.innerHTML = 'YouTube failed transcoding the video.';\r\n                button.onclick = function() {\r\n                    window.open(fileURL);\r\n                };\r\n                return;\r\n            }\r\n            button.innerHTML = percentageComplete + '% uploaded to YouTube.';\r\n        });\r\n    };\r\n}\r\n\r\nfunction uploadToPHPServer(fileName, recordRTC, callback) {\r\n    var blob = recordRTC instanceof Blob ? recordRTC : recordRTC.getBlob();\r\n\r\n    blob = new File([blob], getFileName(fileExtension), {\r\n        type: mimeType\r\n    });\r\n\r\n    // create FormData\r\n    var formData = new FormData();\r\n    formData.append('video-filename', fileName);\r\n    formData.append('video-blob', blob);\r\n\r\n    callback('Uploading recorded-file to server.');\r\n\r\n    // var upload_url = 'https://your-domain.com/files-uploader/';\r\n    var upload_url = 'RecordRTC-to-PHP/save.php';\r\n\r\n    // var upload_directory = upload_url;\r\n    var upload_directory = 'RecordRTC-to-PHP/uploads/';\r\n\r\n    makeXMLHttpRequest(upload_url, formData, function(progress) {\r\n        if (progress !== 'upload-ended') {\r\n            callback(progress);\r\n            return;\r\n        }\r\n\r\n        callback('ended', upload_directory + fileName);\r\n    });\r\n}\r\n\r\nfunction makeXMLHttpRequest(url, data, callback) {\r\n    var request = new XMLHttpRequest();\r\n    request.onreadystatechange = function() {\r\n        if (request.readyState == 4 && request.status == 200) {\r\n            if(request.responseText === 'success') {\r\n                callback('upload-ended');\r\n                return;\r\n            }\r\n\r\n            document.querySelector('.header').parentNode.style = 'text-align: left; color: red; padding: 5px 10px;';\r\n            document.querySelector('.header').parentNode.innerHTML = request.responseText;\r\n        }\r\n    };\r\n\r\n    request.upload.onloadstart = function() {\r\n        callback('Upload started...');\r\n    };\r\n\r\n    request.upload.onprogress = function(event) {\r\n        callback('Upload Progress ' + Math.round(event.loaded / event.total * 100) + \"%\");\r\n    };\r\n\r\n    request.upload.onload = function() {\r\n        callback('progress-about-to-end');\r\n    };\r\n\r\n    request.upload.onload = function() {\r\n        callback('Getting File URL..');\r\n    };\r\n\r\n    request.upload.onerror = function(error) {\r\n        callback('Failed to upload to server');\r\n    };\r\n\r\n    request.upload.onabort = function(error) {\r\n        callback('Upload aborted.');\r\n    };\r\n\r\n    request.open('POST', url);\r\n    request.send(data);\r\n}\r\n\r\nfunction getRandomString() {\r\n    if (window.crypto && window.crypto.getRandomValues && navigator.userAgent.indexOf('Safari') === -1) {\r\n        var a = window.crypto.getRandomValues(new Uint32Array(3)),\r\n            token = '';\r\n        for (var i = 0, l = a.length; i < l; i++) {\r\n            token += a[i].toString(36);\r\n        }\r\n        return token;\r\n    } else {\r\n        return (Math.random() * new Date().getTime()).toString(36).replace(/\\./g, '');\r\n    }\r\n}\r\n\r\nfunction getFileName(fileExtension) {\r\n    var d = new Date();\r\n    var year = d.getUTCFullYear();\r\n    var month = d.getUTCMonth();\r\n    var date = d.getUTCDate();\r\n    return 'RecordRTC-' + year + month + date + '-' + getRandomString() + '.' + fileExtension;\r\n}\r\n\r\nfunction SaveFileURLToDisk(fileUrl, fileName) {\r\n    var hyperlink = document.createElement('a');\r\n    hyperlink.href = fileUrl;\r\n    hyperlink.target = '_blank';\r\n    hyperlink.download = fileName || fileUrl;\r\n\r\n    (document.body || document.documentElement).appendChild(hyperlink);\r\n    hyperlink.onclick = function() {\r\n       (document.body || document.documentElement).removeChild(hyperlink);\r\n\r\n       // required for Firefox\r\n       window.URL.revokeObjectURL(hyperlink.href);\r\n    };\r\n\r\n    var mouseEvent = new MouseEvent('click', {\r\n        view: window,\r\n        bubbles: true,\r\n        cancelable: true\r\n    });\r\n\r\n    hyperlink.dispatchEvent(mouseEvent);\r\n}\r\n\r\nfunction getURL(arg) {\r\n    var url = arg;\r\n\r\n    if(arg instanceof Blob || arg instanceof File) {\r\n        url = URL.createObjectURL(arg);\r\n    }\r\n\r\n    if(arg instanceof RecordRTC || arg.getBlob) {\r\n        url = URL.createObjectURL(arg.getBlob());\r\n    }\r\n\r\n    if(arg instanceof MediaStream || arg.getTracks) {\r\n        // url = URL.createObjectURL(arg);\r\n    }\r\n\r\n    return url;\r\n}\r\n\r\nfunction setVideoURL(arg, forceNonImage) {\r\n    var url = getURL(arg);\r\n\r\n    var parentNode = recordingPlayer.parentNode;\r\n    parentNode.removeChild(recordingPlayer);\r\n    parentNode.innerHTML = '';\r\n\r\n    var elem = 'video';\r\n    if(type == 'gif' && !forceNonImage) {\r\n        elem = 'img';\r\n    }\r\n    if(type == 'audio') {\r\n        elem = 'audio';\r\n    }\r\n\r\n    recordingPlayer = document.createElement(elem);\r\n\r\n    if(arg instanceof MediaStream) {\r\n        recordingPlayer.muted = true;\r\n    }\r\n\r\n    recordingPlayer.addEventListener('loadedmetadata', function() {\r\n        if(navigator.userAgent.toLowerCase().indexOf('android') == -1) return;\r\n\r\n        // android\r\n        setTimeout(function() {\r\n            if(typeof recordingPlayer.play === 'function') {\r\n                recordingPlayer.play();\r\n            }\r\n        }, 2000);\r\n    }, false);\r\n\r\n    recordingPlayer.poster = '';\r\n\r\n    if(arg instanceof MediaStream) {\r\n        recordingPlayer.srcObject = arg;\r\n    }\r\n    else {\r\n        recordingPlayer.src = url;\r\n    }\r\n\r\n    if(typeof recordingPlayer.play === 'function') {\r\n        recordingPlayer.play();\r\n    }\r\n\r\n    recordingPlayer.addEventListener('ended', function() {\r\n        url = getURL(arg);\r\n\r\n        if(arg instanceof MediaStream) {\r\n            recordingPlayer.srcObject = arg;\r\n        }\r\n        else {\r\n            recordingPlayer.src = url;\r\n        }\r\n    });\r\n\r\n    parentNode.appendChild(recordingPlayer);\r\n}\r\nfunction captureScreen(config) {\r\n    if (navigator.getDisplayMedia) {\r\n        navigator.getDisplayMedia({\r\n            video: true\r\n        }).then(screenStream => {\r\n            config.onMediaCaptured(screenStream);\r\n\r\n            addStreamStopListener(screenStream, function() {\r\n                // config.onMediaStopped();\r\n\r\n                btnStartRecording.onclick();\r\n            });\r\n\r\n            setVideoURL(screenStream, true);\r\n        }).catch(function(error) {\r\n            config.onMediaCapturingFailed(error);\r\n        });\r\n    } else if (navigator.mediaDevices.getDisplayMedia) {\r\n        navigator.mediaDevices.getDisplayMedia({\r\n            video: true\r\n        }).then(screenStream => {\r\n            config.onMediaCaptured(screenStream);\r\n\r\n            addStreamStopListener(screenStream, function() {\r\n                // config.onMediaStopped();\r\n\r\n                btnStartRecording.onclick();\r\n            });\r\n\r\n            setVideoURL(screenStream, true);\r\n        }).catch(function(error) {\r\n            config.onMediaCapturingFailed(error);\r\n        });\r\n    } else {\r\n        var error = 'getDisplayMedia API are not supported in this browser.';\r\n        config.onMediaCapturingFailed(error);\r\n        alert(error);\r\n    }\r\n}\r\n\r\nfunction captureAudioPlusScreen(config) {\r\n    if (navigator.getDisplayMedia) {\r\n        navigator.getDisplayMedia({\r\n            video: true\r\n        }).then(screenStream => {\r\n            navigator.mediaDevices.getUserMedia({audio:true}).then(function(mic) {\r\n                screenStream.addTrack(mic.getTracks()[0]);\r\n\r\n                config.onMediaCaptured(screenStream);\r\n\r\n                addStreamStopListener(screenStream, function() {\r\n                    // config.onMediaStopped();\r\n\r\n                    btnStartRecording.onclick();\r\n                });\r\n\r\n                setVideoURL(screenStream, true);\r\n            });\r\n        }).catch(function(error) {\r\n            config.onMediaCapturingFailed(error);\r\n        });\r\n    } else if (navigator.mediaDevices.getDisplayMedia) {\r\n        navigator.mediaDevices.getDisplayMedia({\r\n            video: true\r\n        }).then(screenStream => {\r\n            navigator.mediaDevices.getUserMedia({audio:true}).then(function(mic) {\r\n                screenStream.addTrack(mic.getTracks()[0]);\r\n\r\n                config.onMediaCaptured(screenStream);\r\n\r\n                addStreamStopListener(screenStream, function() {\r\n                    // config.onMediaStopped();\r\n\r\n                    btnStartRecording.onclick();\r\n                });\r\n\r\n                setVideoURL(screenStream, true);\r\n            });\r\n        }).catch(function(error) {\r\n            config.onMediaCapturingFailed(error);\r\n        });\r\n    } else {\r\n        var error = 'getDisplayMedia API are not supported in this browser.';\r\n        config.onMediaCapturingFailed(error);\r\n        alert(error);\r\n    }\r\n}\r\n            function uploadToYouTube(fileName, recordRTC, callback) {\r\n                var blob = recordRTC instanceof Blob ? recordRTC : recordRTC.getBlob();\r\n\r\n                blob = new File([blob], getFileName(fileExtension), {\r\n                    type: mimeType\r\n                });\r\n\r\n                if(!uploadVideo) {\r\n                    alert('YouTube API are not available.');\r\n                    return;\r\n                }\r\n\r\n                uploadVideo.callback = callback;\r\n                uploadVideo.uploadFile(fileName, blob);\r\n            }\r\n\r\n            var uploadVideo;\r\n\r\n            var signinCallback = function (result){\r\n              if(result.access_token) {\r\n                uploadVideo = new UploadVideo();\r\n                uploadVideo.ready(result.access_token);\r\n\r\n                document.querySelector('#signinButton').style.display = 'none';\r\n              }\r\n              else {\r\n                // console.error('YouTube error', result);\r\n                // document.querySelector('#upload-to-youtube').style.display = 'none';\r\n              }\r\n            };\r\n\r\n            var STATUS_POLLING_INTERVAL_MILLIS = 60 * 1000; // One minute.\r\n\r\n            var UploadVideo = function() {\r\n              this.tags = ['recordrtc'];\r\n              this.categoryId = 28; // via: http://stackoverflow.com/a/35877512/552182\r\n              this.videoId = '';\r\n              this.uploadStartTime = 0;\r\n            };\r\n\r\n\r\n            UploadVideo.prototype.ready = function(accessToken) {\r\n              this.accessToken = accessToken;\r\n              this.gapi = gapi;\r\n              this.authenticated = true;\r\n              false && this.gapi.client.request({\r\n                path: '/youtube/v3/channels',\r\n                params: {\r\n                  part: 'snippet',\r\n                  mine: true\r\n                },\r\n                callback: function(response) {\r\n                  if (!response.error) {\r\n                    // response.items[0].snippet.title -- channel title\r\n                    // response.items[0].snippet.thumbnails.default.url -- channel thumbnail\r\n                  }\r\n                }.bind(this)\r\n              });\r\n            };\r\n\r\n            UploadVideo.prototype.uploadFile = function(fileName, file) {\r\n              var metadata = {\r\n                snippet: {\r\n                  title: fileName,\r\n                  description: fileName,\r\n                  tags: this.tags,\r\n                  categoryId: this.categoryId\r\n                },\r\n                status: {\r\n                  privacyStatus: 'public'\r\n                }\r\n              };\r\n              var uploader = new MediaUploader({\r\n                baseUrl: 'https://www.googleapis.com/upload/youtube/v3/videos',\r\n                file: file,\r\n                token: this.accessToken,\r\n                metadata: metadata,\r\n                params: {\r\n                  part: Object.keys(metadata).join(',')\r\n                },\r\n                onError: function(data) {\r\n                  var message = data;\r\n                  try {\r\n                    var errorResponse = JSON.parse(data);\r\n                    message = errorResponse.error.message;\r\n                  } finally {\r\n                    alert(message);\r\n                  }\r\n                }.bind(this),\r\n                onProgress: function(data) {\r\n                  var bytesUploaded = data.loaded;\r\n                  var totalBytes = parseInt(data.total);\r\n                  var percentageComplete = parseInt((bytesUploaded * 100) / totalBytes);\r\n\r\n                  uploadVideo.callback(percentageComplete);\r\n                }.bind(this),\r\n                onComplete: function(data) {\r\n                  var uploadResponse = JSON.parse(data);\r\n                  this.videoId = uploadResponse.id;\r\n                  this.videoURL = 'https://www.youtube.com/watch?v=' + this.videoId;\r\n                  uploadVideo.callback('uploaded', this.videoURL);\r\n\r\n                  setTimeout(this.pollForVideoStatus, 2000);\r\n                }.bind(this)\r\n              });\r\n              this.uploadStartTime = Date.now();\r\n              uploader.upload();\r\n            };\r\n\r\n            UploadVideo.prototype.pollForVideoStatus = function() {\r\n              this.gapi.client.request({\r\n                path: '/youtube/v3/videos',\r\n                params: {\r\n                  part: 'status,player',\r\n                  id: this.videoId\r\n                },\r\n                callback: function(response) {\r\n                  if (response.error) {\r\n                    uploadVideo.pollForVideoStatus();\r\n                  } else {\r\n                    var uploadStatus = response.items[0].status.uploadStatus;\r\n                    switch (uploadStatus) {\r\n                      case 'uploaded':\r\n                        uploadVideo.callback('uploaded', uploadVideo.videoURL);\r\n                        uploadVideo.pollForVideoStatus();\r\n                        break;\r\n                        case 'processed':\r\n                        uploadVideo.callback('processed', uploadVideo.videoURL);\r\n                        break;\r\n                        default:\r\n                        uploadVideo.callback('failed', uploadVideo.videoURL);\r\n                        break;\r\n                    }\r\n                  }\r\n                }.bind(this)\r\n              });\r\n            };\r\nvar DRIVE_UPLOAD_URL = 'https://www.googleapis.com/upload/drive/v2/files/';\r\n\r\nvar RetryHandler = function() {\r\n  this.interval = 1000; // Start at one second\r\n  this.maxInterval = 60 * 1000; // Don't wait longer than a minute\r\n};\r\n\r\nRetryHandler.prototype.retry = function(fn) {\r\n  setTimeout(fn, this.interval);\r\n  this.interval = this.nextInterval_();\r\n};\r\n\r\nRetryHandler.prototype.reset = function() {\r\n  this.interval = 1000;\r\n};\r\n\r\nRetryHandler.prototype.nextInterval_ = function() {\r\n  var interval = this.interval * 2 + this.getRandomInt_(0, 1000);\r\n  return Math.min(interval, this.maxInterval);\r\n};\r\n\r\nRetryHandler.prototype.getRandomInt_ = function(min, max) {\r\n  return Math.floor(Math.random() * (max - min + 1) + min);\r\n};\r\n\r\nvar MediaUploader = function(options) {\r\n  var noop = function() {};\r\n  this.file = options.file;\r\n  this.contentType = options.contentType || this.file.type || 'application/octet-stream';\r\n  this.metadata = options.metadata || {\r\n    'title': this.file.name,\r\n    'mimeType': this.contentType\r\n  };\r\n  this.token = options.token;\r\n  this.onComplete = options.onComplete || noop;\r\n  this.onProgress = options.onProgress || noop;\r\n  this.onError = options.onError || noop;\r\n  this.offset = options.offset || 0;\r\n  this.chunkSize = options.chunkSize || 0;\r\n  this.retryHandler = new RetryHandler();\r\n\r\n  this.url = options.url;\r\n  if (!this.url) {\r\n    var params = options.params || {};\r\n    params.uploadType = 'resumable';\r\n    this.url = this.buildUrl_(options.fileId, params, options.baseUrl);\r\n  }\r\n  this.httpMethod = options.fileId ? 'PUT' : 'POST';\r\n};\r\n\r\nMediaUploader.prototype.upload = function() {\r\n  var self = this;\r\n  var xhr = new XMLHttpRequest();\r\n\r\n  xhr.open(this.httpMethod, this.url, true);\r\n  xhr.setRequestHeader('Authorization', 'Bearer ' + this.token);\r\n  xhr.setRequestHeader('Content-Type', 'application/json');\r\n  xhr.setRequestHeader('X-Upload-Content-Length', this.file.size);\r\n  xhr.setRequestHeader('X-Upload-Content-Type', this.contentType);\r\n\r\n  xhr.onload = function(e) {\r\n    if (e.target.status < 400) {\r\n      var location = e.target.getResponseHeader('Location');\r\n      this.url = location;\r\n      this.sendFile_();\r\n    } else {\r\n      this.onUploadError_(e);\r\n    }\r\n  }.bind(this);\r\n  xhr.onerror = this.onUploadError_.bind(this);\r\n  xhr.send(JSON.stringify(this.metadata));\r\n};\r\n\r\nMediaUploader.prototype.sendFile_ = function() {\r\n  var content = this.file;\r\n  var end = this.file.size;\r\n\r\n  if (this.offset || this.chunkSize) {\r\n    // Only bother to slice the file if we're either resuming or uploading in chunks\r\n    if (this.chunkSize) {\r\n      end = Math.min(this.offset + this.chunkSize, this.file.size);\r\n    }\r\n    content = content.slice(this.offset, end);\r\n  }\r\n\r\n  var xhr = new XMLHttpRequest();\r\n  xhr.open('PUT', this.url, true);\r\n  xhr.setRequestHeader('Content-Type', this.contentType);\r\n  xhr.setRequestHeader('Content-Range', 'bytes ' + this.offset + '-' + (end - 1) + '/' + this.file.size);\r\n  xhr.setRequestHeader('X-Upload-Content-Type', this.file.type);\r\n  if (xhr.upload) {\r\n    xhr.upload.addEventListener('progress', this.onProgress);\r\n  }\r\n  xhr.onload = this.onContentUploadSuccess_.bind(this);\r\n  xhr.onerror = this.onContentUploadError_.bind(this);\r\n  xhr.send(content);\r\n};\r\n\r\nMediaUploader.prototype.resume_ = function() {\r\n  var xhr = new XMLHttpRequest();\r\n  xhr.open('PUT', this.url, true);\r\n  xhr.setRequestHeader('Content-Range', 'bytes */' + this.file.size);\r\n  xhr.setRequestHeader('X-Upload-Content-Type', this.file.type);\r\n  if (xhr.upload) {\r\n    xhr.upload.addEventListener('progress', this.onProgress);\r\n  }\r\n  xhr.onload = this.onContentUploadSuccess_.bind(this);\r\n  xhr.onerror = this.onContentUploadError_.bind(this);\r\n  xhr.send();\r\n};\r\n\r\nMediaUploader.prototype.extractRange_ = function(xhr) {\r\n  var range = xhr.getResponseHeader('Range');\r\n  if (range) {\r\n    this.offset = parseInt(range.match(/\\d+/g).pop(), 10) + 1;\r\n  }\r\n};\r\n\r\nMediaUploader.prototype.onContentUploadSuccess_ = function(e) {\r\n  if (e.target.status == 200 || e.target.status == 201) {\r\n    this.onComplete(e.target.response);\r\n  } else if (e.target.status == 308) {\r\n    this.extractRange_(e.target);\r\n    this.retryHandler.reset();\r\n    this.sendFile_();\r\n  }\r\n};\r\n\r\n\r\nMediaUploader.prototype.onContentUploadError_ = function(e) {\r\n  if (e.target.status && e.target.status < 500) {\r\n    this.onError(e.target.response);\r\n  } else {\r\n    this.retryHandler.retry(this.resume_.bind(this));\r\n  }\r\n};\r\n\r\nMediaUploader.prototype.onUploadError_ = function(e) {\r\n  this.onError(e.target.response); // TODO - Retries for initial upload\r\n};\r\n\r\nMediaUploader.prototype.buildQuery_ = function(params) {\r\n  params = params || {};\r\n  return Object.keys(params).map(function(key) {\r\n    return encodeURIComponent(key) + '=' + encodeURIComponent(params[key]);\r\n  }).join('&');\r\n};\r\n\r\nMediaUploader.prototype.buildUrl_ = function(id, params, baseUrl) {\r\n  var url = baseUrl || DRIVE_UPLOAD_URL;\r\n  if (id) {\r\n    url += id;\r\n  }\r\n  var query = this.buildQuery_(params);\r\n  if (query) {\r\n    url += '?' + query;\r\n  }\r\n  return url;\r\n};\r\n\r\nvar chkFixSeeking = document.querySelector('#chk-fixSeeking');\r\nchkFixSeeking.onchange = function() {\r\n    if(this.checked === true) {\r\n        localStorage.setItem(this.id, 'true');\r\n    }\r\n    else {\r\n        localStorage.removeItem(this.id);\r\n    }\r\n};\r\nif(localStorage.getItem(chkFixSeeking.id) === 'true') {\r\n    chkFixSeeking.checked = true;\r\n}\r\nvar chkTimeSlice = document.querySelector('#chk-timeSlice');\r\nvar timeSlice = false;\r\n\r\nif(typeof MediaRecorder === 'undefined') {\r\n    chkTimeSlice.disabled = true;\r\n}\r\n\r\nchkTimeSlice.addEventListener('change', function() {\r\n    if(chkTimeSlice.checked === true) {\r\n        var _timeSlice = prompt('Please enter timeSlice in milliseconds e.g. 1000 or 2000 or 3000.', 1000);\r\n        _timeSlice = parseInt(_timeSlice);\r\n        if(!_timeSlice || _timeSlice == NaN || typeof _timeSlice === 'undefined') {\r\n            timeSlice = false;\r\n            return;\r\n        }\r\n\r\n        timeSlice = _timeSlice;\r\n    }\r\n    else {\r\n        timeSlice = false;\r\n    }\r\n}, false);\r\n\r\nvar btnPauseRecording = document.querySelector('#btn-pause-recording');\r\nbtnPauseRecording.onclick = function() {\r\n    if(!btnStartRecording.recordRTC) {\r\n        btnPauseRecording.style.display = 'none';\r\n        return;\r\n    }\r\n\r\n    btnPauseRecording.disabled = true;\r\n    if(btnPauseRecording.innerHTML === 'Pause') {\r\n        btnStartRecording.disabled = true;\r\n        chkFixSeeking.parentNode.style.display = 'none';\r\n        btnStartRecording.style.fontSize = '15px';\r\n        btnStartRecording.recordRTC.pauseRecording();\r\n        recordingPlayer.parentNode.parentNode.querySelector('h2').innerHTML = 'Recording status: paused';\r\n        recordingPlayer.pause();\r\n\r\n        btnPauseRecording.style.fontSize = 'inherit';\r\n        setTimeout(function() {\r\n            btnPauseRecording.innerHTML = 'Resume Recording';\r\n            btnPauseRecording.disabled = false;\r\n        }, 2000);\r\n    }\r\n\r\n    if(btnPauseRecording.innerHTML === 'Resume Recording') {\r\n        btnStartRecording.disabled = false;\r\n        chkFixSeeking.parentNode.style.display = 'none';\r\n        btnStartRecording.style.fontSize = 'inherit';\r\n        btnStartRecording.recordRTC.resumeRecording();\r\n        recordingPlayer.parentNode.parentNode.querySelector('h2').innerHTML = '<img src=\"https://cdn.webrtc-experiment.com/images/progress.gif\">';\r\n        recordingPlayer.play();\r\n\r\n        btnPauseRecording.style.fontSize = '15px';\r\n        btnPauseRecording.innerHTML = 'Pause';\r\n        setTimeout(function() {\r\n            btnPauseRecording.disabled = false;\r\n        }, 2000);\r\n    }\r\n};\r\n"]},"sourceType":"script","hash":"558f7b3b453739059613b316957754b6e41708ee"}
