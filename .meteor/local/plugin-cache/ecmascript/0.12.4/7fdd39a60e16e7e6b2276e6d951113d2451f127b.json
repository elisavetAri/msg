{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Sandbox\\test\\packages\\ostrio:user-status\\client\\main.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/ostrio:user-status/client/main.js","filename":"C:\\Sandbox\\test\\packages\\ostrio:user-status\\client\\main.js","passPerPreset":false,"envName":"development","cwd":"C:\\Sandbox\\test","root":"C:\\Sandbox\\test","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"C:\\Sandbox\\test\\packages\\ostrio:user-status\\client\\main.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/ostrio:user-status/client/main.js"}},"code":"module.export({\n  UserStatus: function () {\n    return UserStatus;\n  }\n});\nvar throttle;\nmodule.link(\"./throttle\", {\n  \"default\": function (v) {\n    throttle = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar Session;\nmodule.link(\"meteor/session\", {\n  Session: function (v) {\n    Session = v;\n  }\n}, 2);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 3);\nvar Accounts;\nmodule.link(\"meteor/accounts-base\", {\n  Accounts: function (v) {\n    Accounts = v;\n  }\n}, 4);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 5);\n\nvar NoOp = function () {};\n\nvar UserStatusClass =\n/*#__PURE__*/\nfunction () {\n  function UserStatusClass() {\n    var _this = this;\n\n    Session.setDefault('UserStatusIdle', false);\n    this.status = new ReactiveVar('offline');\n    this.hidden = {};\n    /* @description Set right visibilitychange event and property names */\n\n    this.hidden.str = false;\n    this.hidden.evt = void 0;\n\n    if (typeof document.hidden !== 'undefined') {\n      this.hidden.str = 'hidden';\n      this.hidden.evt = 'visibilitychange';\n    } else if (typeof document.mozHidden !== 'undefined') {\n      this.hidden.str = 'mozHidden';\n      this.hidden.evt = 'mozvisibilitychange';\n    } else if (typeof document.msHidden !== 'undefined') {\n      this.hidden.str = 'msHidden';\n      this.hidden.evt = 'msvisibilitychange';\n    } else if (typeof document.webkitHidden !== 'undefined') {\n      this.hidden.str = 'webkitHidden';\n      this.hidden.evt = 'webkitvisibilitychange';\n    }\n\n    this.hidden.check = function () {\n      return document[_this.hidden.str];\n    };\n    /* @description Set active/inactive user status */\n\n\n    this.hidden.set = function () {\n      if (_this.hidden.check()) {\n        _this.goIdle();\n      } else {\n        _this.goOnline();\n      }\n    };\n\n    Tracker.autorun(function () {\n      var _user = Meteor.user();\n\n      if (_user) {\n        Session.set('UserStatusIdle', _user.profile.idle || false);\n\n        if (_user.profile.idle) {\n          _this.status.set('idle');\n        } else if (_user.profile.online) {\n          _this.status.set('online');\n        } else {\n          _this.status.set('offline');\n        }\n      } else {\n        Session.set('UserStatusIdle', false);\n\n        _this.status.set('offline');\n      }\n    });\n    /* @description Set event listeners */\n\n    this.on(document, [this.hidden.evt], this.hidden.set);\n    this.on(window, ['mousemove', 'mousedown', 'keypress', 'DOMMouseScroll', 'mousewheel', 'touchmove', 'MSPointerMove', 'MSPointerMove'], throttle(this.goOnline.bind(this), 777));\n    this.on(document, ['mousemove', 'mousedown', 'keypress', 'DOMMouseScroll', 'mousewheel', 'touchmove', 'MSPointerMove', 'MSPointerMove'], throttle(this.goOnline.bind(this), 777));\n  }\n\n  var _proto = UserStatusClass.prototype;\n\n  _proto.on = function () {\n    function on(obj, events, fn) {\n      events.forEach(function (event) {\n        if (obj.addEventListener) {\n          obj.addEventListener(event, fn, {\n            passive: true,\n            capture: false\n          });\n        } else {\n          obj.attachEvent('on' + event, fn);\n        }\n      });\n    }\n\n    return on;\n  }();\n\n  _proto.goOnline = function () {\n    function goOnline() {\n      var _user = Meteor.user();\n\n      if (_user && _user._id && (_user.profile.online !== true || _user.profile.idle !== false)) {\n        Meteor.users.update({\n          _id: _user._id\n        }, {\n          $set: {\n            'profile.online': true,\n            'profile.idle': false\n          }\n        }, NoOp);\n      }\n    }\n\n    return goOnline;\n  }();\n\n  _proto.goIdle = function () {\n    function goIdle() {\n      var _user = Meteor.user();\n\n      if (_user && _user._id && (_user.profile.online !== true || _user.profile.idle !== true)) {\n        Meteor.users.update({\n          _id: _user._id\n        }, {\n          $set: {\n            'profile.online': true,\n            'profile.idle': true\n          }\n        }, NoOp);\n      }\n    }\n\n    return goIdle;\n  }();\n\n  _proto.goOffline = function () {\n    function goOffline() {\n      var _user = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : Meteor.user();\n\n      if (_user && _user._id && (_user.profile.online !== false || _user.profile.idle !== false)) {\n        Meteor.users.update({\n          _id: _user._id\n        }, {\n          $set: {\n            'profile.online': false,\n            'profile.idle': false\n          }\n        }, NoOp);\n      }\n    }\n\n    return goOffline;\n  }();\n\n  _proto.startTimer = function () {\n    function startTimer() {\n      Meteor.setInterval(this.goIdle.bind(this), 30000);\n    }\n\n    return startTimer;\n  }();\n\n  _proto.start = function () {\n    function start() {\n      this.startTimer();\n    }\n\n    return start;\n  }();\n\n  return UserStatusClass;\n}();\n\nvar UserStatus = new UserStatusClass();\nAccounts.onLogin(UserStatus.start.bind(UserStatus));\nAccounts.onLogout(UserStatus.goOffline.bind(UserStatus));","map":{"version":3,"sources":["packages/ostrio:user-status/client/main.js"],"names":["module","export","UserStatus","throttle","link","v","Meteor","Session","Tracker","Accounts","ReactiveVar","NoOp","UserStatusClass","setDefault","status","hidden","str","evt","document","mozHidden","msHidden","webkitHidden","check","set","goIdle","goOnline","autorun","_user","user","profile","idle","online","on","window","bind","obj","events","fn","forEach","event","addEventListener","passive","capture","attachEvent","_id","users","update","$set","goOffline","startTimer","setInterval","start","onLogin","onLogout"],"mappings":"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","sourcesContent":["import throttle        from './throttle';\nimport { Meteor }      from 'meteor/meteor';\nimport { Session }     from 'meteor/session';\nimport { Tracker }     from 'meteor/tracker';\nimport { Accounts }    from 'meteor/accounts-base';\nimport { ReactiveVar } from 'meteor/reactive-var';\n\nconst NoOp = function() {};\n\nclass UserStatusClass {\n  constructor() {\n    Session.setDefault('UserStatusIdle', false);\n    this.status = new ReactiveVar('offline');\n    this.hidden = {};\n\n    /* @description Set right visibilitychange event and property names */\n    this.hidden.str = false;\n    this.hidden.evt = void 0;\n    if (typeof document.hidden !== 'undefined') {\n      this.hidden.str = 'hidden';\n      this.hidden.evt = 'visibilitychange';\n    } else if (typeof document.mozHidden !== 'undefined') {\n      this.hidden.str = 'mozHidden';\n      this.hidden.evt = 'mozvisibilitychange';\n    } else if (typeof document.msHidden !== 'undefined') {\n      this.hidden.str = 'msHidden';\n      this.hidden.evt = 'msvisibilitychange';\n    } else if (typeof document.webkitHidden !== 'undefined') {\n      this.hidden.str = 'webkitHidden';\n      this.hidden.evt = 'webkitvisibilitychange';\n    }\n\n    this.hidden.check = () => {\n      return document[this.hidden.str];\n    };\n\n    /* @description Set active/inactive user status */\n    this.hidden.set = () => {\n      if (this.hidden.check()) {\n        this.goIdle();\n      } else {\n        this.goOnline();\n      }\n    };\n\n    Tracker.autorun(() => {\n      const _user = Meteor.user();\n      if (_user) {\n        Session.set('UserStatusIdle', _user.profile.idle || false);\n        if (_user.profile.idle) {\n          this.status.set('idle');\n        } else if (_user.profile.online) {\n          this.status.set('online');\n        } else {\n          this.status.set('offline');\n        }\n      } else {\n        Session.set('UserStatusIdle', false);\n        this.status.set('offline');\n      }\n    });\n\n    /* @description Set event listeners */\n    this.on(document, [this.hidden.evt], this.hidden.set);\n    this.on(window, ['mousemove', 'mousedown', 'keypress', 'DOMMouseScroll', 'mousewheel', 'touchmove', 'MSPointerMove', 'MSPointerMove'], throttle(this.goOnline.bind(this), 777));\n    this.on(document, ['mousemove', 'mousedown', 'keypress', 'DOMMouseScroll', 'mousewheel', 'touchmove', 'MSPointerMove', 'MSPointerMove'], throttle(this.goOnline.bind(this), 777));\n  }\n\n  on(obj, events, fn) {\n    events.forEach((event) => {\n      if (obj.addEventListener) {\n        obj.addEventListener(event, fn, { passive: true, capture: false });\n      } else {\n        obj.attachEvent('on' + event, fn);\n      }\n    });\n  }\n\n  goOnline() {\n    const _user = Meteor.user();\n    if (_user && _user._id && (_user.profile.online !== true || _user.profile.idle !== false)) {\n      Meteor.users.update({\n        _id: _user._id\n      }, {\n        $set: {\n          'profile.online': true,\n          'profile.idle': false\n        }\n      }, NoOp);\n    }\n  }\n\n  goIdle() {\n    const _user = Meteor.user();\n    if (_user && _user._id && (_user.profile.online !== true || _user.profile.idle !== true)) {\n      Meteor.users.update({\n        _id: _user._id\n      }, {\n        $set: {\n          'profile.online': true,\n          'profile.idle': true\n        }\n      }, NoOp);\n    }\n  }\n\n  goOffline(_user = Meteor.user()) {\n    if (_user && _user._id && (_user.profile.online !== false || _user.profile.idle !== false)) {\n      Meteor.users.update({\n        _id: _user._id\n      }, {\n        $set: {\n          'profile.online': false,\n          'profile.idle': false\n        }\n      }, NoOp);\n    }\n  }\n\n  startTimer() {\n    Meteor.setInterval(this.goIdle.bind(this), 30000);\n  }\n\n  start() {\n    this.startTimer();\n  }\n}\n\nconst UserStatus = new UserStatusClass();\nAccounts.onLogin(UserStatus.start.bind(UserStatus));\nAccounts.onLogout(UserStatus.goOffline.bind(UserStatus));\n\nexport { UserStatus };\n"]},"sourceType":"script","hash":"7fdd39a60e16e7e6b2276e6d951113d2451f127b"}
