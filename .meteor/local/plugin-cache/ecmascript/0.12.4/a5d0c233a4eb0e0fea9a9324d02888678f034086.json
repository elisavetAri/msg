{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\components\\select2ValueEditor\\select2ValueEditor.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/znewsham:dynamic-table/client/ui/components/select2ValueEditor/select2ValueEditor.js","filename":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\components\\select2ValueEditor\\select2ValueEditor.js","passPerPreset":false,"envName":"development","cwd":"C:\\Sandbox\\test","root":"C:\\Sandbox\\test","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\components\\select2ValueEditor\\select2ValueEditor.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/znewsham:dynamic-table/client/ui/components/select2ValueEditor/select2ValueEditor.js"}},"code":"module.link(\"./select2ValueEditor.html\");\nvar getValue, inlineSave, nextField;\nmodule.link(\"../../../inlineSave.js\", {\n  getValue: function (v) {\n    getValue = v;\n  },\n  inlineSave: function (v) {\n    inlineSave = v;\n  },\n  nextField: function (v) {\n    nextField = v;\n  }\n}, 0);\n\nfunction getAjaxConfig(origOptions, optionsResult) {\n  var self = this;\n\n  if (!_.isFunction(origOptions) || optionsResult) {\n    return undefined;\n  }\n\n  var hadResults = false;\n  return {\n    transport: function (params, success, failure) {\n      var val = self.data.value || getValue(self.data.doc, self.data.column.data) || [];\n      origOptions(self.data.doc, self.data.column, val, params.data.q, function (results) {\n        if (results.length && !hadResults) {\n          var select = self.$(\"select\");\n          select.empty();\n          results.forEach(function (result) {\n            select.append($(\"<option selected=\\\"selected\\\" aria-selected=\\\"true\\\">\").text(result.text).val(result.id));\n          });\n          select.val(val).trigger(\"change\");\n          hadResults = true;\n        }\n\n        success({\n          results: results\n        });\n      });\n    }\n  };\n}\n\nfunction handler(e) {\n  if (nextField.inProgress) {\n    return;\n  }\n\n  var $select = $(e.currentTarget).closest(\"td\").find(\".dynamicTableSelect2ValueEditor\");\n\n  if (!$select.length) {\n    var possibles = _.toArray($(\".select2-container\"));\n\n    $select = $(possibles.find(function (elem) {\n      return $(elem).data(\"element\").data(\"select2\").$dropdown.find(e.currentTarget).length;\n    })).closest(\"td\").find(\".dynamicTableSelect2ValueEditor\");\n  }\n\n  if (!$select.length) {\n    return;\n  }\n\n  var tmplInstance = Blaze.getView($select[0]).templateInstance();\n\n  if (e.keyCode === 9) {\n    inlineSave(tmplInstance, $select.val());\n    nextField(tmplInstance);\n  }\n} // NOTE: not sure why we need different handlers for multi vs single? Could be JP-common code?\n\n\njQuery(document).ready(function ($) {\n  $(document).on('keydown', '.select2-search--dropdown input.select2-search__field', handler);\n  $(document).on('keyup', '.select2-selection--multiple input.select2-search__field', handler);\n});\nTemplate.dynamicTableSelect2ValueEditor.onRendered(function () {\n  function onRendered() {\n    var _this = this;\n\n    var options = this.data.options;\n    var val = this.data.value || getValue(this.data.doc, this.data.column.data) || [];\n    var origOptions = options;\n\n    if (_.isFunction(options)) {\n      options = options(this.data.doc, this.data.column, val);\n    }\n\n    this.$(\"select\").select2({\n      multiple: !!this.data.multiple,\n      allowClear: true,\n      tags: this.data.tags || !options,\n      createTag: _.isFunction(this.data.createTag) ? this.data.createTag : function (params) {\n        var term = $.trim(params.term);\n\n        if (term === \"\" || _this.data.createTag === false) {\n          return null;\n        }\n\n        return {\n          id: term,\n          text: term\n        };\n      },\n      ajax: getAjaxConfig.call(this, origOptions, options),\n      data: [{\n        id: [],\n        text: \"\",\n        search: \"\",\n        hidden: false\n      }].concat(options || []),\n      placeholder: {\n        id: [],\n        text: \"Add tags\"\n      }\n    });\n    this.$(\"select\").val(val);\n    this.$(\"select\").trigger(\"change\");\n    this.$(\"select\").select2(\"open\");\n\n    if (this.handler) {\n      document.removeEventListener(\"mousedown\", this.handler, false);\n    }\n\n    this.handler = function (e) {\n      try {\n        var container = _this.$(\"select\").data(\"select2\").$container;\n\n        if (!container.has($(e.target)).length) {\n          inlineSave(_this, _this.$(\"select\").val(), _this.$(\"select\").data(\"select2\").data());\n        }\n      } catch (e1) {\n        document.removeEventListener(\"mousedown\", _this.handler, false);\n      }\n    };\n\n    document.addEventListener(\"mousedown\", this.handler, false);\n  }\n\n  return onRendered;\n}());\nTemplate.dynamicTableSelect2ValueEditor.onDestroyed(function () {\n  function onDestroyed() {\n    this.$(\"select\").select2(\"destroy\");\n    document.removeEventListener(\"mousedown\", this.handler, false);\n  }\n\n  return onDestroyed;\n}());\nTemplate.dynamicTableSelect2ValueEditor.events({\n  \"select2:close select\": function (e, templInstance) {\n    var target = e.currentTarget;\n\n    if (templInstance.waiting) {\n      clearTimeout(templInstance.waiting);\n    }\n\n    var data = templInstance.$(\"select\").data(\"select2\").data();\n    templInstance.waiting = setTimeout(function () {\n      if (!templInstance.data.multiple) {\n        inlineSave(templInstance, $(target).val(), data);\n      }\n    }, 100);\n  }\n});","map":{"version":3,"sources":["packages/znewsham:dynamic-table/client/ui/components/select2ValueEditor/select2ValueEditor.js"],"names":["module","link","getValue","inlineSave","nextField","v","getAjaxConfig","origOptions","optionsResult","self","_","isFunction","undefined","hadResults","transport","params","success","failure","val","data","value","doc","column","q","results","length","select","$","empty","forEach","result","append","text","id","trigger","handler","e","inProgress","$select","currentTarget","closest","find","possibles","toArray","elem","$dropdown","tmplInstance","Blaze","getView","templateInstance","keyCode","jQuery","document","ready","on","Template","dynamicTableSelect2ValueEditor","onRendered","options","select2","multiple","allowClear","tags","createTag","term","trim","ajax","call","search","hidden","concat","placeholder","removeEventListener","container","$container","has","target","e1","addEventListener","onDestroyed","events","templInstance","waiting","clearTimeout","setTimeout"],"mappings":"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","sourcesContent":["import \"./select2ValueEditor.html\";\nimport { getValue, inlineSave, nextField } from \"../../../inlineSave.js\";\n\nfunction getAjaxConfig(origOptions, optionsResult) {\n  const self = this;\n  if (!_.isFunction(origOptions) || optionsResult) {\n    return undefined;\n  }\n  let hadResults = false;\n  return {\n    transport(params, success, failure) {\n      const val = self.data.value || getValue(self.data.doc, self.data.column.data) || [];\n      origOptions(self.data.doc, self.data.column, val, params.data.q, (results) => {\n        if (results.length && !hadResults) {\n          const select = self.$(\"select\");\n          select.empty();\n          results.forEach((result) => {\n            select.append($(\"<option selected=\\\"selected\\\" aria-selected=\\\"true\\\">\").text(result.text).val(result.id));\n          });\n          select.val(val).trigger(\"change\");\n          hadResults = true;\n        }\n        success({ results });\n      });\n    }\n  };\n}\n\nfunction handler(e) {\n  if (nextField.inProgress) {\n    return;\n  }\n  let $select = $(e.currentTarget).closest(\"td\").find(\".dynamicTableSelect2ValueEditor\");\n  if (!$select.length) {\n    const possibles = _.toArray($(\".select2-container\"));\n    $select = $(\n      possibles\n      .find(elem => $(elem).data(\"element\").data(\"select2\").$dropdown.find(e.currentTarget).length)\n    )\n    .closest(\"td\")\n    .find(\".dynamicTableSelect2ValueEditor\");\n  }\n  if (!$select.length) {\n    return;\n  }\n  const tmplInstance = Blaze.getView($select[0]).templateInstance();\n  if (e.keyCode === 9) {\n    inlineSave(tmplInstance, $select.val());\n    nextField(tmplInstance);\n  }\n}\n\n// NOTE: not sure why we need different handlers for multi vs single? Could be JP-common code?\njQuery(document).ready(($) => {\n  $(document).on('keydown', '.select2-search--dropdown input.select2-search__field', handler);\n  $(document).on('keyup', '.select2-selection--multiple input.select2-search__field', handler);\n});\n\nTemplate.dynamicTableSelect2ValueEditor.onRendered(function onRendered() {\n  let options = this.data.options;\n  const val = this.data.value || getValue(this.data.doc, this.data.column.data) || [];\n  const origOptions = options;\n  if (_.isFunction(options)) {\n    options = options(this.data.doc, this.data.column, val);\n  }\n  this.$(\"select\").select2({\n    multiple: !!this.data.multiple,\n    allowClear: true,\n    tags: this.data.tags || !options,\n    createTag: _.isFunction(this.data.createTag) ? this.data.createTag : ((params) => {\n      const term = $.trim(params.term);\n\n      if (term === \"\" || this.data.createTag === false) {\n        return null;\n      }\n\n      return {\n        id: term,\n        text: term\n      };\n    }),\n    ajax: getAjaxConfig.call(this, origOptions, options),\n    data: [{\n      id: [],\n      text: \"\",\n      search: \"\",\n      hidden: false\n    }].concat(options || []),\n    placeholder: {\n      id: [],\n      text: \"Add tags\"\n    }\n  });\n  this.$(\"select\").val(val);\n  this.$(\"select\").trigger(\"change\");\n  this.$(\"select\").select2(\"open\");\n  if (this.handler) {\n    document.removeEventListener(\"mousedown\", this.handler, false);\n  }\n  this.handler = (e) => {\n    try {\n      const container = this.$(\"select\").data(\"select2\").$container;\n      if (!container.has($(e.target)).length) {\n        inlineSave(this, this.$(\"select\").val(), this.$(\"select\").data(\"select2\").data());\n      }\n    }\n    catch (e1) {\n      document.removeEventListener(\"mousedown\", this.handler, false);\n    }\n  };\n  document.addEventListener(\"mousedown\", this.handler, false);\n});\nTemplate.dynamicTableSelect2ValueEditor.onDestroyed(function onDestroyed() {\n  this.$(\"select\").select2(\"destroy\");\n  document.removeEventListener(\"mousedown\", this.handler, false);\n});\n\nTemplate.dynamicTableSelect2ValueEditor.events({\n  \"select2:close select\"(e, templInstance) {\n    const target = e.currentTarget;\n    if (templInstance.waiting) {\n      clearTimeout(templInstance.waiting);\n    }\n    const data = templInstance.$(\"select\").data(\"select2\").data();\n    templInstance.waiting = setTimeout(() => {\n      if (!templInstance.data.multiple) {\n        inlineSave(templInstance, $(target).val(), data);\n      }\n    }, 100);\n  }\n});\n"]},"sourceType":"script","hash":"a5d0c233a4eb0e0fea9a9324d02888678f034086"}
