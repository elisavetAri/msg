{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\components\\filterModal\\filterModal.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/znewsham:dynamic-table/client/ui/components/filterModal/filterModal.js","filename":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\components\\filterModal\\filterModal.js","passPerPreset":false,"envName":"development","cwd":"C:\\Sandbox\\test","root":"C:\\Sandbox\\test","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\components\\filterModal\\filterModal.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/znewsham:dynamic-table/client/ui/components/filterModal/filterModal.js"}},"code":"let ReactiveDict;\nmodule.link(\"meteor/reactive-dict\", {\n  ReactiveDict(v) {\n    ReactiveDict = v;\n  }\n\n}, 0);\n\nlet _;\n\nmodule.link(\"underscore\", {\n  default(v) {\n    _ = v;\n  }\n\n}, 1);\nmodule.link(\"../manageColumnsForm/manageColumnsForm.js\");\nmodule.link(\"./filterModal.html\");\nmodule.link(\"./filterModal.css\");\n\nfunction closeModal() {\n  const filterModalWrapper = $(\"#dynamic-table-filter-modal\")[0];\n\n  if (filterModalWrapper) {\n    Blaze.remove(filterModalWrapper.__blazeTemplate);\n    filterModalWrapper.innerHTML = \"\";\n  }\n}\n\nTemplate.dynamicTableFilterModal.helpers({\n  manageFieldsEditContext() {\n    return Template.instance().data.field.edit;\n  },\n\n  showOperators() {\n    return Template.instance().showOperators.get();\n  },\n\n  hasFooter() {\n    return this.filter && (this.filter.enabled || !this.filter.required);\n  },\n\n  checkedIfWithValue() {\n    return [\"$between\", \"$in\", \"$regex\"].includes(this.filter.operator.selected) ? {\n      selected: \"selected\"\n    } : {};\n  },\n\n  checkedIfWithAllValue() {\n    return [\"$all\"].includes(this.filter.operator.selected) ? {\n      selected: \"selected\"\n    } : {};\n  },\n\n  checkedIfGteValue() {\n    return this.filter.operator.selected === \"$gte\" ? {\n      selected: \"selected\"\n    } : {};\n  },\n\n  checkedIfLteValue() {\n    return this.filter.operator.selected === \"$lte\" ? {\n      selected: \"selected\"\n    } : {};\n  },\n\n  checkedIfWithoutValue() {\n    return [\"$nin\"].includes(this.filter.operator.selected) ? {\n      selected: \"selected\"\n    } : {};\n  },\n\n  checkedIfWithoutAllValue() {\n    return [\"$not$all\"].includes(this.filter.operator.selected) ? {\n      selected: \"selected\"\n    } : {};\n  },\n\n  searchEnabled() {\n    if (this.filter.options) {\n      return this.filter.search && this.filter.search.enabled;\n    }\n\n    return this.filter.search === undefined || this.filter.search.enabled !== false;\n  },\n\n  isAny() {\n    return [\"$in\", \"$nin\"].includes(Template.instance().operator.get());\n  },\n\n  isAll() {\n    return [\"$all\", \"$not$all\"].includes(Template.instance().operator.get());\n  },\n\n  isNumericOrDateAndNoOptions() {\n    const fieldType = Template.instance().fieldType.get();\n    const isNumericOrDate = fieldType && (fieldType === \"time\" || fieldType === Number || fieldType === Date);\n    return isNumericOrDate && Template.instance().allOptions.get().length === 0;\n  },\n\n  isNumericOrDate() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType && (fieldType === \"time\" || fieldType === Number || fieldType === Date);\n  },\n\n  isTime() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType && fieldType === \"time\";\n  },\n\n  isNumber() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType && fieldType === Number;\n  },\n\n  isDate() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType && fieldType === Date;\n  },\n\n  isStringOrCustom() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType === String || fieldType !== Number && fieldType !== Date && fieldType !== \"time\";\n  },\n\n  isString() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType === String;\n  },\n\n  sortDirection(direction) {\n    return Template.instance().sortDirection.get() === direction;\n  },\n\n  checkedIf(opA, opB) {\n    if (_.isArray(opA)) {\n      return opA.includes(opB) ? {\n        checked: \"checked\"\n      } : {};\n    }\n\n    return opA === opB ? {\n      checked: \"checked\"\n    } : {};\n  },\n\n  checkedIfSelected(o) {\n    const found = _.find(Template.instance().selectedOptions.get(), value => value instanceof Date ? value.toString() === o.toString() : value === o);\n\n    return found ? {\n      checked: \"checked\"\n    } : {};\n  },\n\n  hasOptions() {\n    if (Template.instance().asyncOptions.get()) {\n      return true;\n    }\n\n    const options = Template.instance().allOptions.get();\n    return options && options.length;\n  },\n\n  options() {\n    return Template.instance().options.get().map(o => _.extend({\n      _id: o.value instanceof Date ? o.value.toString() : o.value\n    }, o));\n  },\n\n  hasSelectedOptions() {\n    const options = Template.instance().selectedOptions.get();\n    return options && options.length;\n  },\n\n  selectedOptions() {\n    const options = Template.instance().allOptions.get();\n\n    if (!options) {\n      return [];\n    }\n\n    const selectedOptions = _.compact(Template.instance().selectedOptions.get().map(o => {\n      const match = _.find(options, (_ref) => {\n        let {\n          value\n        } = _ref;\n        return value instanceof Date ? value.toString() === o.toString() : value === o;\n      });\n\n      return match;\n    }));\n\n    return selectedOptions.map(o => _.extend({\n      _id: o.value instanceof Date ? o.value.toString() : o.value\n    }, o));\n  },\n\n  searching() {\n    return Template.instance().searching.get();\n  },\n\n  loading() {\n    return Template.instance().data.dataTable && Template.instance().data.dataTable.loading.get();\n  },\n\n  isArrayField() {\n    return Template.instance().isArrayField.get();\n  },\n\n  dateValue() {\n    const date = Template.instance().data.filter.search.value;\n\n    if (date) {\n      return \"\".concat(date.getFullYear(), \"-\").concat(date.getMonth() + 1, \"-\").concat(date.getDate());\n    }\n  },\n\n  numberValue() {\n    return Template.instance().data.filter.search.value;\n  },\n\n  minuteValue() {\n    const time = Template.instance().data.filter.search.value;\n\n    if (time) {\n      return Math.floor(time / 60);\n    }\n  },\n\n  secondValue() {\n    const time = Template.instance().data.filter.search.value;\n\n    if (time) {\n      return time % 60;\n    }\n  },\n\n  editing() {\n    return Template.instance().editing.get();\n  },\n\n  isChanged(field) {\n    const newValue = Template.instance().currentSpec.get(field);\n    return newValue !== undefined && newValue !== Template.instance().editableField.get()[field];\n  },\n\n  editableField() {\n    return Template.instance().editableField.get();\n  },\n\n  fieldLabel() {\n    return Template.instance().fieldLabel.get();\n  }\n\n});\n\nfunction doSearch(e, templInstance) {\n  const elem = $(e.currentTarget);\n  const fieldType = templInstance.fieldType.get();\n\n  if (fieldType === Date) {\n    const date = new Date(elem.val());\n\n    if (!Number.isNaN(date.getTime())) {\n      templInstance.search.set(date);\n    } else {\n      templInstance.search.set(undefined);\n    }\n  } else if (fieldType === Number) {\n    templInstance.search.set(parseInt(templInstance.$(\".input-dynamic-table-search\").val(), 10));\n  } else if (fieldType === \"time\") {\n    const mins = parseInt($(templInstance.$(\".input-dynamic-table-search\")[0]).val(), 10) || 0;\n    const secs = parseInt($(templInstance.$(\".input-dynamic-table-search\")[1]).val(), 10) || 0;\n    templInstance.search.set(mins * 60 + secs);\n  }\n}\n\nTemplate.dynamicTableFilterModal.events({\n  \"change .dynamic-table-filter-edit-type\"(e, templInstance) {\n    templInstance.currentSpec.set(\"type\", $(e.currentTarget).val());\n  },\n\n  \"click .dynamic-table-filter-edit-isArray\"(e, templInstance) {\n    templInstance.currentSpec.set(\"isArray\", $(e.currentTarget).is(\":checked\"));\n  },\n\n  \"click .dynamic-table-filter-edit-searchable\"(e, templInstance) {\n    templInstance.currentSpec.set(\"indexedNumber\", $(e.currentTarget).is(\":checked\") ? this.field.edit.spec.indexedNumber === false ? \"new\" : this.field.edit.spec.indexedNumber : false);\n  },\n\n  \"click .btn-dynamic-table-cancel\"(e, templInstance) {\n    templInstance.editing.set(false);\n  },\n\n  \"click .btn-dynamic-table-save\"(e, templInstance) {\n    templInstance.$(\".btn-dynamic-table-save\").attr(\"disabled\", \"disabled\");\n    templInstance.data.field.edit.callback(e, templInstance).then(newFieldSpec => {\n      templInstance.$(\".btn-dynamic-table-save\").removeAttr(\"disabled\");\n      Tracker.nonreactive(() => {\n        templInstance.editableField.set(newFieldSpec);\n      });\n      let fieldType = newFieldSpec.type;\n\n      if (fieldType === \"string\") {\n        fieldType = String;\n      } else if (fieldType === \"number\") {\n        fieldType = Number;\n      } else if (fieldType === \"date\") {\n        fieldType = Date;\n      }\n\n      templInstance.isArrayField.set(newFieldSpec.isArray);\n      templInstance.fieldType.set(fieldType);\n      templInstance.fieldLabel.set(newFieldSpec.label);\n      templInstance.editing.set(false);\n      templInstance.data.editFieldCallback(newFieldSpec);\n    }).catch(err => {\n      console.error(err);\n    });\n  },\n\n  \"click .dynamic-table-filter-edit-btn\"(e, templInstance) {\n    templInstance.editing.set(true);\n  },\n\n  \"click .btn-dynamic-table-remove\"(e, templInstance) {\n    templInstance.data.callback([], \"$in\", undefined, false);\n    templInstance.data.removeColumn();\n    closeModal();\n  },\n\n  \"click .btn-dynamic-table-clear\"(e, templInstance) {\n    templInstance.search.set(undefined);\n    templInstance.selectedOptions.set([]);\n    templInstance.$(\".input-dynamic-table-search\").val(\"\"); // templInstance.data.callback([], \"$in\", undefined, false);\n  },\n\n  \"click .btn-dynamic-table-sort\"(e, templInstance) {\n    templInstance.sortDirection.set($(e.currentTarget).data(\"direction\"));\n  },\n\n  \"change .input-dynamic-table-operator\"(e, templInstance) {\n    const options = Template.instance().options.get();\n    const hasOptions = options && options.length;\n    let operator = $(e.currentTarget).val();\n\n    if (operator === \"$in\") {\n      if (!hasOptions) {\n        operator = \"$regex\";\n      }\n\n      if (templInstance.$(\".btn-dynamic-table-operator.btn-dynamic-table-selected\").data(\"modifier\") === \"$all\") {\n        operator = \"$all\";\n      }\n    }\n\n    if (operator === \"$nin\") {\n      if (!hasOptions) {\n        operator = \"$not\";\n      }\n    }\n\n    templInstance.operator.set(operator);\n  },\n\n  \"click .fa-cog\"(e, templInstance) {\n    templInstance.showOperators.set(!templInstance.showOperators.get());\n  },\n\n  \"change .select-dynamic-table-operator\"(e, templInstance) {\n    const options = Template.instance().options.get();\n    const hasOptions = options && options.length;\n    let operator = $(e.currentTarget).val();\n\n    if (operator === \"$in\") {\n      if (!hasOptions) {\n        operator = \"$regex\";\n      }\n    }\n\n    if (operator === \"$nin\") {\n      if (!hasOptions) {\n        operator = \"$not\";\n      }\n    }\n\n    templInstance.operator.set(operator);\n  },\n\n  \"click .label-dynamic-table-selected\"(e, templInstance) {\n    const selectedOptions = templInstance.selectedOptions.get();\n    const newOption = $(e.currentTarget).data(\"value\");\n    templInstance.selectedOptions.set(selectedOptions.filter(f => f instanceof Date ? f.toString() !== newOption : f !== newOption));\n  },\n\n  \"click .input-dynamic-table-option\"(e, templInstance) {\n    const selectedOptions = templInstance.selectedOptions.get();\n    const newOption = $(e.currentTarget).val();\n\n    if ($(e.currentTarget).is(\":checked\")) {\n      templInstance.selectedOptions.set(_.union(selectedOptions, [newOption]));\n    } else {\n      templInstance.selectedOptions.set(selectedOptions.filter(f => f instanceof Date ? f.toString() !== newOption : f !== newOption));\n    }\n  },\n\n  \"keyup .input-dynamic-table-search\"(e, templInstance) {\n    const elem = $(e.currentTarget);\n    const data = Template.instance().data;\n    const fieldType = templInstance.fieldType.get();\n\n    if (fieldType === Date || fieldType === \"time\" || fieldType === Number) {\n      doSearch(e, templInstance);\n      return;\n    }\n\n    if (_.isArray(data.filter.options)) {\n      templInstance.search.set(elem.val());\n    } else {\n      templInstance.searching.set(true);\n      templInstance.throttledUpdate(templInstance.search, elem.val());\n    }\n  },\n\n  \"change .input-dynamic-table-search\"(e, templInstance) {\n    doSearch(e, templInstance);\n  }\n\n});\nTemplate.dynamicTableFilterModal.onRendered(function onRendered() {\n  Tracker.autorun(() => {\n    if (this.editing.get()) {\n      Tracker.afterFlush(() => {\n        if ($.fn.select2) {\n          this.$(\".dynamic-table-filter-edit-group\").select2({\n            tags: true,\n            placeholder: \"Select a Group\",\n            allowClear: true,\n            data: _.union([{\n              id: \"\",\n              value: \"\"\n            }], this.data.groupNames.map(g => ({\n              id: g,\n              text: g\n            })))\n          });\n          this.$(\".dynamic-table-filter-edit-group\").val(this.editableField.get().groupName).trigger(\"change\");\n        }\n      });\n    }\n  });\n  /**\n   * When filter modal is open over any existing bootstrap modal,\n   * input element i.e search field of filter modal is not clickable,\n   * To fix it, we get rid of focus on bootstrap modal\n   */\n\n  $(document).off(\"focusin.modal\");\n});\nTemplate.dynamicTableFilterModal.onCreated(function onCreated() {\n  this.editableField = new ReactiveVar(this.data.field && this.data.field.edit && this.data.field.edit.spec);\n  this.isArrayField = new ReactiveVar(false);\n  this.fieldLabel = new ReactiveVar(this.data.field && this.data.field.label);\n  this.fieldType = new ReactiveVar(this.data.field && this.data.field.type);\n\n  if (this.data.field && this.data.field.type && _.isArray(this.data.field && this.data.field.type)) {\n    this.fieldType.set(this.data.field.type[0]);\n    this.isArrayField.set(true);\n  }\n\n  this.currentSpec = new ReactiveDict();\n  this.editing = new ReactiveVar(false);\n  this.showOperators = new ReactiveVar(this.data.filter && this.data.filter.operator && this.data.filter.operator.selected && ![\"$in\", \"$regex\", \"$between\"].includes(this.data.filter.operator.selected));\n  this.options = new ReactiveVar();\n  this.allOptions = new ReactiveVar([]);\n  this.search = new ReactiveVar(this.data.filter && this.data.filter.search && this.data.filter.search.value);\n  this.searching = new ReactiveVar(false);\n  this.selectedOptions = new ReactiveVar([]);\n  this.searchChanged = new Tracker.Dependency();\n  this.sortDirection = new ReactiveVar(this.data.sort && this.data.sort.direction);\n  this.asyncOptions = new ReactiveVar(false);\n  this.operator = new ReactiveVar(this.data.filter && this.data.filter && this.data.filter.operator && this.data.filter.operator.selected);\n  this.throttledUpdate = _.throttle((reactiveVar, val) => {\n    reactiveVar.set(val);\n  }, this.data.filter && this.data.filter.throttle ? this.data.filter.throttle.wait : 1000, this.data.filter && this.data.filter.throttle ? this.data.filter.throttle.options : {\n    leading: false\n  });\n  const data = this.data;\n\n  if (data.filter && _.isFunction(data.filter.options)) {\n    const initSearch = data.filter.selectedOptions && !_.isArray(data.filter.selectedOptions) && data.filter.selectedOptions.length ? data.filter.selectedOptions : undefined;\n    const options = data.filter.options(data, initSearch, asyncOptions => {\n      this.asyncOptions.set(true);\n      this.allOptions.set(asyncOptions.map(o => typeof o === \"object\" ? o : {\n        label: o,\n        value: o\n      }));\n      this.options.set(asyncOptions.map(o => typeof o === \"object\" ? o : {\n        label: o,\n        value: o\n      }));\n      this.searching.set(false);\n    });\n\n    if (options instanceof Promise) {\n      options.then(asyncOptions => {\n        this.asyncOptions.set(true);\n        this.allOptions.set(asyncOptions.map(o => typeof o === \"object\" ? o : {\n          label: o,\n          value: o\n        }));\n        this.options.set(asyncOptions.map(o => typeof o === \"object\" ? o : {\n          label: o,\n          value: o\n        }));\n        this.searching.set(false);\n      });\n    } else if (options) {\n      this.allOptions.set(options.map(o => typeof o === \"object\" ? o : {\n        label: o,\n        value: o\n      }));\n      this.options.set(options.map(o => typeof o === \"object\" ? o : {\n        label: o,\n        value: o\n      }));\n      this.searching.set(false);\n    }\n  } else if (data.filter && _.isArray(data.filter.options)) {\n    this.allOptions.set(data.filter.options.map(o => typeof o === \"object\" ? o : {\n      label: o,\n      value: o\n    }));\n    this.options.set(data.filter.options.map(o => typeof o === \"object\" ? o : {\n      label: o,\n      value: o\n    }));\n  }\n\n  if (data.filter && data.filter.selectedOptions) {\n    if (_.isFunction(data.filter.selectedOptions)) {\n      const selectedOptions = data.filter.selectedOptions(data, asyncOptions => {\n        this.selectedOptions.set(asyncOptions);\n      });\n\n      if (selectedOptions instanceof Promise) {\n        selectedOptions.then(asyncOptions => {\n          this.selectedOptions.set(asyncOptions);\n        });\n      } else if (selectedOptions) {\n        this.selectedOptions.set(selectedOptions);\n      }\n    } else if (_.isArray(data.filter.selectedOptions)) {\n      this.selectedOptions.set(data.filter.selectedOptions);\n    }\n  }\n\n  let lastSearch;\n\n  if (data.filter && data.filter.options) {\n    this.autorun(() => {\n      const search = this.search.get();\n\n      if (search === lastSearch) {\n        return;\n      }\n\n      lastSearch = search;\n\n      if (_.isFunction(data.filter.options)) {\n        const options = data.filter.options(data, search, asyncOptions => {\n          this.options.set(asyncOptions.map(o => typeof o === \"object\" ? o : {\n            label: o,\n            value: o\n          }));\n          this.searching.set(false);\n        });\n\n        if (options instanceof Promise) {\n          options.then(asyncOptions => {\n            this.options.set(asyncOptions.map(o => typeof o === \"object\" ? o : {\n              label: o,\n              value: o\n            }));\n            this.searching.set(false);\n          });\n        } else if (options) {\n          this.options.set(options.map(o => typeof o === \"object\" ? o : {\n            label: o,\n            value: o\n          }));\n          this.searching.set(false);\n        }\n      } else if (_.isArray(data.filter.options)) {\n        if (search) {\n          this.options.set(data.filter.options.map(o => typeof o === \"object\" ? o : {\n            label: o,\n            value: o\n          }).filter(o => o.label.match(new RegExp(search, \"i\"))));\n        } else {\n          this.options.set(data.filter.options.map(o => typeof o === \"object\" ? o : {\n            label: o,\n            value: o\n          }));\n        }\n      }\n    });\n  }\n\n  const callback = this.data.callback;\n\n  if (callback && this.data.filter && this.data.filter.enabled) {\n    this.autorun(comp => {\n      let selectedOptions = this.selectedOptions.get();\n      let operator = this.operator.get();\n      const options = this.allOptions.get();\n      const fieldType = this.fieldType.get();\n\n      if (selectedOptions.length === 0 && (fieldType === Date || fieldType === \"time\" || fieldType === Number)) {\n        selectedOptions = this.search.get();\n        const numericSearches = [\"$gt\", \"$lt\", \"$gte\", \"$lte\", \"$between\"];\n\n        if (!numericSearches.includes(operator)) {\n          operator = \"$between\";\n        }\n\n        if (operator === \"$between\" && selectedOptions instanceof Date) {\n          selectedOptions = [selectedOptions, new Date(selectedOptions.getTime() + 24 * 60 * 60 * 1000)];\n        } else if (operator === \"$between\" && typeof selectedOptions === \"number\") {\n          // HACK: to handle equality of numbers\n          selectedOptions = [selectedOptions, selectedOptions];\n        }\n      } else if (!options || !options.length && !this.asyncOptions.get()) {\n        selectedOptions = this.search.get();\n\n        if (operator === \"$in\" || operator === \"$all\") {\n          operator = \"$regex\";\n        } else if (operator === \"$nin\" || operator === \"$not$all\") {\n          operator = \"$not\";\n        }\n      }\n\n      const direction = this.sortDirection.get();\n\n      if (comp.firstRun) {\n        return;\n      }\n\n      if (fieldType === Number) {\n        if (_.isArray(selectedOptions)) {\n          selectedOptions = selectedOptions.map(v => typeof v === \"number\" ? v : v.includes(\".\") ? parseFloat(v) : parseInt(v, 10));\n        }\n      }\n\n      if (fieldType === Date) {\n        if (_.isArray(selectedOptions)) {\n          selectedOptions = selectedOptions.map(v => new Date(v));\n        }\n      }\n\n      Tracker.nonreactive(() => callback(selectedOptions, operator, direction, false));\n    });\n  }\n});","map":{"version":3,"sources":["packages/znewsham:dynamic-table/client/ui/components/filterModal/filterModal.js"],"names":["ReactiveDict","module","link","v","_","default","closeModal","filterModalWrapper","$","Blaze","remove","__blazeTemplate","innerHTML","Template","dynamicTableFilterModal","helpers","manageFieldsEditContext","instance","data","field","edit","showOperators","get","hasFooter","filter","enabled","required","checkedIfWithValue","includes","operator","selected","checkedIfWithAllValue","checkedIfGteValue","checkedIfLteValue","checkedIfWithoutValue","checkedIfWithoutAllValue","searchEnabled","options","search","undefined","isAny","isAll","isNumericOrDateAndNoOptions","fieldType","isNumericOrDate","Number","Date","allOptions","length","isTime","isNumber","isDate","isStringOrCustom","String","isString","sortDirection","direction","checkedIf","opA","opB","isArray","checked","checkedIfSelected","o","found","find","selectedOptions","value","toString","hasOptions","asyncOptions","map","extend","_id","hasSelectedOptions","compact","match","searching","loading","dataTable","isArrayField","dateValue","date","getFullYear","getMonth","getDate","numberValue","minuteValue","time","Math","floor","secondValue","editing","isChanged","newValue","currentSpec","editableField","fieldLabel","doSearch","e","templInstance","elem","currentTarget","val","isNaN","getTime","set","parseInt","mins","secs","events","is","spec","indexedNumber","attr","callback","then","newFieldSpec","removeAttr","Tracker","nonreactive","type","label","editFieldCallback","catch","err","console","error","removeColumn","newOption","f","union","throttledUpdate","onRendered","autorun","afterFlush","fn","select2","tags","placeholder","allowClear","id","groupNames","g","text","groupName","trigger","document","off","onCreated","ReactiveVar","searchChanged","Dependency","sort","throttle","reactiveVar","wait","leading","isFunction","initSearch","Promise","lastSearch","RegExp","comp","numericSearches","firstRun","parseFloat"],"mappings":"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","sourcesContent":["import { ReactiveDict } from \"meteor/reactive-dict\";\nimport _ from \"underscore\";\nimport \"../manageColumnsForm/manageColumnsForm.js\";\nimport \"./filterModal.html\";\nimport \"./filterModal.css\";\n\nfunction closeModal() {\n  const filterModalWrapper = $(\"#dynamic-table-filter-modal\")[0];\n  if (filterModalWrapper) {\n    Blaze.remove(filterModalWrapper.__blazeTemplate);\n    filterModalWrapper.innerHTML = \"\";\n  }\n}\nTemplate.dynamicTableFilterModal.helpers({\n  manageFieldsEditContext() {\n    return Template.instance().data.field.edit;\n  },\n  showOperators() {\n    return Template.instance().showOperators.get();\n  },\n  hasFooter() {\n    return this.filter && (this.filter.enabled || !this.filter.required);\n  },\n  checkedIfWithValue() {\n    return [\"$between\", \"$in\", \"$regex\"].includes(this.filter.operator.selected) ? { selected: \"selected\" } : {};\n  },\n  checkedIfWithAllValue() {\n    return [\"$all\"].includes(this.filter.operator.selected) ? { selected: \"selected\" } : {};\n  },\n  checkedIfGteValue() {\n    return this.filter.operator.selected === \"$gte\" ? { selected: \"selected\" } : {};\n  },\n  checkedIfLteValue() {\n    return this.filter.operator.selected === \"$lte\" ? { selected: \"selected\" } : {};\n  },\n  checkedIfWithoutValue() {\n    return [\"$nin\"].includes(this.filter.operator.selected) ? { selected: \"selected\" } : {};\n  },\n  checkedIfWithoutAllValue() {\n    return [\"$not$all\"].includes(this.filter.operator.selected) ? { selected: \"selected\" } : {};\n  },\n  searchEnabled() {\n    if (this.filter.options) {\n      return this.filter.search && this.filter.search.enabled;\n    }\n    return this.filter.search === undefined || this.filter.search.enabled !== false;\n  },\n  isAny() {\n    return [\"$in\", \"$nin\"].includes(Template.instance().operator.get());\n  },\n  isAll() {\n    return [\"$all\", \"$not$all\"].includes(Template.instance().operator.get());\n  },\n  isNumericOrDateAndNoOptions() {\n    const fieldType = Template.instance().fieldType.get();\n    const isNumericOrDate = fieldType && (fieldType === \"time\" || fieldType === Number || fieldType === Date);\n\n    return isNumericOrDate && Template.instance().allOptions.get().length === 0;\n  },\n  isNumericOrDate() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType && (fieldType === \"time\" || fieldType === Number || fieldType === Date);\n  },\n  isTime() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType && (fieldType === \"time\");\n  },\n  isNumber() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType && (fieldType === Number);\n  },\n  isDate() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType && (fieldType === Date);\n  },\n  isStringOrCustom() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType === String || (fieldType !== Number && fieldType !== Date && fieldType !== \"time\");\n  },\n  isString() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType === String;\n  },\n  sortDirection(direction) {\n    return Template.instance().sortDirection.get() === direction;\n  },\n  checkedIf(opA, opB) {\n    if (_.isArray(opA)) {\n      return opA.includes(opB) ? { checked: \"checked\" } : {};\n    }\n    return opA === opB ? { checked: \"checked\" } : {};\n  },\n  checkedIfSelected(o) {\n    const found = _.find(Template.instance().selectedOptions.get(), (value) => value instanceof Date ? value.toString() === o.toString() : value === o);\n    return found ? { checked: \"checked\"} : {};\n  },\n  hasOptions() {\n    if (Template.instance().asyncOptions.get()) {\n      return true;\n    }\n    const options = Template.instance().allOptions.get();\n    return options && options.length;\n  },\n  options() {\n    return Template.instance().options.get().map(o => _.extend({ _id: o.value instanceof Date ? o.value.toString() : o.value }, o));\n  },\n  hasSelectedOptions() {\n    const options = Template.instance().selectedOptions.get();\n    return options && options.length;\n  },\n  selectedOptions() {\n    const options = Template.instance().allOptions.get();\n    if (!options) {\n      return [];\n    }\n    const selectedOptions = _.compact(Template.instance().selectedOptions.get().map((o) => {\n      const match = _.find(options, ({ value }) => value instanceof Date ? value.toString() === o.toString() : value === o);\n      return match;\n    }));\n    return selectedOptions.map(o => _.extend({ _id: o.value instanceof Date ? o.value.toString() : o.value }, o));\n  },\n  searching() {\n    return Template.instance().searching.get();\n  },\n  loading() {\n    return Template.instance().data.dataTable && Template.instance().data.dataTable.loading.get();\n  },\n  isArrayField() {\n    return Template.instance().isArrayField.get();\n  },\n  dateValue() {\n    const date = Template.instance().data.filter.search.value;\n    if (date) {\n      return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;\n    }\n  },\n  numberValue() {\n    return Template.instance().data.filter.search.value;\n  },\n  minuteValue() {\n    const time = Template.instance().data.filter.search.value;\n    if (time) {\n      return Math.floor(time / 60);\n    }\n  },\n  secondValue() {\n    const time = Template.instance().data.filter.search.value;\n    if (time) {\n      return time % 60;\n    }\n  },\n  editing() {\n    return Template.instance().editing.get();\n  },\n  isChanged(field) {\n    const newValue = Template.instance().currentSpec.get(field);\n\n    return newValue !== undefined && newValue !== Template.instance().editableField.get()[field];\n  },\n  editableField() {\n    return Template.instance().editableField.get();\n  },\n  fieldLabel() {\n    return Template.instance().fieldLabel.get();\n  }\n});\n\nfunction doSearch(e, templInstance) {\n  const elem = $(e.currentTarget);\n  const fieldType = templInstance.fieldType.get();\n  if (fieldType === Date) {\n    const date = new Date(elem.val());\n    if (!Number.isNaN(date.getTime())) {\n      templInstance.search.set(date);\n    }\n    else {\n      templInstance.search.set(undefined);\n    }\n  }\n  else if (fieldType === Number) {\n    templInstance.search.set(parseInt(templInstance.$(\".input-dynamic-table-search\").val(), 10));\n  }\n  else if (fieldType === \"time\") {\n    const mins = parseInt($(templInstance.$(\".input-dynamic-table-search\")[0]).val(), 10) || 0;\n    const secs = parseInt($(templInstance.$(\".input-dynamic-table-search\")[1]).val(), 10) || 0;\n    templInstance.search.set((mins * 60) + secs);\n  }\n}\n\n\nTemplate.dynamicTableFilterModal.events({\n  \"change .dynamic-table-filter-edit-type\"(e, templInstance) {\n    templInstance.currentSpec.set(\"type\", $(e.currentTarget).val());\n  },\n  \"click .dynamic-table-filter-edit-isArray\"(e, templInstance) {\n    templInstance.currentSpec.set(\"isArray\", $(e.currentTarget).is(\":checked\"));\n  },\n  \"click .dynamic-table-filter-edit-searchable\"(e, templInstance) {\n    templInstance.currentSpec.set(\"indexedNumber\", $(e.currentTarget).is(\":checked\") ? (this.field.edit.spec.indexedNumber === false ? \"new\" : this.field.edit.spec.indexedNumber) : false);\n  },\n  \"click .btn-dynamic-table-cancel\"(e, templInstance) {\n    templInstance.editing.set(false);\n  },\n  \"click .btn-dynamic-table-save\"(e, templInstance) {\n    templInstance.$(\".btn-dynamic-table-save\").attr(\"disabled\", \"disabled\");\n    templInstance.data.field.edit.callback(e, templInstance)\n    .then((newFieldSpec) => {\n      templInstance.$(\".btn-dynamic-table-save\").removeAttr(\"disabled\");\n      Tracker.nonreactive(() => {\n        templInstance.editableField.set(newFieldSpec);\n      });\n      let fieldType = newFieldSpec.type;\n      if (fieldType === \"string\") {\n        fieldType = String;\n      }\n      else if (fieldType === \"number\") {\n        fieldType = Number;\n      }\n      else if (fieldType === \"date\") {\n        fieldType = Date;\n      }\n      templInstance.isArrayField.set(newFieldSpec.isArray);\n      templInstance.fieldType.set(fieldType);\n      templInstance.fieldLabel.set(newFieldSpec.label);\n      templInstance.editing.set(false);\n      templInstance.data.editFieldCallback(newFieldSpec);\n    })\n    .catch((err) => {\n      console.error(err);\n    });\n  },\n  \"click .dynamic-table-filter-edit-btn\"(e, templInstance) {\n    templInstance.editing.set(true);\n  },\n  \"click .btn-dynamic-table-remove\"(e, templInstance) {\n    templInstance.data.callback([], \"$in\", undefined, false);\n    templInstance.data.removeColumn();\n    closeModal();\n  },\n  \"click .btn-dynamic-table-clear\"(e, templInstance) {\n    templInstance.search.set(undefined);\n    templInstance.selectedOptions.set([]);\n    templInstance.$(\".input-dynamic-table-search\").val(\"\");\n    // templInstance.data.callback([], \"$in\", undefined, false);\n  },\n  \"click .btn-dynamic-table-sort\"(e, templInstance) {\n    templInstance.sortDirection.set($(e.currentTarget).data(\"direction\"));\n  },\n  \"change .input-dynamic-table-operator\"(e, templInstance) {\n    const options = Template.instance().options.get();\n    const hasOptions = options && options.length;\n    let operator = $(e.currentTarget).val();\n    if (operator === \"$in\") {\n      if (!hasOptions) {\n        operator = \"$regex\";\n      }\n      if (templInstance.$(\".btn-dynamic-table-operator.btn-dynamic-table-selected\").data(\"modifier\") === \"$all\") {\n        operator = \"$all\";\n      }\n    }\n    if (operator === \"$nin\") {\n      if (!hasOptions) {\n        operator = \"$not\";\n      }\n    }\n    templInstance.operator.set(operator);\n  },\n  \"click .fa-cog\"(e, templInstance) {\n    templInstance.showOperators.set(!templInstance.showOperators.get());\n  },\n  \"change .select-dynamic-table-operator\"(e, templInstance) {\n    const options = Template.instance().options.get();\n    const hasOptions = options && options.length;\n    let operator = $(e.currentTarget).val();\n    if (operator === \"$in\") {\n      if (!hasOptions) {\n        operator = \"$regex\";\n      }\n    }\n    if (operator === \"$nin\") {\n      if (!hasOptions) {\n        operator = \"$not\";\n      }\n    }\n    templInstance.operator.set(operator);\n  },\n  \"click .label-dynamic-table-selected\"(e, templInstance) {\n    const selectedOptions = templInstance.selectedOptions.get();\n    const newOption = $(e.currentTarget).data(\"value\");\n    templInstance.selectedOptions.set(selectedOptions.filter(f => f instanceof Date ? f.toString() !== newOption : f !== newOption));\n  },\n  \"click .input-dynamic-table-option\"(e, templInstance) {\n    const selectedOptions = templInstance.selectedOptions.get();\n    const newOption = $(e.currentTarget).val();\n    if ($(e.currentTarget).is(\":checked\")) {\n      templInstance.selectedOptions.set(_.union(selectedOptions, [newOption]));\n    }\n    else {\n      templInstance.selectedOptions.set(selectedOptions.filter(f => f instanceof Date ? f.toString() !== newOption : f !== newOption));\n    }\n  },\n  \"keyup .input-dynamic-table-search\"(e, templInstance) {\n    const elem = $(e.currentTarget);\n    const data = Template.instance().data;\n    const fieldType = templInstance.fieldType.get();\n    if (fieldType === Date || fieldType === \"time\" || fieldType === Number) {\n      doSearch(e, templInstance);\n      return;\n    }\n    if (_.isArray(data.filter.options)) {\n      templInstance.search.set(elem.val());\n    }\n    else {\n      templInstance.searching.set(true);\n      templInstance.throttledUpdate(templInstance.search, elem.val());\n    }\n  },\n  \"change .input-dynamic-table-search\"(e, templInstance) {\n    doSearch(e, templInstance);\n  }\n});\nTemplate.dynamicTableFilterModal.onRendered(function onRendered() {\n  Tracker.autorun(() => {\n    if (this.editing.get()) {\n      Tracker.afterFlush(() => {\n        if ($.fn.select2) {\n          this.$(\".dynamic-table-filter-edit-group\").select2({\n            tags: true,\n            placeholder: \"Select a Group\",\n            allowClear: true,\n            data: _.union(\n              [{ id: \"\", value: \"\" }],\n              this.data.groupNames.map(g => ({ id: g, text: g }))\n            )\n          });\n          this.$(\".dynamic-table-filter-edit-group\").val(this.editableField.get().groupName).trigger(\"change\");\n        }\n      });\n    }\n  });\n  /**\n   * When filter modal is open over any existing bootstrap modal,\n   * input element i.e search field of filter modal is not clickable,\n   * To fix it, we get rid of focus on bootstrap modal\n   */\n  $(document).off(\"focusin.modal\");\n});\n\nTemplate.dynamicTableFilterModal.onCreated(function onCreated() {\n  this.editableField = new ReactiveVar(this.data.field && this.data.field.edit && this.data.field.edit.spec);\n  this.isArrayField = new ReactiveVar(false);\n  this.fieldLabel = new ReactiveVar(this.data.field && this.data.field.label);\n  this.fieldType = new ReactiveVar(this.data.field && this.data.field.type);\n  if (this.data.field && this.data.field.type && _.isArray(this.data.field && this.data.field.type)) {\n    this.fieldType.set(this.data.field.type[0]);\n    this.isArrayField.set(true);\n  }\n  this.currentSpec = new ReactiveDict();\n  this.editing = new ReactiveVar(false);\n  this.showOperators = new ReactiveVar(this.data.filter && this.data.filter.operator && this.data.filter.operator.selected && ![\"$in\", \"$regex\", \"$between\"].includes(this.data.filter.operator.selected));\n  this.options = new ReactiveVar();\n  this.allOptions = new ReactiveVar([]);\n  this.search = new ReactiveVar(this.data.filter && this.data.filter.search && this.data.filter.search.value);\n  this.searching = new ReactiveVar(false);\n  this.selectedOptions = new ReactiveVar([]);\n  this.searchChanged = new Tracker.Dependency();\n  this.sortDirection = new ReactiveVar(this.data.sort && this.data.sort.direction);\n  this.asyncOptions = new ReactiveVar(false);\n  this.operator = new ReactiveVar(this.data.filter && this.data.filter && this.data.filter.operator && this.data.filter.operator.selected);\n  this.throttledUpdate = _.throttle(\n    (reactiveVar, val) => {\n      reactiveVar.set(val);\n    },\n    this.data.filter && this.data.filter.throttle ? this.data.filter.throttle.wait : 1000,\n    this.data.filter && this.data.filter.throttle ? this.data.filter.throttle.options : { leading: false }\n  );\n\n  const data = this.data;\n  if (data.filter && _.isFunction(data.filter.options)) {\n    const initSearch = data.filter.selectedOptions && !_.isArray(data.filter.selectedOptions) && data.filter.selectedOptions.length ? data.filter.selectedOptions : undefined;\n    const options = data.filter.options(data, initSearch, (asyncOptions) => {\n      this.asyncOptions.set(true);\n      this.allOptions.set(asyncOptions.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n      this.options.set(asyncOptions.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n      this.searching.set(false);\n    });\n    if (options instanceof Promise) {\n      options.then((asyncOptions) => {\n        this.asyncOptions.set(true);\n        this.allOptions.set(asyncOptions.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n        this.options.set(asyncOptions.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n        this.searching.set(false);\n      });\n    }\n    else if (options) {\n      this.allOptions.set(options.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n      this.options.set(options.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n      this.searching.set(false);\n    }\n  }\n  else if (data.filter && _.isArray(data.filter.options)) {\n    this.allOptions.set(data.filter.options.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n    this.options.set(data.filter.options.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n  }\n  if (data.filter && data.filter.selectedOptions) {\n    if (_.isFunction(data.filter.selectedOptions)) {\n      const selectedOptions = data.filter.selectedOptions(data, (asyncOptions) => {\n        this.selectedOptions.set(asyncOptions);\n      });\n      if (selectedOptions instanceof Promise) {\n        selectedOptions.then((asyncOptions) => {\n          this.selectedOptions.set(asyncOptions);\n        });\n      }\n      else if (selectedOptions) {\n        this.selectedOptions.set(selectedOptions);\n      }\n    }\n    else if (_.isArray(data.filter.selectedOptions)) {\n      this.selectedOptions.set(data.filter.selectedOptions);\n    }\n  }\n  let lastSearch;\n  if (data.filter && data.filter.options) {\n    this.autorun(() => {\n      const search = this.search.get();\n      if (search === lastSearch) {\n        return;\n      }\n      lastSearch = search;\n      if (_.isFunction(data.filter.options)) {\n        const options = data.filter.options(data, search, (asyncOptions) => {\n          this.options.set(asyncOptions.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n          this.searching.set(false);\n        });\n        if (options instanceof Promise) {\n          options.then((asyncOptions) => {\n            this.options.set(asyncOptions.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n            this.searching.set(false);\n          });\n        }\n        else if (options) {\n          this.options.set(options.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n          this.searching.set(false);\n        }\n      }\n      else if (_.isArray(data.filter.options)) {\n        if (search) {\n          this.options.set(data.filter.options.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })).filter(o => o.label.match(new RegExp(search, \"i\"))));\n        }\n        else {\n          this.options.set(data.filter.options.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n        }\n      }\n    });\n  }\n\n  const callback = this.data.callback;\n  if (callback && this.data.filter && this.data.filter.enabled) {\n    this.autorun((comp) => {\n      let selectedOptions = this.selectedOptions.get();\n      let operator = this.operator.get();\n      const options = this.allOptions.get();\n      const fieldType = this.fieldType.get();\n      if (selectedOptions.length === 0 && (fieldType === Date || fieldType === \"time\" || fieldType === Number)) {\n        selectedOptions = this.search.get();\n        const numericSearches = [\n          \"$gt\",\n          \"$lt\",\n          \"$gte\",\n          \"$lte\",\n          \"$between\"\n        ];\n        if (!numericSearches.includes(operator)) {\n          operator = \"$between\";\n        }\n        if (operator === \"$between\" && selectedOptions instanceof Date) {\n          selectedOptions = [\n            selectedOptions,\n            new Date(selectedOptions.getTime() + (24 * 60 * 60 * 1000))\n          ];\n        }\n        else if (operator === \"$between\" && (typeof selectedOptions) === \"number\") {\n          // HACK: to handle equality of numbers\n          selectedOptions = [\n            selectedOptions,\n            selectedOptions\n          ];\n        }\n      }\n      else if (!options || !options.length && !this.asyncOptions.get()) {\n        selectedOptions = this.search.get();\n        if (operator === \"$in\" || operator === \"$all\") {\n          operator = \"$regex\";\n        }\n        else if (operator === \"$nin\" || operator === \"$not$all\") {\n          operator = \"$not\";\n        }\n      }\n      const direction = this.sortDirection.get();\n      if (comp.firstRun) {\n        return;\n      }\n\n      if (fieldType === Number) {\n        if (_.isArray(selectedOptions)) {\n          selectedOptions = selectedOptions.map(v => (typeof v === \"number\" ? v : (v.includes(\".\") ? parseFloat(v) : parseInt(v, 10))));\n        }\n      }\n      if (fieldType === Date) {\n        if (_.isArray(selectedOptions)) {\n          selectedOptions = selectedOptions.map(v => new Date(v));\n        }\n      }\n      Tracker.nonreactive(() => callback(selectedOptions, operator, direction, false));\n    });\n  }\n});\n"]},"sourceType":"script","hash":"0b077d057315a5b70dab388f4ab8d572c679fae1"}
