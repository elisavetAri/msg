{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\GroupedTable.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/znewsham:dynamic-table/client/ui/GroupedTable.js","filename":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\GroupedTable.js","passPerPreset":false,"envName":"development","cwd":"C:\\Sandbox\\test","root":"C:\\Sandbox\\test","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\GroupedTable.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/znewsham:dynamic-table/client/ui/GroupedTable.js"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nmodule.link(\"./components/dynamicTableGroup/dynamicTableGroup.js\");\nmodule.link(\"./GroupedTable.html\");\nmodule.link(\"./components/manageGroupFieldsModal/manageGroupFieldsModal.js\");\nvar getColumns, getPosition, changed, getCustom;\nmodule.link(\"../inlineSave.js\", {\n  getColumns: function (v) {\n    getColumns = v;\n  },\n  getPosition: function (v) {\n    getPosition = v;\n  },\n  changed: function (v) {\n    changed = v;\n  },\n  getCustom: function (v) {\n    getCustom = v;\n  }\n}, 0);\nTemplate.GroupedTable.onRendered(function () {\n  function onRendered() {\n    var _this = this;\n\n    if (this.data.customGroupButtonSelector) {\n      this.autorun(function () {\n        var chain = _this.groupChain.get();\n\n        if (chain.length) {\n          $(_this.data.customGroupButtonSelector).addClass(\"grouped\");\n        } else {\n          $(_this.data.customGroupButtonSelector).removeClass(\"grouped\");\n        }\n      });\n    }\n  }\n\n  return onRendered;\n}());\nTemplate.GroupedTable.onCreated(function () {\n  function onCreated() {\n    var _this2 = this;\n\n    this.customTableSpec = this.data;\n    this.search = new ReactiveVar();\n    this.customColumns = new ReactiveVar([]);\n    this.groupChain = new ReactiveVar(_.compact((this.data.groupChain || []).map(function (gcf) {\n      return _this2.data.groupableFields.find(function (gc) {\n        return gc.field === gcf;\n      });\n    })));\n    this.searchFn = _.debounce(function () {\n      _this2.search.set(_this2.$(\".dynamic-table-global-search\").val());\n    }, 1000);\n    getCustom(this.data.custom, this.data.id, function (custom) {\n      _this2.customColumns.set(_.compact((custom.columns || []).map(function (c) {\n        return _.find(getColumns(_this2.data.columns) || [], function (c1) {\n          return c1.id ? c1.id === c.id : c1.data === c.data;\n        });\n      })));\n\n      if (custom.groupChainFields) {\n        _this2.groupChain.set(_.compact(custom.groupChainFields.map(function (gcf) {\n          return _this2.data.groupableFields.find(function (gc) {\n            return gc.field === gcf;\n          });\n        })));\n      }\n    });\n\n    this.documentMouseDown = function (e) {\n      var manageGroupFieldsWrapper = $(\"#dynamic-table-manage-group-fields-modal\")[0];\n\n      if (manageGroupFieldsWrapper) {\n        if ($(manageGroupFieldsWrapper).has(e.target).length) {\n          return;\n        }\n\n        Blaze.remove(manageGroupFieldsWrapper.__blazeTemplate);\n        manageGroupFieldsWrapper.innerHTML = \"\";\n      }\n    };\n\n    document.addEventListener(\"mousedown\", this.documentMouseDown);\n  }\n\n  return onCreated;\n}());\nTemplate.GroupedTable.onDestroyed(function () {\n  function onDestroyed() {\n    document.removeEventListener(\"mousedown\", this.documentMouseDown);\n  }\n\n  return onDestroyed;\n}());\nTemplate.GroupedTable.helpers({\n  selector: function () {\n    var data = Template.instance().data;\n\n    var selector = _.extend({}, data.selector);\n\n    var search = Template.instance().search.get();\n    var searchSelector;\n\n    if (search) {\n      var searchVal = {\n        $regex: search,\n        $options: \"i\"\n      };\n      searchSelector = {\n        $or: []\n      };\n\n      var columns = _.unique(Template.instance().customColumns.get().length ? Template.instance().customColumns.get() : data.columns, function (c) {\n        return c.data + c.id + c.search;\n      });\n\n      columns.filter(function (c) {\n        return c.searchable !== false;\n      }).forEach(function (column) {\n        if (column.search) {\n          var _searchSelector$$or;\n\n          (_searchSelector$$or = searchSelector.$or).push.apply(_searchSelector$$or, (0, _toConsumableArray2.default)(column.search(_.extend({}, searchVal, {\n            $options: column.searchOptions\n          }))));\n        } else if (column.data) {\n          var _searchSelector$$or$p;\n\n          searchSelector.$or.push((_searchSelector$$or$p = {}, _searchSelector$$or$p[column.data] = _.extend({}, searchVal, {\n            $options: column.searchOptions\n          }), _searchSelector$$or$p));\n        }\n      });\n    }\n\n    if (selector && Object.keys(selector).length && searchSelector) {\n      return {\n        $and: [selector, searchSelector]\n      };\n    }\n\n    return searchSelector || selector;\n  },\n  expandAll: function () {\n    if (this.expandAll !== undefined) {\n      return this.expanAll;\n    }\n\n    return false;\n  },\n  lazy: function () {\n    if (this.lazy !== undefined) {\n      return this.lazy;\n    }\n\n    return true;\n  },\n  customTableSpec: function () {\n    return Template.instance().customTableSpec;\n  },\n  aGroupChain: function () {\n    var groupChain = Template.instance().groupChain.get();\n    return groupChain;\n  }\n});\nTemplate.GroupedTable.events({\n  \"change .dynamic-table-global-search\": function (e, templInstance) {\n    templInstance.searchFn();\n  },\n  \"keydown .dynamic-table-global-search\": function (e, templInstance) {\n    templInstance.searchFn();\n  },\n  \"keyup .dynamic-table-global-search\": function (e, templInstance) {\n    templInstance.searchFn();\n  },\n  \"click a.manage-group-fields\": function (e, templInstance, extra) {\n    e.preventDefault();\n    var manageGroupFieldsOptions = {\n      availableColumns: templInstance.data.groupableFields,\n      selectedColumns: templInstance.groupChain.get(),\n      changeCallback: function (columns) {\n        templInstance.groupChain.set(columns);\n        changed(templInstance.data.custom, templInstance.data.id, {\n          newGroupChainFields: columns.map(function (c) {\n            return c.field;\n          })\n        });\n      }\n    };\n    var target = extra ? extra.target : e.currentTarget;\n    var bounds = getPosition(target);\n    var left = Math.max(bounds.left + $(target).outerWidth() - 350, 0);\n    var div = $(\"#dynamic-table-manage-group-fields-modal\").length ? $(\"#dynamic-table-manage-group-fields-modal\") : $(\"<div>\");\n    div.attr(\"id\", \"dynamic-table-manage-group-fields-modal\").html(\"\").css(\"position\", \"absolute\").css(\"top\", bounds.top + $(target).outerHeight()).css(\"left\", left);\n\n    if (div[0].__blazeTemplate) {\n      Blaze.remove(div[0].__blazeTemplate);\n    }\n\n    div[0].__blazeTemplate = Blaze.renderWithData(Template.dynamicTableManageGroupFieldsModal, manageGroupFieldsOptions, div[0]);\n    document.body.appendChild(div[0]);\n    var tooFar = left + 350 - $(window).width();\n\n    if (tooFar > 0) {\n      div.css(\"left\", left - (tooFar + 5) + \"px\");\n    }\n  }\n});","map":{"version":3,"sources":["packages/znewsham:dynamic-table/client/ui/GroupedTable.js"],"names":["module","link","getColumns","getPosition","changed","getCustom","v","Template","GroupedTable","onRendered","data","customGroupButtonSelector","autorun","chain","groupChain","get","length","$","addClass","removeClass","onCreated","customTableSpec","search","ReactiveVar","customColumns","_","compact","map","gcf","groupableFields","find","gc","field","searchFn","debounce","set","val","custom","id","columns","c","c1","groupChainFields","documentMouseDown","e","manageGroupFieldsWrapper","has","target","Blaze","remove","__blazeTemplate","innerHTML","document","addEventListener","onDestroyed","removeEventListener","helpers","selector","instance","extend","searchSelector","searchVal","$regex","$options","$or","unique","filter","searchable","forEach","column","push","searchOptions","Object","keys","$and","expandAll","undefined","expanAll","lazy","aGroupChain","events","templInstance","extra","preventDefault","manageGroupFieldsOptions","availableColumns","selectedColumns","changeCallback","newGroupChainFields","currentTarget","bounds","left","Math","max","outerWidth","div","attr","html","css","top","outerHeight","renderWithData","dynamicTableManageGroupFieldsModal","body","appendChild","tooFar","window","width"],"mappings":"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","sourcesContent":["import \"./components/dynamicTableGroup/dynamicTableGroup.js\";\nimport \"./GroupedTable.html\";\nimport \"./components/manageGroupFieldsModal/manageGroupFieldsModal.js\";\nimport { getColumns, getPosition, changed, getCustom } from \"../inlineSave.js\";\n\nTemplate.GroupedTable.onRendered(function onRendered() {\n  if (this.data.customGroupButtonSelector) {\n    this.autorun(() => {\n      const chain = this.groupChain.get();\n      if (chain.length) {\n        $(this.data.customGroupButtonSelector).addClass(\"grouped\");\n      }\n      else {\n        $(this.data.customGroupButtonSelector).removeClass(\"grouped\");\n      }\n    });\n  }\n});\n\nTemplate.GroupedTable.onCreated(function onCreated() {\n  this.customTableSpec = this.data;\n  this.search = new ReactiveVar();\n  this.customColumns = new ReactiveVar([]);\n  this.groupChain = new ReactiveVar(_.compact((this.data.groupChain || []).map(gcf => this.data.groupableFields.find(gc => gc.field === gcf))));\n\n  this.searchFn = _.debounce(() => {\n    this.search.set(this.$(\".dynamic-table-global-search\").val());\n  }, 1000);\n\n  getCustom(this.data.custom, this.data.id, (custom) => {\n    this.customColumns.set(_.compact((custom.columns || []).map(c => _.find(getColumns(this.data.columns) || [], c1 => c1.id ? c1.id === c.id : c1.data === c.data))));\n    if (custom.groupChainFields) {\n      this.groupChain.set(_.compact(custom.groupChainFields.map(gcf => this.data.groupableFields.find(gc => gc.field === gcf))));\n    }\n  });\n  this.documentMouseDown = (e) => {\n    const manageGroupFieldsWrapper = $(\"#dynamic-table-manage-group-fields-modal\")[0];\n    if (manageGroupFieldsWrapper) {\n      if ($(manageGroupFieldsWrapper).has(e.target).length) {\n        return;\n      }\n      Blaze.remove(manageGroupFieldsWrapper.__blazeTemplate);\n      manageGroupFieldsWrapper.innerHTML = \"\";\n    }\n  };\n\n  document.addEventListener(\"mousedown\", this.documentMouseDown);\n});\n\nTemplate.GroupedTable.onDestroyed(function onDestroyed() {\n  document.removeEventListener(\"mousedown\", this.documentMouseDown);\n});\nTemplate.GroupedTable.helpers({\n  selector() {\n    const data = Template.instance().data;\n    const selector = _.extend({}, data.selector);\n    const search = Template.instance().search.get();\n    let searchSelector;\n    if (search) {\n      const searchVal = { $regex: search, $options: \"i\" };\n      searchSelector = { $or: [] };\n      const columns = _.unique(Template.instance().customColumns.get().length ? Template.instance().customColumns.get() : data.columns, c => c.data + c.id + c.search);\n      columns.filter(c => c.searchable !== false).forEach((column) => {\n        if (column.search) {\n          searchSelector.$or.push(...column.search(_.extend({}, searchVal, { $options: column.searchOptions })));\n        }\n        else if (column.data) {\n          searchSelector.$or.push({ [column.data]: _.extend({}, searchVal, { $options: column.searchOptions }) });\n        }\n      });\n    }\n    if (selector && Object.keys(selector).length && searchSelector) {\n      return { $and: [selector, searchSelector] };\n    }\n    return searchSelector || selector;\n  },\n  expandAll() {\n    if (this.expandAll !== undefined) {\n      return this.expanAll;\n    }\n    return false;\n  },\n  lazy() {\n    if (this.lazy !== undefined) {\n      return this.lazy;\n    }\n    return true;\n  },\n  customTableSpec() {\n    return Template.instance().customTableSpec;\n  },\n  aGroupChain() {\n    const groupChain = Template.instance().groupChain.get();\n    return groupChain;\n  }\n});\n\nTemplate.GroupedTable.events({\n  \"change .dynamic-table-global-search\"(e, templInstance) {\n    templInstance.searchFn();\n  },\n  \"keydown .dynamic-table-global-search\"(e, templInstance) {\n    templInstance.searchFn();\n  },\n  \"keyup .dynamic-table-global-search\"(e, templInstance) {\n    templInstance.searchFn();\n  },\n  \"click a.manage-group-fields\"(e, templInstance, extra) {\n    e.preventDefault();\n    const manageGroupFieldsOptions = {\n      availableColumns: templInstance.data.groupableFields,\n      selectedColumns: templInstance.groupChain.get(),\n      changeCallback(columns) {\n        templInstance.groupChain.set(columns);\n        changed(templInstance.data.custom, templInstance.data.id, { newGroupChainFields: columns.map(c => c.field) });\n      }\n    };\n    const target = extra ? extra.target : e.currentTarget;\n    const bounds = getPosition(target);\n    const left = Math.max((bounds.left + $(target).outerWidth()) - 350, 0);\n    const div = $(\"#dynamic-table-manage-group-fields-modal\").length ? $(\"#dynamic-table-manage-group-fields-modal\") : $(\"<div>\");\n    div.attr(\"id\", \"dynamic-table-manage-group-fields-modal\")\n    .html(\"\")\n    .css(\"position\", \"absolute\")\n    .css(\"top\", bounds.top + $(target).outerHeight())\n    .css(\"left\", left);\n\n    if (div[0].__blazeTemplate) {\n      Blaze.remove(div[0].__blazeTemplate);\n    }\n    div[0].__blazeTemplate = Blaze.renderWithData(\n      Template.dynamicTableManageGroupFieldsModal,\n      manageGroupFieldsOptions,\n      div[0]\n    );\n    document.body.appendChild(div[0]);\n    const tooFar = (left + 350) - $(window).width();\n    if (tooFar > 0) {\n      div.css(\"left\", (left - (tooFar + 5)) + \"px\");\n    }\n  }\n});\n"]},"sourceType":"script","hash":"cdeb7621bbf5a45669261df94593fe9b67563d8d"}
