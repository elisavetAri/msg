{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\components\\filterModal\\filterModal.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser.legacy"},"sourceFileName":"packages/znewsham:dynamic-table/client/ui/components/filterModal/filterModal.js","filename":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\components\\filterModal\\filterModal.js","passPerPreset":false,"envName":"development","cwd":"C:\\Sandbox\\test","root":"C:\\Sandbox\\test","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-arrow-functions","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoped-functions","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-block-scoping","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-classes","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-computed-properties","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-destructuring","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-object-super","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"transform-shorthand-properties","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-spread","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-sticky-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-typeof-symbol","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"transform-unicode-regex","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-property-literals","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]},"ClassPrivateMethod":{"exit":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\components\\filterModal\\filterModal.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/znewsham:dynamic-table/client/ui/components/filterModal/filterModal.js"}},"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar ReactiveDict;\nmodule.link(\"meteor/reactive-dict\", {\n  ReactiveDict: function (v) {\n    ReactiveDict = v;\n  }\n}, 0);\n\nvar _;\n\nmodule.link(\"underscore\", {\n  \"default\": function (v) {\n    _ = v;\n  }\n}, 1);\nmodule.link(\"../manageColumnsForm/manageColumnsForm.js\");\nmodule.link(\"./filterModal.html\");\nmodule.link(\"./filterModal.css\");\n\nfunction closeModal() {\n  var filterModalWrapper = $(\"#dynamic-table-filter-modal\")[0];\n\n  if (filterModalWrapper) {\n    Blaze.remove(filterModalWrapper.__blazeTemplate);\n    filterModalWrapper.innerHTML = \"\";\n  }\n}\n\nTemplate.dynamicTableFilterModal.helpers({\n  manageFieldsEditContext: function () {\n    return Template.instance().data.field.edit;\n  },\n  showOperators: function () {\n    return Template.instance().showOperators.get();\n  },\n  hasFooter: function () {\n    return this.filter && (this.filter.enabled || !this.filter.required);\n  },\n  checkedIfWithValue: function () {\n    return [\"$between\", \"$in\", \"$regex\"].includes(this.filter.operator.selected) ? {\n      selected: \"selected\"\n    } : {};\n  },\n  checkedIfWithAllValue: function () {\n    return [\"$all\"].includes(this.filter.operator.selected) ? {\n      selected: \"selected\"\n    } : {};\n  },\n  checkedIfGteValue: function () {\n    return this.filter.operator.selected === \"$gte\" ? {\n      selected: \"selected\"\n    } : {};\n  },\n  checkedIfLteValue: function () {\n    return this.filter.operator.selected === \"$lte\" ? {\n      selected: \"selected\"\n    } : {};\n  },\n  checkedIfWithoutValue: function () {\n    return [\"$nin\"].includes(this.filter.operator.selected) ? {\n      selected: \"selected\"\n    } : {};\n  },\n  checkedIfWithoutAllValue: function () {\n    return [\"$not$all\"].includes(this.filter.operator.selected) ? {\n      selected: \"selected\"\n    } : {};\n  },\n  searchEnabled: function () {\n    if (this.filter.options) {\n      return this.filter.search && this.filter.search.enabled;\n    }\n\n    return this.filter.search === undefined || this.filter.search.enabled !== false;\n  },\n  isAny: function () {\n    return [\"$in\", \"$nin\"].includes(Template.instance().operator.get());\n  },\n  isAll: function () {\n    return [\"$all\", \"$not$all\"].includes(Template.instance().operator.get());\n  },\n  isNumericOrDateAndNoOptions: function () {\n    var fieldType = Template.instance().fieldType.get();\n    var isNumericOrDate = fieldType && (fieldType === \"time\" || fieldType === Number || fieldType === Date);\n    return isNumericOrDate && Template.instance().allOptions.get().length === 0;\n  },\n  isNumericOrDate: function () {\n    var fieldType = Template.instance().fieldType.get();\n    return fieldType && (fieldType === \"time\" || fieldType === Number || fieldType === Date);\n  },\n  isTime: function () {\n    var fieldType = Template.instance().fieldType.get();\n    return fieldType && fieldType === \"time\";\n  },\n  isNumber: function () {\n    var fieldType = Template.instance().fieldType.get();\n    return fieldType && fieldType === Number;\n  },\n  isDate: function () {\n    var fieldType = Template.instance().fieldType.get();\n    return fieldType && fieldType === Date;\n  },\n  isStringOrCustom: function () {\n    var fieldType = Template.instance().fieldType.get();\n    return fieldType === String || fieldType !== Number && fieldType !== Date && fieldType !== \"time\";\n  },\n  isString: function () {\n    var fieldType = Template.instance().fieldType.get();\n    return fieldType === String;\n  },\n  sortDirection: function (direction) {\n    return Template.instance().sortDirection.get() === direction;\n  },\n  checkedIf: function (opA, opB) {\n    if (_.isArray(opA)) {\n      return opA.includes(opB) ? {\n        checked: \"checked\"\n      } : {};\n    }\n\n    return opA === opB ? {\n      checked: \"checked\"\n    } : {};\n  },\n  checkedIfSelected: function (o) {\n    var found = _.find(Template.instance().selectedOptions.get(), function (value) {\n      return value instanceof Date ? value.toString() === o.toString() : value === o;\n    });\n\n    return found ? {\n      checked: \"checked\"\n    } : {};\n  },\n  hasOptions: function () {\n    if (Template.instance().asyncOptions.get()) {\n      return true;\n    }\n\n    var options = Template.instance().allOptions.get();\n    return options && options.length;\n  },\n  options: function () {\n    return Template.instance().options.get().map(function (o) {\n      return _.extend({\n        _id: o.value instanceof Date ? o.value.toString() : o.value\n      }, o);\n    });\n  },\n  hasSelectedOptions: function () {\n    var options = Template.instance().selectedOptions.get();\n    return options && options.length;\n  },\n  selectedOptions: function () {\n    var options = Template.instance().allOptions.get();\n\n    if (!options) {\n      return [];\n    }\n\n    var selectedOptions = _.compact(Template.instance().selectedOptions.get().map(function (o) {\n      var match = _.find(options, function (_ref) {\n        var value = _ref.value;\n        return value instanceof Date ? value.toString() === o.toString() : value === o;\n      });\n\n      return match;\n    }));\n\n    return selectedOptions.map(function (o) {\n      return _.extend({\n        _id: o.value instanceof Date ? o.value.toString() : o.value\n      }, o);\n    });\n  },\n  searching: function () {\n    return Template.instance().searching.get();\n  },\n  loading: function () {\n    return Template.instance().data.dataTable && Template.instance().data.dataTable.loading.get();\n  },\n  isArrayField: function () {\n    return Template.instance().isArrayField.get();\n  },\n  dateValue: function () {\n    var date = Template.instance().data.filter.search.value;\n\n    if (date) {\n      return date.getFullYear() + \"-\" + (date.getMonth() + 1) + \"-\" + date.getDate();\n    }\n  },\n  numberValue: function () {\n    return Template.instance().data.filter.search.value;\n  },\n  minuteValue: function () {\n    var time = Template.instance().data.filter.search.value;\n\n    if (time) {\n      return Math.floor(time / 60);\n    }\n  },\n  secondValue: function () {\n    var time = Template.instance().data.filter.search.value;\n\n    if (time) {\n      return time % 60;\n    }\n  },\n  editing: function () {\n    return Template.instance().editing.get();\n  },\n  isChanged: function (field) {\n    var newValue = Template.instance().currentSpec.get(field);\n    return newValue !== undefined && newValue !== Template.instance().editableField.get()[field];\n  },\n  editableField: function () {\n    return Template.instance().editableField.get();\n  },\n  fieldLabel: function () {\n    return Template.instance().fieldLabel.get();\n  }\n});\n\nfunction doSearch(e, templInstance) {\n  var elem = $(e.currentTarget);\n  var fieldType = templInstance.fieldType.get();\n\n  if (fieldType === Date) {\n    var date = new Date(elem.val());\n\n    if (!Number.isNaN(date.getTime())) {\n      templInstance.search.set(date);\n    } else {\n      templInstance.search.set(undefined);\n    }\n  } else if (fieldType === Number) {\n    templInstance.search.set(parseInt(templInstance.$(\".input-dynamic-table-search\").val(), 10));\n  } else if (fieldType === \"time\") {\n    var mins = parseInt($(templInstance.$(\".input-dynamic-table-search\")[0]).val(), 10) || 0;\n    var secs = parseInt($(templInstance.$(\".input-dynamic-table-search\")[1]).val(), 10) || 0;\n    templInstance.search.set(mins * 60 + secs);\n  }\n}\n\nTemplate.dynamicTableFilterModal.events({\n  \"change .dynamic-table-filter-edit-type\": function (e, templInstance) {\n    templInstance.currentSpec.set(\"type\", $(e.currentTarget).val());\n  },\n  \"click .dynamic-table-filter-edit-isArray\": function (e, templInstance) {\n    templInstance.currentSpec.set(\"isArray\", $(e.currentTarget).is(\":checked\"));\n  },\n  \"click .dynamic-table-filter-edit-searchable\": function (e, templInstance) {\n    templInstance.currentSpec.set(\"indexedNumber\", $(e.currentTarget).is(\":checked\") ? this.field.edit.spec.indexedNumber === false ? \"new\" : this.field.edit.spec.indexedNumber : false);\n  },\n  \"click .btn-dynamic-table-cancel\": function (e, templInstance) {\n    templInstance.editing.set(false);\n  },\n  \"click .btn-dynamic-table-save\": function (e, templInstance) {\n    templInstance.$(\".btn-dynamic-table-save\").attr(\"disabled\", \"disabled\");\n    templInstance.data.field.edit.callback(e, templInstance).then(function (newFieldSpec) {\n      templInstance.$(\".btn-dynamic-table-save\").removeAttr(\"disabled\");\n      Tracker.nonreactive(function () {\n        templInstance.editableField.set(newFieldSpec);\n      });\n      var fieldType = newFieldSpec.type;\n\n      if (fieldType === \"string\") {\n        fieldType = String;\n      } else if (fieldType === \"number\") {\n        fieldType = Number;\n      } else if (fieldType === \"date\") {\n        fieldType = Date;\n      }\n\n      templInstance.isArrayField.set(newFieldSpec.isArray);\n      templInstance.fieldType.set(fieldType);\n      templInstance.fieldLabel.set(newFieldSpec.label);\n      templInstance.editing.set(false);\n      templInstance.data.editFieldCallback(newFieldSpec);\n    }).catch(function (err) {\n      console.error(err);\n    });\n  },\n  \"click .dynamic-table-filter-edit-btn\": function (e, templInstance) {\n    templInstance.editing.set(true);\n  },\n  \"click .btn-dynamic-table-remove\": function (e, templInstance) {\n    templInstance.data.callback([], \"$in\", undefined, false);\n    templInstance.data.removeColumn();\n    closeModal();\n  },\n  \"click .btn-dynamic-table-clear\": function (e, templInstance) {\n    templInstance.search.set(undefined);\n    templInstance.selectedOptions.set([]);\n    templInstance.$(\".input-dynamic-table-search\").val(\"\"); // templInstance.data.callback([], \"$in\", undefined, false);\n  },\n  \"click .btn-dynamic-table-sort\": function (e, templInstance) {\n    templInstance.sortDirection.set($(e.currentTarget).data(\"direction\"));\n  },\n  \"change .input-dynamic-table-operator\": function (e, templInstance) {\n    var options = Template.instance().options.get();\n    var hasOptions = options && options.length;\n    var operator = $(e.currentTarget).val();\n\n    if (operator === \"$in\") {\n      if (!hasOptions) {\n        operator = \"$regex\";\n      }\n\n      if (templInstance.$(\".btn-dynamic-table-operator.btn-dynamic-table-selected\").data(\"modifier\") === \"$all\") {\n        operator = \"$all\";\n      }\n    }\n\n    if (operator === \"$nin\") {\n      if (!hasOptions) {\n        operator = \"$not\";\n      }\n    }\n\n    templInstance.operator.set(operator);\n  },\n  \"click .fa-cog\": function (e, templInstance) {\n    templInstance.showOperators.set(!templInstance.showOperators.get());\n  },\n  \"change .select-dynamic-table-operator\": function (e, templInstance) {\n    var options = Template.instance().options.get();\n    var hasOptions = options && options.length;\n    var operator = $(e.currentTarget).val();\n\n    if (operator === \"$in\") {\n      if (!hasOptions) {\n        operator = \"$regex\";\n      }\n    }\n\n    if (operator === \"$nin\") {\n      if (!hasOptions) {\n        operator = \"$not\";\n      }\n    }\n\n    templInstance.operator.set(operator);\n  },\n  \"click .label-dynamic-table-selected\": function (e, templInstance) {\n    var selectedOptions = templInstance.selectedOptions.get();\n    var newOption = $(e.currentTarget).data(\"value\");\n    templInstance.selectedOptions.set(selectedOptions.filter(function (f) {\n      return f instanceof Date ? f.toString() !== newOption : f !== newOption;\n    }));\n  },\n  \"click .input-dynamic-table-option\": function (e, templInstance) {\n    var selectedOptions = templInstance.selectedOptions.get();\n    var newOption = $(e.currentTarget).val();\n\n    if ($(e.currentTarget).is(\":checked\")) {\n      templInstance.selectedOptions.set(_.union(selectedOptions, [newOption]));\n    } else {\n      templInstance.selectedOptions.set(selectedOptions.filter(function (f) {\n        return f instanceof Date ? f.toString() !== newOption : f !== newOption;\n      }));\n    }\n  },\n  \"keyup .input-dynamic-table-search\": function (e, templInstance) {\n    var elem = $(e.currentTarget);\n    var data = Template.instance().data;\n    var fieldType = templInstance.fieldType.get();\n\n    if (fieldType === Date || fieldType === \"time\" || fieldType === Number) {\n      doSearch(e, templInstance);\n      return;\n    }\n\n    if (_.isArray(data.filter.options)) {\n      templInstance.search.set(elem.val());\n    } else {\n      templInstance.searching.set(true);\n      templInstance.throttledUpdate(templInstance.search, elem.val());\n    }\n  },\n  \"change .input-dynamic-table-search\": function (e, templInstance) {\n    doSearch(e, templInstance);\n  }\n});\nTemplate.dynamicTableFilterModal.onRendered(function () {\n  function onRendered() {\n    var _this = this;\n\n    Tracker.autorun(function () {\n      if (_this.editing.get()) {\n        Tracker.afterFlush(function () {\n          if ($.fn.select2) {\n            _this.$(\".dynamic-table-filter-edit-group\").select2({\n              tags: true,\n              placeholder: \"Select a Group\",\n              allowClear: true,\n              data: _.union([{\n                id: \"\",\n                value: \"\"\n              }], _this.data.groupNames.map(function (g) {\n                return {\n                  id: g,\n                  text: g\n                };\n              }))\n            });\n\n            _this.$(\".dynamic-table-filter-edit-group\").val(_this.editableField.get().groupName).trigger(\"change\");\n          }\n        });\n      }\n    });\n    /**\n     * When filter modal is open over any existing bootstrap modal,\n     * input element i.e search field of filter modal is not clickable,\n     * To fix it, we get rid of focus on bootstrap modal\n     */\n\n    $(document).off(\"focusin.modal\");\n  }\n\n  return onRendered;\n}());\nTemplate.dynamicTableFilterModal.onCreated(function () {\n  function onCreated() {\n    var _this2 = this;\n\n    this.editableField = new ReactiveVar(this.data.field && this.data.field.edit && this.data.field.edit.spec);\n    this.isArrayField = new ReactiveVar(false);\n    this.fieldLabel = new ReactiveVar(this.data.field && this.data.field.label);\n    this.fieldType = new ReactiveVar(this.data.field && this.data.field.type);\n\n    if (this.data.field && this.data.field.type && _.isArray(this.data.field && this.data.field.type)) {\n      this.fieldType.set(this.data.field.type[0]);\n      this.isArrayField.set(true);\n    }\n\n    this.currentSpec = new ReactiveDict();\n    this.editing = new ReactiveVar(false);\n    this.showOperators = new ReactiveVar(this.data.filter && this.data.filter.operator && this.data.filter.operator.selected && ![\"$in\", \"$regex\", \"$between\"].includes(this.data.filter.operator.selected));\n    this.options = new ReactiveVar();\n    this.allOptions = new ReactiveVar([]);\n    this.search = new ReactiveVar(this.data.filter && this.data.filter.search && this.data.filter.search.value);\n    this.searching = new ReactiveVar(false);\n    this.selectedOptions = new ReactiveVar([]);\n    this.searchChanged = new Tracker.Dependency();\n    this.sortDirection = new ReactiveVar(this.data.sort && this.data.sort.direction);\n    this.asyncOptions = new ReactiveVar(false);\n    this.operator = new ReactiveVar(this.data.filter && this.data.filter && this.data.filter.operator && this.data.filter.operator.selected);\n    this.throttledUpdate = _.throttle(function (reactiveVar, val) {\n      reactiveVar.set(val);\n    }, this.data.filter && this.data.filter.throttle ? this.data.filter.throttle.wait : 1000, this.data.filter && this.data.filter.throttle ? this.data.filter.throttle.options : {\n      leading: false\n    });\n    var data = this.data;\n\n    if (data.filter && _.isFunction(data.filter.options)) {\n      var initSearch = data.filter.selectedOptions && !_.isArray(data.filter.selectedOptions) && data.filter.selectedOptions.length ? data.filter.selectedOptions : undefined;\n      var options = data.filter.options(data, initSearch, function (asyncOptions) {\n        _this2.asyncOptions.set(true);\n\n        _this2.allOptions.set(asyncOptions.map(function (o) {\n          return (0, _typeof2.default)(o) === \"object\" ? o : {\n            label: o,\n            value: o\n          };\n        }));\n\n        _this2.options.set(asyncOptions.map(function (o) {\n          return (0, _typeof2.default)(o) === \"object\" ? o : {\n            label: o,\n            value: o\n          };\n        }));\n\n        _this2.searching.set(false);\n      });\n\n      if (options instanceof Promise) {\n        options.then(function (asyncOptions) {\n          _this2.asyncOptions.set(true);\n\n          _this2.allOptions.set(asyncOptions.map(function (o) {\n            return (0, _typeof2.default)(o) === \"object\" ? o : {\n              label: o,\n              value: o\n            };\n          }));\n\n          _this2.options.set(asyncOptions.map(function (o) {\n            return (0, _typeof2.default)(o) === \"object\" ? o : {\n              label: o,\n              value: o\n            };\n          }));\n\n          _this2.searching.set(false);\n        });\n      } else if (options) {\n        this.allOptions.set(options.map(function (o) {\n          return (0, _typeof2.default)(o) === \"object\" ? o : {\n            label: o,\n            value: o\n          };\n        }));\n        this.options.set(options.map(function (o) {\n          return (0, _typeof2.default)(o) === \"object\" ? o : {\n            label: o,\n            value: o\n          };\n        }));\n        this.searching.set(false);\n      }\n    } else if (data.filter && _.isArray(data.filter.options)) {\n      this.allOptions.set(data.filter.options.map(function (o) {\n        return (0, _typeof2.default)(o) === \"object\" ? o : {\n          label: o,\n          value: o\n        };\n      }));\n      this.options.set(data.filter.options.map(function (o) {\n        return (0, _typeof2.default)(o) === \"object\" ? o : {\n          label: o,\n          value: o\n        };\n      }));\n    }\n\n    if (data.filter && data.filter.selectedOptions) {\n      if (_.isFunction(data.filter.selectedOptions)) {\n        var selectedOptions = data.filter.selectedOptions(data, function (asyncOptions) {\n          _this2.selectedOptions.set(asyncOptions);\n        });\n\n        if (selectedOptions instanceof Promise) {\n          selectedOptions.then(function (asyncOptions) {\n            _this2.selectedOptions.set(asyncOptions);\n          });\n        } else if (selectedOptions) {\n          this.selectedOptions.set(selectedOptions);\n        }\n      } else if (_.isArray(data.filter.selectedOptions)) {\n        this.selectedOptions.set(data.filter.selectedOptions);\n      }\n    }\n\n    var lastSearch;\n\n    if (data.filter && data.filter.options) {\n      this.autorun(function () {\n        var search = _this2.search.get();\n\n        if (search === lastSearch) {\n          return;\n        }\n\n        lastSearch = search;\n\n        if (_.isFunction(data.filter.options)) {\n          var _options = data.filter.options(data, search, function (asyncOptions) {\n            _this2.options.set(asyncOptions.map(function (o) {\n              return (0, _typeof2.default)(o) === \"object\" ? o : {\n                label: o,\n                value: o\n              };\n            }));\n\n            _this2.searching.set(false);\n          });\n\n          if (_options instanceof Promise) {\n            _options.then(function (asyncOptions) {\n              _this2.options.set(asyncOptions.map(function (o) {\n                return (0, _typeof2.default)(o) === \"object\" ? o : {\n                  label: o,\n                  value: o\n                };\n              }));\n\n              _this2.searching.set(false);\n            });\n          } else if (_options) {\n            _this2.options.set(_options.map(function (o) {\n              return (0, _typeof2.default)(o) === \"object\" ? o : {\n                label: o,\n                value: o\n              };\n            }));\n\n            _this2.searching.set(false);\n          }\n        } else if (_.isArray(data.filter.options)) {\n          if (search) {\n            _this2.options.set(data.filter.options.map(function (o) {\n              return (0, _typeof2.default)(o) === \"object\" ? o : {\n                label: o,\n                value: o\n              };\n            }).filter(function (o) {\n              return o.label.match(new RegExp(search, \"i\"));\n            }));\n          } else {\n            _this2.options.set(data.filter.options.map(function (o) {\n              return (0, _typeof2.default)(o) === \"object\" ? o : {\n                label: o,\n                value: o\n              };\n            }));\n          }\n        }\n      });\n    }\n\n    var callback = this.data.callback;\n\n    if (callback && this.data.filter && this.data.filter.enabled) {\n      this.autorun(function (comp) {\n        var selectedOptions = _this2.selectedOptions.get();\n\n        var operator = _this2.operator.get();\n\n        var options = _this2.allOptions.get();\n\n        var fieldType = _this2.fieldType.get();\n\n        if (selectedOptions.length === 0 && (fieldType === Date || fieldType === \"time\" || fieldType === Number)) {\n          selectedOptions = _this2.search.get();\n          var numericSearches = [\"$gt\", \"$lt\", \"$gte\", \"$lte\", \"$between\"];\n\n          if (!numericSearches.includes(operator)) {\n            operator = \"$between\";\n          }\n\n          if (operator === \"$between\" && selectedOptions instanceof Date) {\n            selectedOptions = [selectedOptions, new Date(selectedOptions.getTime() + 24 * 60 * 60 * 1000)];\n          } else if (operator === \"$between\" && typeof selectedOptions === \"number\") {\n            // HACK: to handle equality of numbers\n            selectedOptions = [selectedOptions, selectedOptions];\n          }\n        } else if (!options || !options.length && !_this2.asyncOptions.get()) {\n          selectedOptions = _this2.search.get();\n\n          if (operator === \"$in\" || operator === \"$all\") {\n            operator = \"$regex\";\n          } else if (operator === \"$nin\" || operator === \"$not$all\") {\n            operator = \"$not\";\n          }\n        }\n\n        var direction = _this2.sortDirection.get();\n\n        if (comp.firstRun) {\n          return;\n        }\n\n        if (fieldType === Number) {\n          if (_.isArray(selectedOptions)) {\n            selectedOptions = selectedOptions.map(function (v) {\n              return typeof v === \"number\" ? v : v.includes(\".\") ? parseFloat(v) : parseInt(v, 10);\n            });\n          }\n        }\n\n        if (fieldType === Date) {\n          if (_.isArray(selectedOptions)) {\n            selectedOptions = selectedOptions.map(function (v) {\n              return new Date(v);\n            });\n          }\n        }\n\n        Tracker.nonreactive(function () {\n          return callback(selectedOptions, operator, direction, false);\n        });\n      });\n    }\n  }\n\n  return onCreated;\n}());","map":{"version":3,"sources":["packages/znewsham:dynamic-table/client/ui/components/filterModal/filterModal.js"],"names":["ReactiveDict","module","link","v","_","closeModal","filterModalWrapper","$","Blaze","remove","__blazeTemplate","innerHTML","Template","dynamicTableFilterModal","helpers","manageFieldsEditContext","instance","data","field","edit","showOperators","get","hasFooter","filter","enabled","required","checkedIfWithValue","includes","operator","selected","checkedIfWithAllValue","checkedIfGteValue","checkedIfLteValue","checkedIfWithoutValue","checkedIfWithoutAllValue","searchEnabled","options","search","undefined","isAny","isAll","isNumericOrDateAndNoOptions","fieldType","isNumericOrDate","Number","Date","allOptions","length","isTime","isNumber","isDate","isStringOrCustom","String","isString","sortDirection","direction","checkedIf","opA","opB","isArray","checked","checkedIfSelected","o","found","find","selectedOptions","value","toString","hasOptions","asyncOptions","map","extend","_id","hasSelectedOptions","compact","match","searching","loading","dataTable","isArrayField","dateValue","date","getFullYear","getMonth","getDate","numberValue","minuteValue","time","Math","floor","secondValue","editing","isChanged","newValue","currentSpec","editableField","fieldLabel","doSearch","e","templInstance","elem","currentTarget","val","isNaN","getTime","set","parseInt","mins","secs","events","is","spec","indexedNumber","attr","callback","then","newFieldSpec","removeAttr","Tracker","nonreactive","type","label","editFieldCallback","catch","err","console","error","removeColumn","newOption","f","union","throttledUpdate","onRendered","autorun","afterFlush","fn","select2","tags","placeholder","allowClear","id","groupNames","g","text","groupName","trigger","document","off","onCreated","ReactiveVar","searchChanged","Dependency","sort","throttle","reactiveVar","wait","leading","isFunction","initSearch","Promise","lastSearch","RegExp","comp","numericSearches","firstRun","parseFloat"],"mappings":"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","sourcesContent":["import { ReactiveDict } from \"meteor/reactive-dict\";\nimport _ from \"underscore\";\nimport \"../manageColumnsForm/manageColumnsForm.js\";\nimport \"./filterModal.html\";\nimport \"./filterModal.css\";\n\nfunction closeModal() {\n  const filterModalWrapper = $(\"#dynamic-table-filter-modal\")[0];\n  if (filterModalWrapper) {\n    Blaze.remove(filterModalWrapper.__blazeTemplate);\n    filterModalWrapper.innerHTML = \"\";\n  }\n}\nTemplate.dynamicTableFilterModal.helpers({\n  manageFieldsEditContext() {\n    return Template.instance().data.field.edit;\n  },\n  showOperators() {\n    return Template.instance().showOperators.get();\n  },\n  hasFooter() {\n    return this.filter && (this.filter.enabled || !this.filter.required);\n  },\n  checkedIfWithValue() {\n    return [\"$between\", \"$in\", \"$regex\"].includes(this.filter.operator.selected) ? { selected: \"selected\" } : {};\n  },\n  checkedIfWithAllValue() {\n    return [\"$all\"].includes(this.filter.operator.selected) ? { selected: \"selected\" } : {};\n  },\n  checkedIfGteValue() {\n    return this.filter.operator.selected === \"$gte\" ? { selected: \"selected\" } : {};\n  },\n  checkedIfLteValue() {\n    return this.filter.operator.selected === \"$lte\" ? { selected: \"selected\" } : {};\n  },\n  checkedIfWithoutValue() {\n    return [\"$nin\"].includes(this.filter.operator.selected) ? { selected: \"selected\" } : {};\n  },\n  checkedIfWithoutAllValue() {\n    return [\"$not$all\"].includes(this.filter.operator.selected) ? { selected: \"selected\" } : {};\n  },\n  searchEnabled() {\n    if (this.filter.options) {\n      return this.filter.search && this.filter.search.enabled;\n    }\n    return this.filter.search === undefined || this.filter.search.enabled !== false;\n  },\n  isAny() {\n    return [\"$in\", \"$nin\"].includes(Template.instance().operator.get());\n  },\n  isAll() {\n    return [\"$all\", \"$not$all\"].includes(Template.instance().operator.get());\n  },\n  isNumericOrDateAndNoOptions() {\n    const fieldType = Template.instance().fieldType.get();\n    const isNumericOrDate = fieldType && (fieldType === \"time\" || fieldType === Number || fieldType === Date);\n\n    return isNumericOrDate && Template.instance().allOptions.get().length === 0;\n  },\n  isNumericOrDate() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType && (fieldType === \"time\" || fieldType === Number || fieldType === Date);\n  },\n  isTime() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType && (fieldType === \"time\");\n  },\n  isNumber() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType && (fieldType === Number);\n  },\n  isDate() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType && (fieldType === Date);\n  },\n  isStringOrCustom() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType === String || (fieldType !== Number && fieldType !== Date && fieldType !== \"time\");\n  },\n  isString() {\n    const fieldType = Template.instance().fieldType.get();\n    return fieldType === String;\n  },\n  sortDirection(direction) {\n    return Template.instance().sortDirection.get() === direction;\n  },\n  checkedIf(opA, opB) {\n    if (_.isArray(opA)) {\n      return opA.includes(opB) ? { checked: \"checked\" } : {};\n    }\n    return opA === opB ? { checked: \"checked\" } : {};\n  },\n  checkedIfSelected(o) {\n    const found = _.find(Template.instance().selectedOptions.get(), (value) => value instanceof Date ? value.toString() === o.toString() : value === o);\n    return found ? { checked: \"checked\"} : {};\n  },\n  hasOptions() {\n    if (Template.instance().asyncOptions.get()) {\n      return true;\n    }\n    const options = Template.instance().allOptions.get();\n    return options && options.length;\n  },\n  options() {\n    return Template.instance().options.get().map(o => _.extend({ _id: o.value instanceof Date ? o.value.toString() : o.value }, o));\n  },\n  hasSelectedOptions() {\n    const options = Template.instance().selectedOptions.get();\n    return options && options.length;\n  },\n  selectedOptions() {\n    const options = Template.instance().allOptions.get();\n    if (!options) {\n      return [];\n    }\n    const selectedOptions = _.compact(Template.instance().selectedOptions.get().map((o) => {\n      const match = _.find(options, ({ value }) => value instanceof Date ? value.toString() === o.toString() : value === o);\n      return match;\n    }));\n    return selectedOptions.map(o => _.extend({ _id: o.value instanceof Date ? o.value.toString() : o.value }, o));\n  },\n  searching() {\n    return Template.instance().searching.get();\n  },\n  loading() {\n    return Template.instance().data.dataTable && Template.instance().data.dataTable.loading.get();\n  },\n  isArrayField() {\n    return Template.instance().isArrayField.get();\n  },\n  dateValue() {\n    const date = Template.instance().data.filter.search.value;\n    if (date) {\n      return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;\n    }\n  },\n  numberValue() {\n    return Template.instance().data.filter.search.value;\n  },\n  minuteValue() {\n    const time = Template.instance().data.filter.search.value;\n    if (time) {\n      return Math.floor(time / 60);\n    }\n  },\n  secondValue() {\n    const time = Template.instance().data.filter.search.value;\n    if (time) {\n      return time % 60;\n    }\n  },\n  editing() {\n    return Template.instance().editing.get();\n  },\n  isChanged(field) {\n    const newValue = Template.instance().currentSpec.get(field);\n\n    return newValue !== undefined && newValue !== Template.instance().editableField.get()[field];\n  },\n  editableField() {\n    return Template.instance().editableField.get();\n  },\n  fieldLabel() {\n    return Template.instance().fieldLabel.get();\n  }\n});\n\nfunction doSearch(e, templInstance) {\n  const elem = $(e.currentTarget);\n  const fieldType = templInstance.fieldType.get();\n  if (fieldType === Date) {\n    const date = new Date(elem.val());\n    if (!Number.isNaN(date.getTime())) {\n      templInstance.search.set(date);\n    }\n    else {\n      templInstance.search.set(undefined);\n    }\n  }\n  else if (fieldType === Number) {\n    templInstance.search.set(parseInt(templInstance.$(\".input-dynamic-table-search\").val(), 10));\n  }\n  else if (fieldType === \"time\") {\n    const mins = parseInt($(templInstance.$(\".input-dynamic-table-search\")[0]).val(), 10) || 0;\n    const secs = parseInt($(templInstance.$(\".input-dynamic-table-search\")[1]).val(), 10) || 0;\n    templInstance.search.set((mins * 60) + secs);\n  }\n}\n\n\nTemplate.dynamicTableFilterModal.events({\n  \"change .dynamic-table-filter-edit-type\"(e, templInstance) {\n    templInstance.currentSpec.set(\"type\", $(e.currentTarget).val());\n  },\n  \"click .dynamic-table-filter-edit-isArray\"(e, templInstance) {\n    templInstance.currentSpec.set(\"isArray\", $(e.currentTarget).is(\":checked\"));\n  },\n  \"click .dynamic-table-filter-edit-searchable\"(e, templInstance) {\n    templInstance.currentSpec.set(\"indexedNumber\", $(e.currentTarget).is(\":checked\") ? (this.field.edit.spec.indexedNumber === false ? \"new\" : this.field.edit.spec.indexedNumber) : false);\n  },\n  \"click .btn-dynamic-table-cancel\"(e, templInstance) {\n    templInstance.editing.set(false);\n  },\n  \"click .btn-dynamic-table-save\"(e, templInstance) {\n    templInstance.$(\".btn-dynamic-table-save\").attr(\"disabled\", \"disabled\");\n    templInstance.data.field.edit.callback(e, templInstance)\n    .then((newFieldSpec) => {\n      templInstance.$(\".btn-dynamic-table-save\").removeAttr(\"disabled\");\n      Tracker.nonreactive(() => {\n        templInstance.editableField.set(newFieldSpec);\n      });\n      let fieldType = newFieldSpec.type;\n      if (fieldType === \"string\") {\n        fieldType = String;\n      }\n      else if (fieldType === \"number\") {\n        fieldType = Number;\n      }\n      else if (fieldType === \"date\") {\n        fieldType = Date;\n      }\n      templInstance.isArrayField.set(newFieldSpec.isArray);\n      templInstance.fieldType.set(fieldType);\n      templInstance.fieldLabel.set(newFieldSpec.label);\n      templInstance.editing.set(false);\n      templInstance.data.editFieldCallback(newFieldSpec);\n    })\n    .catch((err) => {\n      console.error(err);\n    });\n  },\n  \"click .dynamic-table-filter-edit-btn\"(e, templInstance) {\n    templInstance.editing.set(true);\n  },\n  \"click .btn-dynamic-table-remove\"(e, templInstance) {\n    templInstance.data.callback([], \"$in\", undefined, false);\n    templInstance.data.removeColumn();\n    closeModal();\n  },\n  \"click .btn-dynamic-table-clear\"(e, templInstance) {\n    templInstance.search.set(undefined);\n    templInstance.selectedOptions.set([]);\n    templInstance.$(\".input-dynamic-table-search\").val(\"\");\n    // templInstance.data.callback([], \"$in\", undefined, false);\n  },\n  \"click .btn-dynamic-table-sort\"(e, templInstance) {\n    templInstance.sortDirection.set($(e.currentTarget).data(\"direction\"));\n  },\n  \"change .input-dynamic-table-operator\"(e, templInstance) {\n    const options = Template.instance().options.get();\n    const hasOptions = options && options.length;\n    let operator = $(e.currentTarget).val();\n    if (operator === \"$in\") {\n      if (!hasOptions) {\n        operator = \"$regex\";\n      }\n      if (templInstance.$(\".btn-dynamic-table-operator.btn-dynamic-table-selected\").data(\"modifier\") === \"$all\") {\n        operator = \"$all\";\n      }\n    }\n    if (operator === \"$nin\") {\n      if (!hasOptions) {\n        operator = \"$not\";\n      }\n    }\n    templInstance.operator.set(operator);\n  },\n  \"click .fa-cog\"(e, templInstance) {\n    templInstance.showOperators.set(!templInstance.showOperators.get());\n  },\n  \"change .select-dynamic-table-operator\"(e, templInstance) {\n    const options = Template.instance().options.get();\n    const hasOptions = options && options.length;\n    let operator = $(e.currentTarget).val();\n    if (operator === \"$in\") {\n      if (!hasOptions) {\n        operator = \"$regex\";\n      }\n    }\n    if (operator === \"$nin\") {\n      if (!hasOptions) {\n        operator = \"$not\";\n      }\n    }\n    templInstance.operator.set(operator);\n  },\n  \"click .label-dynamic-table-selected\"(e, templInstance) {\n    const selectedOptions = templInstance.selectedOptions.get();\n    const newOption = $(e.currentTarget).data(\"value\");\n    templInstance.selectedOptions.set(selectedOptions.filter(f => f instanceof Date ? f.toString() !== newOption : f !== newOption));\n  },\n  \"click .input-dynamic-table-option\"(e, templInstance) {\n    const selectedOptions = templInstance.selectedOptions.get();\n    const newOption = $(e.currentTarget).val();\n    if ($(e.currentTarget).is(\":checked\")) {\n      templInstance.selectedOptions.set(_.union(selectedOptions, [newOption]));\n    }\n    else {\n      templInstance.selectedOptions.set(selectedOptions.filter(f => f instanceof Date ? f.toString() !== newOption : f !== newOption));\n    }\n  },\n  \"keyup .input-dynamic-table-search\"(e, templInstance) {\n    const elem = $(e.currentTarget);\n    const data = Template.instance().data;\n    const fieldType = templInstance.fieldType.get();\n    if (fieldType === Date || fieldType === \"time\" || fieldType === Number) {\n      doSearch(e, templInstance);\n      return;\n    }\n    if (_.isArray(data.filter.options)) {\n      templInstance.search.set(elem.val());\n    }\n    else {\n      templInstance.searching.set(true);\n      templInstance.throttledUpdate(templInstance.search, elem.val());\n    }\n  },\n  \"change .input-dynamic-table-search\"(e, templInstance) {\n    doSearch(e, templInstance);\n  }\n});\nTemplate.dynamicTableFilterModal.onRendered(function onRendered() {\n  Tracker.autorun(() => {\n    if (this.editing.get()) {\n      Tracker.afterFlush(() => {\n        if ($.fn.select2) {\n          this.$(\".dynamic-table-filter-edit-group\").select2({\n            tags: true,\n            placeholder: \"Select a Group\",\n            allowClear: true,\n            data: _.union(\n              [{ id: \"\", value: \"\" }],\n              this.data.groupNames.map(g => ({ id: g, text: g }))\n            )\n          });\n          this.$(\".dynamic-table-filter-edit-group\").val(this.editableField.get().groupName).trigger(\"change\");\n        }\n      });\n    }\n  });\n  /**\n   * When filter modal is open over any existing bootstrap modal,\n   * input element i.e search field of filter modal is not clickable,\n   * To fix it, we get rid of focus on bootstrap modal\n   */\n  $(document).off(\"focusin.modal\");\n});\n\nTemplate.dynamicTableFilterModal.onCreated(function onCreated() {\n  this.editableField = new ReactiveVar(this.data.field && this.data.field.edit && this.data.field.edit.spec);\n  this.isArrayField = new ReactiveVar(false);\n  this.fieldLabel = new ReactiveVar(this.data.field && this.data.field.label);\n  this.fieldType = new ReactiveVar(this.data.field && this.data.field.type);\n  if (this.data.field && this.data.field.type && _.isArray(this.data.field && this.data.field.type)) {\n    this.fieldType.set(this.data.field.type[0]);\n    this.isArrayField.set(true);\n  }\n  this.currentSpec = new ReactiveDict();\n  this.editing = new ReactiveVar(false);\n  this.showOperators = new ReactiveVar(this.data.filter && this.data.filter.operator && this.data.filter.operator.selected && ![\"$in\", \"$regex\", \"$between\"].includes(this.data.filter.operator.selected));\n  this.options = new ReactiveVar();\n  this.allOptions = new ReactiveVar([]);\n  this.search = new ReactiveVar(this.data.filter && this.data.filter.search && this.data.filter.search.value);\n  this.searching = new ReactiveVar(false);\n  this.selectedOptions = new ReactiveVar([]);\n  this.searchChanged = new Tracker.Dependency();\n  this.sortDirection = new ReactiveVar(this.data.sort && this.data.sort.direction);\n  this.asyncOptions = new ReactiveVar(false);\n  this.operator = new ReactiveVar(this.data.filter && this.data.filter && this.data.filter.operator && this.data.filter.operator.selected);\n  this.throttledUpdate = _.throttle(\n    (reactiveVar, val) => {\n      reactiveVar.set(val);\n    },\n    this.data.filter && this.data.filter.throttle ? this.data.filter.throttle.wait : 1000,\n    this.data.filter && this.data.filter.throttle ? this.data.filter.throttle.options : { leading: false }\n  );\n\n  const data = this.data;\n  if (data.filter && _.isFunction(data.filter.options)) {\n    const initSearch = data.filter.selectedOptions && !_.isArray(data.filter.selectedOptions) && data.filter.selectedOptions.length ? data.filter.selectedOptions : undefined;\n    const options = data.filter.options(data, initSearch, (asyncOptions) => {\n      this.asyncOptions.set(true);\n      this.allOptions.set(asyncOptions.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n      this.options.set(asyncOptions.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n      this.searching.set(false);\n    });\n    if (options instanceof Promise) {\n      options.then((asyncOptions) => {\n        this.asyncOptions.set(true);\n        this.allOptions.set(asyncOptions.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n        this.options.set(asyncOptions.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n        this.searching.set(false);\n      });\n    }\n    else if (options) {\n      this.allOptions.set(options.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n      this.options.set(options.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n      this.searching.set(false);\n    }\n  }\n  else if (data.filter && _.isArray(data.filter.options)) {\n    this.allOptions.set(data.filter.options.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n    this.options.set(data.filter.options.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n  }\n  if (data.filter && data.filter.selectedOptions) {\n    if (_.isFunction(data.filter.selectedOptions)) {\n      const selectedOptions = data.filter.selectedOptions(data, (asyncOptions) => {\n        this.selectedOptions.set(asyncOptions);\n      });\n      if (selectedOptions instanceof Promise) {\n        selectedOptions.then((asyncOptions) => {\n          this.selectedOptions.set(asyncOptions);\n        });\n      }\n      else if (selectedOptions) {\n        this.selectedOptions.set(selectedOptions);\n      }\n    }\n    else if (_.isArray(data.filter.selectedOptions)) {\n      this.selectedOptions.set(data.filter.selectedOptions);\n    }\n  }\n  let lastSearch;\n  if (data.filter && data.filter.options) {\n    this.autorun(() => {\n      const search = this.search.get();\n      if (search === lastSearch) {\n        return;\n      }\n      lastSearch = search;\n      if (_.isFunction(data.filter.options)) {\n        const options = data.filter.options(data, search, (asyncOptions) => {\n          this.options.set(asyncOptions.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n          this.searching.set(false);\n        });\n        if (options instanceof Promise) {\n          options.then((asyncOptions) => {\n            this.options.set(asyncOptions.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n            this.searching.set(false);\n          });\n        }\n        else if (options) {\n          this.options.set(options.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n          this.searching.set(false);\n        }\n      }\n      else if (_.isArray(data.filter.options)) {\n        if (search) {\n          this.options.set(data.filter.options.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })).filter(o => o.label.match(new RegExp(search, \"i\"))));\n        }\n        else {\n          this.options.set(data.filter.options.map(o => ((typeof o) === \"object\" ? o : { label: o, value: o })));\n        }\n      }\n    });\n  }\n\n  const callback = this.data.callback;\n  if (callback && this.data.filter && this.data.filter.enabled) {\n    this.autorun((comp) => {\n      let selectedOptions = this.selectedOptions.get();\n      let operator = this.operator.get();\n      const options = this.allOptions.get();\n      const fieldType = this.fieldType.get();\n      if (selectedOptions.length === 0 && (fieldType === Date || fieldType === \"time\" || fieldType === Number)) {\n        selectedOptions = this.search.get();\n        const numericSearches = [\n          \"$gt\",\n          \"$lt\",\n          \"$gte\",\n          \"$lte\",\n          \"$between\"\n        ];\n        if (!numericSearches.includes(operator)) {\n          operator = \"$between\";\n        }\n        if (operator === \"$between\" && selectedOptions instanceof Date) {\n          selectedOptions = [\n            selectedOptions,\n            new Date(selectedOptions.getTime() + (24 * 60 * 60 * 1000))\n          ];\n        }\n        else if (operator === \"$between\" && (typeof selectedOptions) === \"number\") {\n          // HACK: to handle equality of numbers\n          selectedOptions = [\n            selectedOptions,\n            selectedOptions\n          ];\n        }\n      }\n      else if (!options || !options.length && !this.asyncOptions.get()) {\n        selectedOptions = this.search.get();\n        if (operator === \"$in\" || operator === \"$all\") {\n          operator = \"$regex\";\n        }\n        else if (operator === \"$nin\" || operator === \"$not$all\") {\n          operator = \"$not\";\n        }\n      }\n      const direction = this.sortDirection.get();\n      if (comp.firstRun) {\n        return;\n      }\n\n      if (fieldType === Number) {\n        if (_.isArray(selectedOptions)) {\n          selectedOptions = selectedOptions.map(v => (typeof v === \"number\" ? v : (v.includes(\".\") ? parseFloat(v) : parseInt(v, 10))));\n        }\n      }\n      if (fieldType === Date) {\n        if (_.isArray(selectedOptions)) {\n          selectedOptions = selectedOptions.map(v => new Date(v));\n        }\n      }\n      Tracker.nonreactive(() => callback(selectedOptions, operator, direction, false));\n    });\n  }\n});\n"]},"sourceType":"script","hash":"15bb57d4c058a53886495032993957348a38d142"}
