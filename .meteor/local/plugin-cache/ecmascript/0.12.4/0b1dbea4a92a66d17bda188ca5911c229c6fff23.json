{"metadata":{},"options":{"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\components\\select2ValueEditor\\select2ValueEditor.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/znewsham:dynamic-table/client/ui/components/select2ValueEditor/select2ValueEditor.js","filename":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\components\\select2ValueEditor\\select2ValueEditor.js","passPerPreset":false,"envName":"development","cwd":"C:\\Sandbox\\test","root":"C:\\Sandbox\\test","plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"transform-runtime","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{}},{"key":"proposal-class-properties","visitor":{"PrivateName":{"enter":[null]},"_exploded":true,"_verified":true,"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"transform-modules-commonjs","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-flow","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"transform-for-of","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{}},{"key":"proposal-object-rest-spread","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-flow-strip-types","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"ClassPrivateProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"generatorOpts":{"filename":"C:\\Sandbox\\test\\packages\\znewsham:dynamic-table\\client\\ui\\components\\select2ValueEditor\\select2ValueEditor.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/znewsham:dynamic-table/client/ui/components/select2ValueEditor/select2ValueEditor.js"}},"code":"module.link(\"./select2ValueEditor.html\");\nlet getValue, inlineSave, nextField;\nmodule.link(\"../../../inlineSave.js\", {\n  getValue(v) {\n    getValue = v;\n  },\n\n  inlineSave(v) {\n    inlineSave = v;\n  },\n\n  nextField(v) {\n    nextField = v;\n  }\n\n}, 0);\n\nfunction getAjaxConfig(origOptions, optionsResult) {\n  const self = this;\n\n  if (!_.isFunction(origOptions) || optionsResult) {\n    return undefined;\n  }\n\n  let hadResults = false;\n  return {\n    transport(params, success, failure) {\n      const val = self.data.value || getValue(self.data.doc, self.data.column.data) || [];\n      origOptions(self.data.doc, self.data.column, val, params.data.q, results => {\n        if (results.length && !hadResults) {\n          const select = self.$(\"select\");\n          select.empty();\n          results.forEach(result => {\n            select.append($(\"<option selected=\\\"selected\\\" aria-selected=\\\"true\\\">\").text(result.text).val(result.id));\n          });\n          select.val(val).trigger(\"change\");\n          hadResults = true;\n        }\n\n        success({\n          results\n        });\n      });\n    }\n\n  };\n}\n\nfunction handler(e) {\n  if (nextField.inProgress) {\n    return;\n  }\n\n  let $select = $(e.currentTarget).closest(\"td\").find(\".dynamicTableSelect2ValueEditor\");\n\n  if (!$select.length) {\n    const possibles = _.toArray($(\".select2-container\"));\n\n    $select = $(possibles.find(elem => $(elem).data(\"element\").data(\"select2\").$dropdown.find(e.currentTarget).length)).closest(\"td\").find(\".dynamicTableSelect2ValueEditor\");\n  }\n\n  if (!$select.length) {\n    return;\n  }\n\n  const tmplInstance = Blaze.getView($select[0]).templateInstance();\n\n  if (e.keyCode === 9) {\n    inlineSave(tmplInstance, $select.val());\n    nextField(tmplInstance);\n  }\n} // NOTE: not sure why we need different handlers for multi vs single? Could be JP-common code?\n\n\njQuery(document).ready($ => {\n  $(document).on('keydown', '.select2-search--dropdown input.select2-search__field', handler);\n  $(document).on('keyup', '.select2-selection--multiple input.select2-search__field', handler);\n});\nTemplate.dynamicTableSelect2ValueEditor.onRendered(function onRendered() {\n  let options = this.data.options;\n  const val = this.data.value || getValue(this.data.doc, this.data.column.data) || [];\n  const origOptions = options;\n\n  if (_.isFunction(options)) {\n    options = options(this.data.doc, this.data.column, val);\n  }\n\n  this.$(\"select\").select2({\n    multiple: !!this.data.multiple,\n    allowClear: true,\n    tags: this.data.tags || !options,\n    createTag: _.isFunction(this.data.createTag) ? this.data.createTag : params => {\n      const term = $.trim(params.term);\n\n      if (term === \"\" || this.data.createTag === false) {\n        return null;\n      }\n\n      return {\n        id: term,\n        text: term\n      };\n    },\n    ajax: getAjaxConfig.call(this, origOptions, options),\n    data: [{\n      id: [],\n      text: \"\",\n      search: \"\",\n      hidden: false\n    }].concat(options || []),\n    placeholder: {\n      id: [],\n      text: \"Add tags\"\n    }\n  });\n  this.$(\"select\").val(val);\n  this.$(\"select\").trigger(\"change\");\n  this.$(\"select\").select2(\"open\");\n\n  if (this.handler) {\n    document.removeEventListener(\"mousedown\", this.handler, false);\n  }\n\n  this.handler = e => {\n    try {\n      const container = this.$(\"select\").data(\"select2\").$container;\n\n      if (!container.has($(e.target)).length) {\n        inlineSave(this, this.$(\"select\").val(), this.$(\"select\").data(\"select2\").data());\n      }\n    } catch (e1) {\n      document.removeEventListener(\"mousedown\", this.handler, false);\n    }\n  };\n\n  document.addEventListener(\"mousedown\", this.handler, false);\n});\nTemplate.dynamicTableSelect2ValueEditor.onDestroyed(function onDestroyed() {\n  this.$(\"select\").select2(\"destroy\");\n  document.removeEventListener(\"mousedown\", this.handler, false);\n});\nTemplate.dynamicTableSelect2ValueEditor.events({\n  \"select2:close select\"(e, templInstance) {\n    const target = e.currentTarget;\n\n    if (templInstance.waiting) {\n      clearTimeout(templInstance.waiting);\n    }\n\n    const data = templInstance.$(\"select\").data(\"select2\").data();\n    templInstance.waiting = setTimeout(() => {\n      if (!templInstance.data.multiple) {\n        inlineSave(templInstance, $(target).val(), data);\n      }\n    }, 100);\n  }\n\n});","map":{"version":3,"sources":["packages/znewsham:dynamic-table/client/ui/components/select2ValueEditor/select2ValueEditor.js"],"names":["module","link","getValue","inlineSave","nextField","v","getAjaxConfig","origOptions","optionsResult","self","_","isFunction","undefined","hadResults","transport","params","success","failure","val","data","value","doc","column","q","results","length","select","$","empty","forEach","result","append","text","id","trigger","handler","e","inProgress","$select","currentTarget","closest","find","possibles","toArray","elem","$dropdown","tmplInstance","Blaze","getView","templateInstance","keyCode","jQuery","document","ready","on","Template","dynamicTableSelect2ValueEditor","onRendered","options","select2","multiple","allowClear","tags","createTag","term","trim","ajax","call","search","hidden","concat","placeholder","removeEventListener","container","$container","has","target","e1","addEventListener","onDestroyed","events","templInstance","waiting","clearTimeout","setTimeout"],"mappings":"AAAAA,MAAM,CAACC,IAAP,CAAY,2BAAZ;AAAyC,IAAIC,QAAJ,EAAaC,UAAb,EAAwBC,SAAxB;AAAkCJ,MAAM,CAACC,IAAP,CAAY,wBAAZ,EAAqC;AAACC,EAAAA,QAAQ,CAACG,CAAD,EAAG;AAACH,IAAAA,QAAQ,GAACG,CAAT;AAAW,GAAxB;;AAAyBF,EAAAA,UAAU,CAACE,CAAD,EAAG;AAACF,IAAAA,UAAU,GAACE,CAAX;AAAa,GAApD;;AAAqDD,EAAAA,SAAS,CAACC,CAAD,EAAG;AAACD,IAAAA,SAAS,GAACC,CAAV;AAAY;;AAA9E,CAArC,EAAqH,CAArH;;AAG3E,SAASC,aAAT,CAAuBC,WAAvB,EAAoCC,aAApC,EAAmD;AACjD,QAAMC,IAAI,GAAG,IAAb;;AACA,MAAI,CAACC,CAAC,CAACC,UAAF,CAAaJ,WAAb,CAAD,IAA8BC,aAAlC,EAAiD;AAC/C,WAAOI,SAAP;AACD;;AACD,MAAIC,UAAU,GAAG,KAAjB;AACA,SAAO;AACLC,IAAAA,SAAS,CAACC,MAAD,EAASC,OAAT,EAAkBC,OAAlB,EAA2B;AAClC,YAAMC,GAAG,GAAGT,IAAI,CAACU,IAAL,CAAUC,KAAV,IAAmBlB,QAAQ,CAACO,IAAI,CAACU,IAAL,CAAUE,GAAX,EAAgBZ,IAAI,CAACU,IAAL,CAAUG,MAAV,CAAiBH,IAAjC,CAA3B,IAAqE,EAAjF;AACAZ,MAAAA,WAAW,CAACE,IAAI,CAACU,IAAL,CAAUE,GAAX,EAAgBZ,IAAI,CAACU,IAAL,CAAUG,MAA1B,EAAkCJ,GAAlC,EAAuCH,MAAM,CAACI,IAAP,CAAYI,CAAnD,EAAuDC,OAAD,IAAa;AAC5E,YAAIA,OAAO,CAACC,MAAR,IAAkB,CAACZ,UAAvB,EAAmC;AACjC,gBAAMa,MAAM,GAAGjB,IAAI,CAACkB,CAAL,CAAO,QAAP,CAAf;AACAD,UAAAA,MAAM,CAACE,KAAP;AACAJ,UAAAA,OAAO,CAACK,OAAR,CAAiBC,MAAD,IAAY;AAC1BJ,YAAAA,MAAM,CAACK,MAAP,CAAcJ,CAAC,CAAC,uDAAD,CAAD,CAA2DK,IAA3D,CAAgEF,MAAM,CAACE,IAAvE,EAA6Ed,GAA7E,CAAiFY,MAAM,CAACG,EAAxF,CAAd;AACD,WAFD;AAGAP,UAAAA,MAAM,CAACR,GAAP,CAAWA,GAAX,EAAgBgB,OAAhB,CAAwB,QAAxB;AACArB,UAAAA,UAAU,GAAG,IAAb;AACD;;AACDG,QAAAA,OAAO,CAAC;AAAEQ,UAAAA;AAAF,SAAD,CAAP;AACD,OAXU,CAAX;AAYD;;AAfI,GAAP;AAiBD;;AAED,SAASW,OAAT,CAAiBC,CAAjB,EAAoB;AAClB,MAAIhC,SAAS,CAACiC,UAAd,EAA0B;AACxB;AACD;;AACD,MAAIC,OAAO,GAAGX,CAAC,CAACS,CAAC,CAACG,aAAH,CAAD,CAAmBC,OAAnB,CAA2B,IAA3B,EAAiCC,IAAjC,CAAsC,iCAAtC,CAAd;;AACA,MAAI,CAACH,OAAO,CAACb,MAAb,EAAqB;AACnB,UAAMiB,SAAS,GAAGhC,CAAC,CAACiC,OAAF,CAAUhB,CAAC,CAAC,oBAAD,CAAX,CAAlB;;AACAW,IAAAA,OAAO,GAAGX,CAAC,CACTe,SAAS,CACRD,IADD,CACMG,IAAI,IAAIjB,CAAC,CAACiB,IAAD,CAAD,CAAQzB,IAAR,CAAa,SAAb,EAAwBA,IAAxB,CAA6B,SAA7B,EAAwC0B,SAAxC,CAAkDJ,IAAlD,CAAuDL,CAAC,CAACG,aAAzD,EAAwEd,MADtF,CADS,CAAD,CAITe,OAJS,CAID,IAJC,EAKTC,IALS,CAKJ,iCALI,CAAV;AAMD;;AACD,MAAI,CAACH,OAAO,CAACb,MAAb,EAAqB;AACnB;AACD;;AACD,QAAMqB,YAAY,GAAGC,KAAK,CAACC,OAAN,CAAcV,OAAO,CAAC,CAAD,CAArB,EAA0BW,gBAA1B,EAArB;;AACA,MAAIb,CAAC,CAACc,OAAF,KAAc,CAAlB,EAAqB;AACnB/C,IAAAA,UAAU,CAAC2C,YAAD,EAAeR,OAAO,CAACpB,GAAR,EAAf,CAAV;AACAd,IAAAA,SAAS,CAAC0C,YAAD,CAAT;AACD;AACF,C,CAED;;;AACAK,MAAM,CAACC,QAAD,CAAN,CAAiBC,KAAjB,CAAwB1B,CAAD,IAAO;AAC5BA,EAAAA,CAAC,CAACyB,QAAD,CAAD,CAAYE,EAAZ,CAAe,SAAf,EAA0B,uDAA1B,EAAmFnB,OAAnF;AACAR,EAAAA,CAAC,CAACyB,QAAD,CAAD,CAAYE,EAAZ,CAAe,OAAf,EAAwB,0DAAxB,EAAoFnB,OAApF;AACD,CAHD;AAKAoB,QAAQ,CAACC,8BAAT,CAAwCC,UAAxC,CAAmD,SAASA,UAAT,GAAsB;AACvE,MAAIC,OAAO,GAAG,KAAKvC,IAAL,CAAUuC,OAAxB;AACA,QAAMxC,GAAG,GAAG,KAAKC,IAAL,CAAUC,KAAV,IAAmBlB,QAAQ,CAAC,KAAKiB,IAAL,CAAUE,GAAX,EAAgB,KAAKF,IAAL,CAAUG,MAAV,CAAiBH,IAAjC,CAA3B,IAAqE,EAAjF;AACA,QAAMZ,WAAW,GAAGmD,OAApB;;AACA,MAAIhD,CAAC,CAACC,UAAF,CAAa+C,OAAb,CAAJ,EAA2B;AACzBA,IAAAA,OAAO,GAAGA,OAAO,CAAC,KAAKvC,IAAL,CAAUE,GAAX,EAAgB,KAAKF,IAAL,CAAUG,MAA1B,EAAkCJ,GAAlC,CAAjB;AACD;;AACD,OAAKS,CAAL,CAAO,QAAP,EAAiBgC,OAAjB,CAAyB;AACvBC,IAAAA,QAAQ,EAAE,CAAC,CAAC,KAAKzC,IAAL,CAAUyC,QADC;AAEvBC,IAAAA,UAAU,EAAE,IAFW;AAGvBC,IAAAA,IAAI,EAAE,KAAK3C,IAAL,CAAU2C,IAAV,IAAkB,CAACJ,OAHF;AAIvBK,IAAAA,SAAS,EAAErD,CAAC,CAACC,UAAF,CAAa,KAAKQ,IAAL,CAAU4C,SAAvB,IAAoC,KAAK5C,IAAL,CAAU4C,SAA9C,GAA4DhD,MAAD,IAAY;AAChF,YAAMiD,IAAI,GAAGrC,CAAC,CAACsC,IAAF,CAAOlD,MAAM,CAACiD,IAAd,CAAb;;AAEA,UAAIA,IAAI,KAAK,EAAT,IAAe,KAAK7C,IAAL,CAAU4C,SAAV,KAAwB,KAA3C,EAAkD;AAChD,eAAO,IAAP;AACD;;AAED,aAAO;AACL9B,QAAAA,EAAE,EAAE+B,IADC;AAELhC,QAAAA,IAAI,EAAEgC;AAFD,OAAP;AAID,KAfsB;AAgBvBE,IAAAA,IAAI,EAAE5D,aAAa,CAAC6D,IAAd,CAAmB,IAAnB,EAAyB5D,WAAzB,EAAsCmD,OAAtC,CAhBiB;AAiBvBvC,IAAAA,IAAI,EAAE,CAAC;AACLc,MAAAA,EAAE,EAAE,EADC;AAELD,MAAAA,IAAI,EAAE,EAFD;AAGLoC,MAAAA,MAAM,EAAE,EAHH;AAILC,MAAAA,MAAM,EAAE;AAJH,KAAD,EAKHC,MALG,CAKIZ,OAAO,IAAI,EALf,CAjBiB;AAuBvBa,IAAAA,WAAW,EAAE;AACXtC,MAAAA,EAAE,EAAE,EADO;AAEXD,MAAAA,IAAI,EAAE;AAFK;AAvBU,GAAzB;AA4BA,OAAKL,CAAL,CAAO,QAAP,EAAiBT,GAAjB,CAAqBA,GAArB;AACA,OAAKS,CAAL,CAAO,QAAP,EAAiBO,OAAjB,CAAyB,QAAzB;AACA,OAAKP,CAAL,CAAO,QAAP,EAAiBgC,OAAjB,CAAyB,MAAzB;;AACA,MAAI,KAAKxB,OAAT,EAAkB;AAChBiB,IAAAA,QAAQ,CAACoB,mBAAT,CAA6B,WAA7B,EAA0C,KAAKrC,OAA/C,EAAwD,KAAxD;AACD;;AACD,OAAKA,OAAL,GAAgBC,CAAD,IAAO;AACpB,QAAI;AACF,YAAMqC,SAAS,GAAG,KAAK9C,CAAL,CAAO,QAAP,EAAiBR,IAAjB,CAAsB,SAAtB,EAAiCuD,UAAnD;;AACA,UAAI,CAACD,SAAS,CAACE,GAAV,CAAchD,CAAC,CAACS,CAAC,CAACwC,MAAH,CAAf,EAA2BnD,MAAhC,EAAwC;AACtCtB,QAAAA,UAAU,CAAC,IAAD,EAAO,KAAKwB,CAAL,CAAO,QAAP,EAAiBT,GAAjB,EAAP,EAA+B,KAAKS,CAAL,CAAO,QAAP,EAAiBR,IAAjB,CAAsB,SAAtB,EAAiCA,IAAjC,EAA/B,CAAV;AACD;AACF,KALD,CAMA,OAAO0D,EAAP,EAAW;AACTzB,MAAAA,QAAQ,CAACoB,mBAAT,CAA6B,WAA7B,EAA0C,KAAKrC,OAA/C,EAAwD,KAAxD;AACD;AACF,GAVD;;AAWAiB,EAAAA,QAAQ,CAAC0B,gBAAT,CAA0B,WAA1B,EAAuC,KAAK3C,OAA5C,EAAqD,KAArD;AACD,CArDD;AAsDAoB,QAAQ,CAACC,8BAAT,CAAwCuB,WAAxC,CAAoD,SAASA,WAAT,GAAuB;AACzE,OAAKpD,CAAL,CAAO,QAAP,EAAiBgC,OAAjB,CAAyB,SAAzB;AACAP,EAAAA,QAAQ,CAACoB,mBAAT,CAA6B,WAA7B,EAA0C,KAAKrC,OAA/C,EAAwD,KAAxD;AACD,CAHD;AAKAoB,QAAQ,CAACC,8BAAT,CAAwCwB,MAAxC,CAA+C;AAC7C,yBAAuB5C,CAAvB,EAA0B6C,aAA1B,EAAyC;AACvC,UAAML,MAAM,GAAGxC,CAAC,CAACG,aAAjB;;AACA,QAAI0C,aAAa,CAACC,OAAlB,EAA2B;AACzBC,MAAAA,YAAY,CAACF,aAAa,CAACC,OAAf,CAAZ;AACD;;AACD,UAAM/D,IAAI,GAAG8D,aAAa,CAACtD,CAAd,CAAgB,QAAhB,EAA0BR,IAA1B,CAA+B,SAA/B,EAA0CA,IAA1C,EAAb;AACA8D,IAAAA,aAAa,CAACC,OAAd,GAAwBE,UAAU,CAAC,MAAM;AACvC,UAAI,CAACH,aAAa,CAAC9D,IAAd,CAAmByC,QAAxB,EAAkC;AAChCzD,QAAAA,UAAU,CAAC8E,aAAD,EAAgBtD,CAAC,CAACiD,MAAD,CAAD,CAAU1D,GAAV,EAAhB,EAAiCC,IAAjC,CAAV;AACD;AACF,KAJiC,EAI/B,GAJ+B,CAAlC;AAKD;;AAZ4C,CAA/C","sourcesContent":["import \"./select2ValueEditor.html\";\nimport { getValue, inlineSave, nextField } from \"../../../inlineSave.js\";\n\nfunction getAjaxConfig(origOptions, optionsResult) {\n  const self = this;\n  if (!_.isFunction(origOptions) || optionsResult) {\n    return undefined;\n  }\n  let hadResults = false;\n  return {\n    transport(params, success, failure) {\n      const val = self.data.value || getValue(self.data.doc, self.data.column.data) || [];\n      origOptions(self.data.doc, self.data.column, val, params.data.q, (results) => {\n        if (results.length && !hadResults) {\n          const select = self.$(\"select\");\n          select.empty();\n          results.forEach((result) => {\n            select.append($(\"<option selected=\\\"selected\\\" aria-selected=\\\"true\\\">\").text(result.text).val(result.id));\n          });\n          select.val(val).trigger(\"change\");\n          hadResults = true;\n        }\n        success({ results });\n      });\n    }\n  };\n}\n\nfunction handler(e) {\n  if (nextField.inProgress) {\n    return;\n  }\n  let $select = $(e.currentTarget).closest(\"td\").find(\".dynamicTableSelect2ValueEditor\");\n  if (!$select.length) {\n    const possibles = _.toArray($(\".select2-container\"));\n    $select = $(\n      possibles\n      .find(elem => $(elem).data(\"element\").data(\"select2\").$dropdown.find(e.currentTarget).length)\n    )\n    .closest(\"td\")\n    .find(\".dynamicTableSelect2ValueEditor\");\n  }\n  if (!$select.length) {\n    return;\n  }\n  const tmplInstance = Blaze.getView($select[0]).templateInstance();\n  if (e.keyCode === 9) {\n    inlineSave(tmplInstance, $select.val());\n    nextField(tmplInstance);\n  }\n}\n\n// NOTE: not sure why we need different handlers for multi vs single? Could be JP-common code?\njQuery(document).ready(($) => {\n  $(document).on('keydown', '.select2-search--dropdown input.select2-search__field', handler);\n  $(document).on('keyup', '.select2-selection--multiple input.select2-search__field', handler);\n});\n\nTemplate.dynamicTableSelect2ValueEditor.onRendered(function onRendered() {\n  let options = this.data.options;\n  const val = this.data.value || getValue(this.data.doc, this.data.column.data) || [];\n  const origOptions = options;\n  if (_.isFunction(options)) {\n    options = options(this.data.doc, this.data.column, val);\n  }\n  this.$(\"select\").select2({\n    multiple: !!this.data.multiple,\n    allowClear: true,\n    tags: this.data.tags || !options,\n    createTag: _.isFunction(this.data.createTag) ? this.data.createTag : ((params) => {\n      const term = $.trim(params.term);\n\n      if (term === \"\" || this.data.createTag === false) {\n        return null;\n      }\n\n      return {\n        id: term,\n        text: term\n      };\n    }),\n    ajax: getAjaxConfig.call(this, origOptions, options),\n    data: [{\n      id: [],\n      text: \"\",\n      search: \"\",\n      hidden: false\n    }].concat(options || []),\n    placeholder: {\n      id: [],\n      text: \"Add tags\"\n    }\n  });\n  this.$(\"select\").val(val);\n  this.$(\"select\").trigger(\"change\");\n  this.$(\"select\").select2(\"open\");\n  if (this.handler) {\n    document.removeEventListener(\"mousedown\", this.handler, false);\n  }\n  this.handler = (e) => {\n    try {\n      const container = this.$(\"select\").data(\"select2\").$container;\n      if (!container.has($(e.target)).length) {\n        inlineSave(this, this.$(\"select\").val(), this.$(\"select\").data(\"select2\").data());\n      }\n    }\n    catch (e1) {\n      document.removeEventListener(\"mousedown\", this.handler, false);\n    }\n  };\n  document.addEventListener(\"mousedown\", this.handler, false);\n});\nTemplate.dynamicTableSelect2ValueEditor.onDestroyed(function onDestroyed() {\n  this.$(\"select\").select2(\"destroy\");\n  document.removeEventListener(\"mousedown\", this.handler, false);\n});\n\nTemplate.dynamicTableSelect2ValueEditor.events({\n  \"select2:close select\"(e, templInstance) {\n    const target = e.currentTarget;\n    if (templInstance.waiting) {\n      clearTimeout(templInstance.waiting);\n    }\n    const data = templInstance.$(\"select\").data(\"select2\").data();\n    templInstance.waiting = setTimeout(() => {\n      if (!templInstance.data.multiple) {\n        inlineSave(templInstance, $(target).val(), data);\n      }\n    }, 100);\n  }\n});\n"]},"sourceType":"script","hash":"0b1dbea4a92a66d17bda188ca5911c229c6fff23"}
