[{"type":"js","data":"//////////////////////////////////////////////////////////////////////////\n//                                                                      //\n// This is a generated file. You can view the original                  //\n// source in your browser if your browser supports source maps.         //\n// Source maps are supported by all recent versions of Chrome, Safari,  //\n// and Firefox, and by Internet Explorer 11.                            //\n//                                                                      //\n//////////////////////////////////////////////////////////////////////////\n\n\n(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar Accounts = Package['accounts-base'].Accounts;\nvar Session = Package.session.Session;\nvar ReactiveVar = Package['reactive-var'].ReactiveVar;\nvar Tracker = Package.tracker.Tracker;\nvar Deps = Package.tracker.Deps;\nvar meteorInstall = Package.modules.meteorInstall;\nvar meteorBabelHelpers = Package['babel-runtime'].meteorBabelHelpers;\nvar Promise = Package.promise.Promise;\nvar Symbol = Package['ecmascript-runtime-client'].Symbol;\nvar Map = Package['ecmascript-runtime-client'].Map;\nvar Set = Package['ecmascript-runtime-client'].Set;\n\nvar require = meteorInstall({\"node_modules\":{\"meteor\":{\"ostrio:user-status\":{\"client\":{\"main.js\":function(require,exports,module){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                   //\n// packages/ostrio_user-status/client/main.js                                                        //\n//                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                     //\nmodule.export({\n  UserStatus: function () {\n    return UserStatus;\n  }\n});\nvar throttle;\nmodule.link(\"./throttle\", {\n  \"default\": function (v) {\n    throttle = v;\n  }\n}, 0);\nvar Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 1);\nvar Session;\nmodule.link(\"meteor/session\", {\n  Session: function (v) {\n    Session = v;\n  }\n}, 2);\nvar Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker: function (v) {\n    Tracker = v;\n  }\n}, 3);\nvar Accounts;\nmodule.link(\"meteor/accounts-base\", {\n  Accounts: function (v) {\n    Accounts = v;\n  }\n}, 4);\nvar ReactiveVar;\nmodule.link(\"meteor/reactive-var\", {\n  ReactiveVar: function (v) {\n    ReactiveVar = v;\n  }\n}, 5);\n\nvar NoOp = function () {};\n\nvar UserStatusClass =\n/*#__PURE__*/\nfunction () {\n  function UserStatusClass() {\n    var _this = this;\n\n    Session.setDefault('UserStatusIdle', false);\n    this.status = new ReactiveVar('offline');\n    this.hidden = {};\n    /* @description Set right visibilitychange event and property names */\n\n    this.hidden.str = false;\n    this.hidden.evt = void 0;\n\n    if (typeof document.hidden !== 'undefined') {\n      this.hidden.str = 'hidden';\n      this.hidden.evt = 'visibilitychange';\n    } else if (typeof document.mozHidden !== 'undefined') {\n      this.hidden.str = 'mozHidden';\n      this.hidden.evt = 'mozvisibilitychange';\n    } else if (typeof document.msHidden !== 'undefined') {\n      this.hidden.str = 'msHidden';\n      this.hidden.evt = 'msvisibilitychange';\n    } else if (typeof document.webkitHidden !== 'undefined') {\n      this.hidden.str = 'webkitHidden';\n      this.hidden.evt = 'webkitvisibilitychange';\n    }\n\n    this.hidden.check = function () {\n      return document[_this.hidden.str];\n    };\n    /* @description Set active/inactive user status */\n\n\n    this.hidden.set = function () {\n      if (_this.hidden.check()) {\n        _this.goIdle();\n      } else {\n        _this.goOnline();\n      }\n    };\n\n    Tracker.autorun(function () {\n      var _user = Meteor.user();\n\n      if (_user) {\n        Session.set('UserStatusIdle', _user.profile.idle || false);\n\n        if (_user.profile.idle) {\n          _this.status.set('idle');\n        } else if (_user.profile.online) {\n          _this.status.set('online');\n        } else {\n          _this.status.set('offline');\n        }\n      } else {\n        Session.set('UserStatusIdle', false);\n\n        _this.status.set('offline');\n      }\n    });\n    /* @description Set event listeners */\n\n    this.on(document, [this.hidden.evt], this.hidden.set);\n    this.on(window, ['mousemove', 'mousedown', 'keypress', 'DOMMouseScroll', 'mousewheel', 'touchmove', 'MSPointerMove', 'MSPointerMove'], throttle(this.goOnline.bind(this), 777));\n    this.on(document, ['mousemove', 'mousedown', 'keypress', 'DOMMouseScroll', 'mousewheel', 'touchmove', 'MSPointerMove', 'MSPointerMove'], throttle(this.goOnline.bind(this), 777));\n  }\n\n  var _proto = UserStatusClass.prototype;\n\n  _proto.on = function () {\n    function on(obj, events, fn) {\n      events.forEach(function (event) {\n        if (obj.addEventListener) {\n          obj.addEventListener(event, fn, {\n            passive: true,\n            capture: false\n          });\n        } else {\n          obj.attachEvent('on' + event, fn);\n        }\n      });\n    }\n\n    return on;\n  }();\n\n  _proto.goOnline = function () {\n    function goOnline() {\n      var _user = Meteor.user();\n\n      if (_user && _user._id && (_user.profile.online !== true || _user.profile.idle !== false)) {\n        Meteor.users.update({\n          _id: _user._id\n        }, {\n          $set: {\n            'profile.online': true,\n            'profile.idle': false\n          }\n        }, NoOp);\n      }\n    }\n\n    return goOnline;\n  }();\n\n  _proto.goIdle = function () {\n    function goIdle() {\n      var _user = Meteor.user();\n\n      if (_user && _user._id && (_user.profile.online !== true || _user.profile.idle !== true)) {\n        Meteor.users.update({\n          _id: _user._id\n        }, {\n          $set: {\n            'profile.online': true,\n            'profile.idle': true\n          }\n        }, NoOp);\n      }\n    }\n\n    return goIdle;\n  }();\n\n  _proto.goOffline = function () {\n    function goOffline() {\n      var _user = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : Meteor.user();\n\n      if (_user && _user._id && (_user.profile.online !== false || _user.profile.idle !== false)) {\n        Meteor.users.update({\n          _id: _user._id\n        }, {\n          $set: {\n            'profile.online': false,\n            'profile.idle': false\n          }\n        }, NoOp);\n      }\n    }\n\n    return goOffline;\n  }();\n\n  _proto.startTimer = function () {\n    function startTimer() {\n      Meteor.setInterval(this.goIdle.bind(this), 30000);\n    }\n\n    return startTimer;\n  }();\n\n  _proto.start = function () {\n    function start() {\n      this.startTimer();\n    }\n\n    return start;\n  }();\n\n  return UserStatusClass;\n}();\n\nvar UserStatus = new UserStatusClass();\nAccounts.onLogin(UserStatus.start.bind(UserStatus));\nAccounts.onLogout(UserStatus.goOffline.bind(UserStatus));\n///////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"throttle.js\":function(require,exports,module){\n\n///////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                   //\n// packages/ostrio_user-status/client/throttle.js                                                    //\n//                                                                                                   //\n///////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                     //\nmodule.exportDefault(function (func, wait) {\n  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  var context;\n  var args;\n  var result;\n  var timeout = null;\n  var previous = 0;\n\n  var later = function () {\n    previous = options.leading === false ? 0 : Date.now();\n    timeout = null;\n    result = func.apply(context, args);\n\n    if (!timeout) {\n      context = args = null;\n    }\n  };\n\n  return function () {\n    var now = Date.now();\n\n    if (!previous && options.leading === false) {\n      previous = now;\n    }\n\n    var remaining = wait - (now - previous);\n    context = this;\n    args = arguments;\n\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout);\n        timeout = null;\n      }\n\n      previous = now;\n      result = func.apply(context, args);\n\n      if (!timeout) {\n        context = args = null;\n      }\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining);\n    }\n\n    return result;\n  };\n});\n///////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}}}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\"\n  ]\n});\n\nvar exports = require(\"/node_modules/meteor/ostrio:user-status/client/main.js\");\n\n/* Exports */\nPackage._define(\"ostrio:user-status\", exports);\n\n})();\n","servePath":"/packages/ostrio_user-status.js","sourceMap":{"version":3,"sources":["packages/ostrio:user-status/client/main.js","packages/ostrio:user-status/client/throttle.js"],"names":["module","export","UserStatus","throttle","link","v","Meteor","Session","Tracker","Accounts","ReactiveVar","NoOp","UserStatusClass","setDefault","status","hidden","str","evt","document","mozHidden","msHidden","webkitHidden","check","set","goIdle","goOnline","autorun","_user","user","profile","idle","online","on","window","bind","obj","events","fn","forEach","event","addEventListener","passive","capture","attachEvent","_id","users","update","$set","goOffline","startTimer","setInterval","start","onLogin","onLogout","exportDefault","func","wait","options","context","args","result","timeout","previous","later","leading","Date","now","apply","remaining","arguments","clearTimeout","trailing","setTimeout"],"mappings":"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","file":"/packages/ostrio_user-status.js","sourcesContent":["import throttle        from './throttle';\nimport { Meteor }      from 'meteor/meteor';\nimport { Session }     from 'meteor/session';\nimport { Tracker }     from 'meteor/tracker';\nimport { Accounts }    from 'meteor/accounts-base';\nimport { ReactiveVar } from 'meteor/reactive-var';\n\nconst NoOp = function() {};\n\nclass UserStatusClass {\n  constructor() {\n    Session.setDefault('UserStatusIdle', false);\n    this.status = new ReactiveVar('offline');\n    this.hidden = {};\n\n    /* @description Set right visibilitychange event and property names */\n    this.hidden.str = false;\n    this.hidden.evt = void 0;\n    if (typeof document.hidden !== 'undefined') {\n      this.hidden.str = 'hidden';\n      this.hidden.evt = 'visibilitychange';\n    } else if (typeof document.mozHidden !== 'undefined') {\n      this.hidden.str = 'mozHidden';\n      this.hidden.evt = 'mozvisibilitychange';\n    } else if (typeof document.msHidden !== 'undefined') {\n      this.hidden.str = 'msHidden';\n      this.hidden.evt = 'msvisibilitychange';\n    } else if (typeof document.webkitHidden !== 'undefined') {\n      this.hidden.str = 'webkitHidden';\n      this.hidden.evt = 'webkitvisibilitychange';\n    }\n\n    this.hidden.check = () => {\n      return document[this.hidden.str];\n    };\n\n    /* @description Set active/inactive user status */\n    this.hidden.set = () => {\n      if (this.hidden.check()) {\n        this.goIdle();\n      } else {\n        this.goOnline();\n      }\n    };\n\n    Tracker.autorun(() => {\n      const _user = Meteor.user();\n      if (_user) {\n        Session.set('UserStatusIdle', _user.profile.idle || false);\n        if (_user.profile.idle) {\n          this.status.set('idle');\n        } else if (_user.profile.online) {\n          this.status.set('online');\n        } else {\n          this.status.set('offline');\n        }\n      } else {\n        Session.set('UserStatusIdle', false);\n        this.status.set('offline');\n      }\n    });\n\n    /* @description Set event listeners */\n    this.on(document, [this.hidden.evt], this.hidden.set);\n    this.on(window, ['mousemove', 'mousedown', 'keypress', 'DOMMouseScroll', 'mousewheel', 'touchmove', 'MSPointerMove', 'MSPointerMove'], throttle(this.goOnline.bind(this), 777));\n    this.on(document, ['mousemove', 'mousedown', 'keypress', 'DOMMouseScroll', 'mousewheel', 'touchmove', 'MSPointerMove', 'MSPointerMove'], throttle(this.goOnline.bind(this), 777));\n  }\n\n  on(obj, events, fn) {\n    events.forEach((event) => {\n      if (obj.addEventListener) {\n        obj.addEventListener(event, fn, { passive: true, capture: false });\n      } else {\n        obj.attachEvent('on' + event, fn);\n      }\n    });\n  }\n\n  goOnline() {\n    const _user = Meteor.user();\n    if (_user && _user._id && (_user.profile.online !== true || _user.profile.idle !== false)) {\n      Meteor.users.update({\n        _id: _user._id\n      }, {\n        $set: {\n          'profile.online': true,\n          'profile.idle': false\n        }\n      }, NoOp);\n    }\n  }\n\n  goIdle() {\n    const _user = Meteor.user();\n    if (_user && _user._id && (_user.profile.online !== true || _user.profile.idle !== true)) {\n      Meteor.users.update({\n        _id: _user._id\n      }, {\n        $set: {\n          'profile.online': true,\n          'profile.idle': true\n        }\n      }, NoOp);\n    }\n  }\n\n  goOffline(_user = Meteor.user()) {\n    if (_user && _user._id && (_user.profile.online !== false || _user.profile.idle !== false)) {\n      Meteor.users.update({\n        _id: _user._id\n      }, {\n        $set: {\n          'profile.online': false,\n          'profile.idle': false\n        }\n      }, NoOp);\n    }\n  }\n\n  startTimer() {\n    Meteor.setInterval(this.goIdle.bind(this), 30000);\n  }\n\n  start() {\n    this.startTimer();\n  }\n}\n\nconst UserStatus = new UserStatusClass();\nAccounts.onLogin(UserStatus.start.bind(UserStatus));\nAccounts.onLogout(UserStatus.goOffline.bind(UserStatus));\n\nexport { UserStatus };\n","export default function (func, wait, options = {}) {\n  let context;\n  let args;\n  let result;\n  let timeout = null;\n  let previous = 0;\n\n  const later = () => {\n    previous = options.leading === false ? 0 : Date.now();\n    timeout = null;\n    result = func.apply(context, args);\n    if (!timeout) {\n      context = args = null;\n    }\n  };\n\n  return function() {\n    const now = Date.now();\n    if (!previous && options.leading === false) {\n      previous = now;\n    }\n\n    const remaining = wait - (now - previous);\n    context = this;\n    args = arguments;\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout);\n        timeout = null;\n      }\n\n      previous = now;\n      result = func.apply(context, args);\n\n      if (!timeout) {\n        context = args = null;\n      }\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining);\n    }\n    return result;\n  };\n}\n"]}}]